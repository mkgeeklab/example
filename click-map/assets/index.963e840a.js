var Et=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var B=(n,t,e)=>(Et(n,t,"read from private field"),e?e.call(n):t.get(n)),T=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},yt=(n,t,e,i)=>(Et(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e),Rt=(n,t,e,i)=>({set _(s){yt(n,t,s,e)},get _(){return B(n,t,i)}}),nt=(n,t,e)=>(Et(n,t,"access private method"),e);const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};fe();var A;(function(n){n.NO_FRAMEWORK="no_framework",n.CORDOVA="cordova",n.CAPACITOR="capacitor"})(A||(A={}));const Ct={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo  ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"#00000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},u={NOT_READY:0,VIEW_CREATING:1,VIEW_CREATED:2,VIEW_RELEASED:3},jt=["script","style","caption","svg"];var b;(function(n){n.BROWSER="browser",n.ANDROID="android",n.IOS="ios"})(b||(b={}));var Tt;(function(n){n[n.CONTINUE=0]="CONTINUE",n[n.VOID=1]="VOID",n[n.STRING=2]="STRING",n[n.DICTIONARY=3]="DICTIONARY"})(Tt||(Tt={}));const ge=n=>{if(!(!n||n.tagName.startsWith("g-"))&&(n.classList&&!n.classList.contains("_gmh_css_")?n.classList.add("_gmh_css_"):n.className&&n.className.indexOf("_gmh_css_")===-1&&(n.className=n.className+" _gmh_css_"),n.shadowRoot)){let t=n.getAttribute("style")||"";t=[t,"--ion-background-color: var(--mkg-background-color) !important;","--background-color: var(--mkg-background-color) !important;","--background: var(--mkg-background-color) !important;"].join(""),n.setAttribute("style",t)}},ht=(n,t)=>{const e=typeof n;if(e!==typeof t)return!1;let s=!0;if(n&&e==="object")if(Array.isArray(n)){s=n.length===t.length;for(let o=0;o<n.length&&s;o++)s=ht(n[o],t[o])}else{const o=Object.keys(n),r=Object.keys(t);s=ht(o,r);for(let a=0;s&&a<o.length;a++){const h=o[a];s=ht(n[h],t[h])}}else s=n===t;return s},y=(n,t)=>document.defaultView.getComputedStyle(n,null).getPropertyValue(t);window.getStyle=y;const Jt=n=>n?n.nodeType===Node.ELEMENT_NODE&&jt.indexOf(n.tagName.toLowerCase())===-1&&!(n instanceof SVGElement)&&typeof n.getBoundingClientRect=="function":!1,Yt=n=>{if(n===document.body)return!0;if(!n||n.nodeType!==Node.ELEMENT_NODE||!Jt(n))return!1;const t=n.tagName.toLowerCase();return jt.indexOf(t)>-1?!1:y(n,"display")!=="none"},P=n=>{if(!n||!Yt(n))return"";let t=n.__pluginDomId||"";return t||(t=n===document.body?"root":`mkg${Math.floor(Math.random()*Date.now())}`,Reflect.defineProperty(n,"__pluginDomId",{enumerable:!1,value:t,writable:!1})),t},pe=Symbol("HTMLElementBase");class O extends HTMLElement{constructor(){super(),this.state=new st,this.viewId=P(this),this.changeFunctions={},this._initStatus=u.NOT_READY,this._isConnected=!1,this._isRemoved=!1,this.mutationObserver=new MutationObserver(this._onMutations.bind(this)),this.onInsertAtListener=this.onCommandFromChildren.bind(this),this.SUBSCRIPTIONS_FIELD={},window.mkgeeklab.googlemaps.elements[this.viewId]=this,Reflect.defineProperty(this,"_symbol",{enumerable:!1,value:pe,writable:!1})}setAttributeChangeListener(t,e){e?this.changeFunctions[t]=e:delete this.changeFunctions[t]}getId(){return`${this.viewId}`}attributeChangedCallback(t,e,i){t in this.changeFunctions&&this.changeFunctions[t].call(this,t,e,i)}get hasParent(){return this._isConnected}get initStatus(){return this._initStatus}set initStatus(t){(t===u.VIEW_CREATING&&this._initStatus===u.NOT_READY||t===u.VIEW_CREATED&&(this._initStatus===u.VIEW_CREATING||this._initStatus===u.VIEW_RELEASED)||t===u.VIEW_RELEASED&&this._initStatus===u.VIEW_CREATED)&&(this._initStatus=t,this.dispatchEvent(new CustomEvent("initStatus_changed",{detail:{status:t}})),t===u.VIEW_CREATED&&this.dispatchEvent(new CustomEvent("ready")))}get ready(){return this._initStatus===u.VIEW_CREATED}get isRemoved(){return this._isRemoved}get extra(){return this.state.get("extra")}set extra(t){this.state.set("extra",t)}onCommandFromChildren(t){}onChildrenAdded(t){}onChildrenRemoved(t){}_onMutations(t,e){const i=[],s=[];t.forEach(o=>{o.addedNodes&&o.addedNodes.length>0&&o.addedNodes.forEach(r=>{if(r instanceof O){const a=r;i.push(a),a.addEventListener("command",this.onInsertAtListener)}}),o.removedNodes&&o.removedNodes.length>0&&o.removedNodes.forEach(r=>{if(r instanceof O){const a=r;a.removeEventListener("command",this.onInsertAtListener),s.push(a)}})}),i.length>0&&this.onChildrenAdded(i),s.length>0&&this.onChildrenRemoved(s)}connectedCallback(){this._isConnected=!0,this.onConnected()}async onConnected(){await window.customElements.whenDefined("mkg-mapview"),Array.from(this.children).forEach(e=>{e instanceof O&&e.addEventListener("command",this.onInsertAtListener)}),this.mutationObserver.observe(this,{childList:!0}),this.dispatchEvent(new CustomEvent("isConnected_changed",{detail:!0}))}disconnectedCallback(){this._isConnected=!1,this.onDisconnected()}async onDisconnected(){this.mutationObserver.disconnect(),new CustomEvent("parentChanged",{detail:{connected:!1}}),Array.from(this.children).forEach(e=>{e instanceof O&&e.removeEventListener("command",this.onInsertAtListener)}),this.dispatchEvent(new CustomEvent("isConnected_changed",{detail:!1}))}remove(){super.remove(),this._isRemoved=!0,this.dispatchEvent(new CustomEvent("removed"))}hasEventListener(t){return t in this.SUBSCRIPTIONS_FIELD&&Object.keys(this.SUBSCRIPTIONS_FIELD[t]).length>0}addEventListener(t,e,i){if(!e||typeof e!="function")throw Error("Listener for addEventListener() method is not a function");let s=e._hashCode;s||(s=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:s,writable:!1,enumerable:!1})),this.SUBSCRIPTIONS_FIELD[t]=this.SUBSCRIPTIONS_FIELD[t]||{},this.SUBSCRIPTIONS_FIELD[t][s]={kind:"on",once:i&&i.once===!0,listener:e}}removeEventListener(t,e){if(!t){Object.keys(this.SUBSCRIPTIONS_FIELD).forEach(s=>{Object.keys(this.SUBSCRIPTIONS_FIELD[s]).forEach(r=>{this.SUBSCRIPTIONS_FIELD[s][r].listener._protect||delete this.SUBSCRIPTIONS_FIELD[s][r]})});return}if(!e)Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach(s=>{this.SUBSCRIPTIONS_FIELD[t][s].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][s]}),this.SUBSCRIPTIONS_FIELD[t].length===0&&delete this.SUBSCRIPTIONS_FIELD[t];else{const i=e._hashCode;if(!i)return;this.SUBSCRIPTIONS_FIELD[t]&&this.SUBSCRIPTIONS_FIELD[t][i]&&(this.SUBSCRIPTIONS_FIELD[t][i].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][i])}}dispatchEvent(t){if(!t)return!1;Object.defineProperty(t,"target",{value:this,writable:!1,enumerable:!0});const e=t.type;if(!this.SUBSCRIPTIONS_FIELD[e])return!1;const i=this.SUBSCRIPTIONS_FIELD[e];return Object.keys(i).forEach(o=>{if(this.SUBSCRIPTIONS_FIELD&&e in this.SUBSCRIPTIONS_FIELD&&o in this.SUBSCRIPTIONS_FIELD[e]){const r=this.SUBSCRIPTIONS_FIELD[e][o];Promise.resolve().then(()=>r.listener(t)),r.once===!0&&delete this.SUBSCRIPTIONS_FIELD[e][o]}}),!0}}const $=(n,t=6)=>n.toFixed(t).replace(/0+$/,"").replace(/\.$/,"");class p extends O{static get observedAttributes(){return["lat","lng"]}constructor(t=0,e=0,i=!1){super(),this._timer=null,this._changed=!1,this._update=this._onUpdate.bind(this),this._on_attr_changed=(s,o,r)=>this._onAttrChanged(s,o,r),i||(t=Math.max(-90,Math.min(90,t)),e>180?e=-180+e%180:e<-180&&(e=180+e%180)),this._lat=t,this._lng=e,this.setAttributeChangeListener("lat",this._on_attr_changed),this.setAttributeChangeListener("lng",this._on_attr_changed)}connectedCallback(){if(this.hasAttribute("lat")&&this.hasAttribute("lng")){const t=this.getAttribute("lat"),e=this.getAttribute("lng");t!==null&&e!==null&&(this._lat=parseFloat(t),this._lng=parseFloat(e),this._changed=!0,this._onUpdate())}}_onAttrChanged(t,e,i){t==="lat"?this._lat=parseFloat(i):this._lng=parseFloat(i),this._changed=!0,this._onPropertyChanged()}_onPropertyChanged(){this._timer&&clearTimeout(this._timer),this._timer=setTimeout(this._update,5)}_onUpdate(){this._timer=null,this._changed&&(this._changed=!1,this.dispatchEvent(new CustomEvent("command",{detail:{methodName:"setPosition",latLng:{lat:this._lat,lng:this._lng}}})))}equals(t){return t?t instanceof p?this._lat===t.lat&&this._lng===t.lng:this._lat===t.lat&&this._lng===t.lng:!1}set lat(t){this.setAttribute("lat",t+""),typeof t=="string"&&(t=parseFloat(t)),this._lat=t,this._changed=!0,this._onPropertyChanged()}get lat(){return this._lat}set lng(t){this.setAttribute("lng",t+""),typeof t=="string"&&(t=parseFloat(t)),this._lng=t,this._changed=!0,this._onPropertyChanged()}get lng(){return this._lng}setPosition(t){this._lat=t.lat,this._lng=t.lng,this._changed=!0,this._onPropertyChanged()}getPosition(){return{lat:this._lat,lng:this._lng}}toString(){return"("+this._lat+", "+this._lng+")"}toUrlValue(t=6){return[$(this._lat,t),$(this._lng,t)].join(",")}toJSON(){return{lat:this._lat,lng:this._lng}}}const w=n=>!!n&&typeof n=="object"&&"lat"in n&&typeof n.lat=="number"&&"lng"in n&&typeof n.lng=="number",G=n=>{if(!n)throw new Error("The first argument of toILatlng can not be null");if(w(n))return{lat:n.lat,lng:n.lng};if(n instanceof p)return{lat:n.lat,lng:n.lng};throw new Error("Cannot convert to ILatLng")},I=(n,t,e)=>Math.min(Math.max(n,t),e);class qt{constructor(){this.TILE_SIZE=256,this.pixelOrigin={x:0,y:0},this.pixelsPerLngDegree=0,this.pixelsPerLngRadian=0,this.pixelOrigin={x:this.TILE_SIZE/2,y:this.TILE_SIZE/2},this.pixelsPerLngDegree=this.TILE_SIZE/360,this.pixelsPerLngRadian=this.TILE_SIZE/(2*Math.PI)}degreesToRadius(t){return t*(Math.PI/180)}radiansToDegrees(t){return t/(Math.PI/180)}fromLatLngToPoint(t){const e=G(t),i={x:0,y:0};i.x=this.pixelOrigin.x+e.lng*this.pixelsPerLngDegree;const s=I(Math.sin(this.degreesToRadius(e.lat)),-.9999,.9999);return i.y=this.pixelOrigin.y+.5*Math.log((1+s)/(1-s))*-this.pixelsPerLngRadian,i}fromPointToLatLng(t,e=!1){const i=(t.x-this.pixelOrigin.x)/this.pixelsPerLngDegree,s=(t.y-this.pixelOrigin.y)/-this.pixelsPerLngRadian;return{lat:this.radiansToDegrees(2*Math.atan(Math.exp(s))-Math.PI/2),lng:i,noWrap:e}}}class st{constructor(){this.VARS_FIELD={},this.SUBSCRIPTIONS_FIELD={},this.hashCode=Math.floor(Date.now()*Math.random())}remove(t){delete this.VARS_FIELD[t]}has(t){return this.VARS_FIELD.hasOwnProperty(t)}get(t){if(this.VARS_FIELD.hasOwnProperty(t))return this.VARS_FIELD[t]}set(t,e,i=!1){if(t==="__mkgId")return;const s=this.get(t);this.VARS_FIELD[t]=e,!i&&s!==e&&this.dispatchEvent(new CustomEvent(`${t}_changed`,{detail:{prevValue:s,value:e,key:t}}))}bindTo(t,e,i,s=!1){t!=="__mkgId"&&(i=i||t,e.set(i,this.VARS_FIELD[t],s),this.addEventListener(t+"_changed",o=>{e.set(i,o.detail.value)}))}trigger(t,e={}){return this.dispatchEvent(new CustomEvent(t,{detail:e}))}dispatchEvent(t){if(!t)return!1;const e=t.type;if(!this.SUBSCRIPTIONS_FIELD[e])return!1;const i=this.SUBSCRIPTIONS_FIELD[e];return Object.keys(i).forEach(o=>{if(this.SUBSCRIPTIONS_FIELD&&e in this.SUBSCRIPTIONS_FIELD&&o in this.SUBSCRIPTIONS_FIELD[e]){const r=this.SUBSCRIPTIONS_FIELD[e][o];switch(r.kind){case"on":r.listener.call(this,t);break;case"onThrottled":r.event=t,r.timer||(r.timer=setTimeout(()=>{r.listener.apply(this,r.event),r.timer=null},r.interval));break}}}),!0}addEventListener(t,e){if(!e||typeof e!="function")throw Error("Listener for addEventListener() method is not a function");let i=e._hashCode;i||(i=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:i,writable:!1,enumerable:!1})),this.SUBSCRIPTIONS_FIELD[t]=this.SUBSCRIPTIONS_FIELD[t]||{},this.SUBSCRIPTIONS_FIELD[t][i]={kind:"on",listener:e}}removeEventListener(t,e){if(!t){Object.keys(this.SUBSCRIPTIONS_FIELD).forEach(s=>{Object.keys(this.SUBSCRIPTIONS_FIELD[s]).forEach(r=>{this.SUBSCRIPTIONS_FIELD[s][r].listener._protect||delete this.SUBSCRIPTIONS_FIELD[s][r]})});return}if(!e)Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach(s=>{this.SUBSCRIPTIONS_FIELD[t][s].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][s]}),this.SUBSCRIPTIONS_FIELD[t].length===0&&delete this.SUBSCRIPTIONS_FIELD[t];else{const i=e._hashCode;if(!i)return;this.SUBSCRIPTIONS_FIELD[t]&&this.SUBSCRIPTIONS_FIELD[t][i]&&(this.SUBSCRIPTIONS_FIELD[t][i].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][i])}}addEventListenerOnce(t,e){const i=s=>{this.removeEventListener(t,i),e.call(this,s)};this.addEventListener(t,i)}hasEventListener(t){return t in this.SUBSCRIPTIONS_FIELD&&Object.keys(this.SUBSCRIPTIONS_FIELD[t]).length>0}release(){this.removeEventListener();const t=this.VARS_FIELD;Object.keys(t).forEach(e=>{t[e]=null,delete t[e]})}toJSON(){const t={};return Object.keys(this.VARS_FIELD).forEach(i=>{const s=this.VARS_FIELD[i];t[i]=s&&typeof s.toJSON=="function"?s.toJSON():s}),t}}const At=n=>{Promise.resolve().then(n)};class L extends st{constructor(t){super(),this.ARRAY_FIELD=[],t&&(t instanceof Array||Array.isArray(t))&&t.forEach(e=>{this.ARRAY_FIELD.push(e)})}mapSeries(t){if(typeof t!="function")throw new Error("iteratee must be a function");const e=this.ARRAY_FIELD.length;if(e===0)return Promise.resolve([]);let i=0;const s=(r,a)=>{t(this.ARRAY_FIELD[r],r,h=>{o[r]=h,i++,e===i?a(o):At(()=>{s(r+1,a)})})},o=[];return new Promise((r,a)=>{try{At(()=>{s(0,r)})}catch(h){a(h)}})}mapAsync(t){if(typeof t!="function")throw new Error("iteratee must be a function");const e=this.ARRAY_FIELD.length,i=new Array(e);let s=0;return e===0?Promise.resolve([]):new Promise((o,r)=>{this.ARRAY_FIELD.forEach((a,h)=>{try{t(a,h,l=>{i[h]=l,s++,s===e&&o(i)})}catch(l){r(l)}})})}forEach(t){if(typeof t!="function")throw new Error("iteratee must be a function");this.ARRAY_FIELD.forEach(t)}forEachAsync(t){if(typeof t!="function")throw new Error("iteratee must be a function");let e=0;const i=this.ARRAY_FIELD.length;return i===0?Promise.resolve():new Promise((s,o)=>{this.ARRAY_FIELD.forEach((r,a)=>{try{t(r,a,()=>{e++,e===i&&s()})}catch(h){o(h)}})})}filterAsync(t){if(typeof t!="function")throw new Error("iteratee must be a function");let e=0;const i=this.ARRAY_FIELD.length;return i===0?Promise.resolve([]):new Promise((s,o)=>{const r=[];try{this.ARRAY_FIELD.forEach((a,h)=>{t(a,l=>{r[h]=l,e++,e===i&&s(this.ARRAY_FIELD.filter((d,c)=>r[c]))})})}catch(a){o(a)}})}indexOf(t,e){if(e=e==null?0:e,typeof e!="number")throw new Error("searchElement must be a number");if(e<0)throw new Error("searchElement must be over number than 0");return this.ARRAY_FIELD.indexOf(t,e)}clear(t){this.ARRAY_FIELD.length=0,t!==!0&&this.dispatchEvent(new Event("remove_all"))}push(t,e){return this.ARRAY_FIELD.push(t),e!==!0&&this.dispatchEvent(new CustomEvent("insert_at",{detail:{index:this.ARRAY_FIELD.length-1,value:t}})),this.ARRAY_FIELD.length}insertAt(t,e,i){if(typeof t!="number")throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");return this.ARRAY_FIELD.splice(t,0,e),i!==!0&&this.dispatchEvent(new CustomEvent("insert_at",{detail:{index:t,value:e}})),this.ARRAY_FIELD.length}toArray(){const t=[];return this.ARRAY_FIELD.forEach(e=>{t.push(e)}),t}getAt(t){if(typeof t!="number")throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");if(t>=this.ARRAY_FIELD.length)throw new Error("index must be lower number than "+this.ARRAY_FIELD.length);return this.ARRAY_FIELD[t]}setAt(t,e,i){if(typeof t!="number")throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");t>this.ARRAY_FIELD.length&&(this.ARRAY_FIELD.length=t);const s=this.ARRAY_FIELD[t];return this.ARRAY_FIELD[t]=e,i!==!0&&this.dispatchEvent(new CustomEvent("set_at",{detail:{index:t,prevValue:s,value:e}})),s}removeAt(t,e){if(typeof t!="number")throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");if(t>=this.ARRAY_FIELD.length)throw new Error("index must be lower number than "+this.ARRAY_FIELD.length);const i=this.ARRAY_FIELD[t];return this.ARRAY_FIELD.splice(t,1),e!==!0&&this.dispatchEvent(new CustomEvent("remove_at",{detail:{index:t,prevValue:i}})),i}pop(t){const e=this.ARRAY_FIELD.length-1,i=this.ARRAY_FIELD.pop();return t!==!0&&this.dispatchEvent(new CustomEvent("remove_at",{detail:{index:e,value:i}})),i}getLength(){return this.ARRAY_FIELD.length}reverse(){this.ARRAY_FIELD.reverse()}sort(t){typeof t=="function"?this.ARRAY_FIELD.sort(t):this.ARRAY_FIELD.sort()}}const Gt=n=>{if(!!n&&(n.classList&&n.classList.contains("_gmh_css_")?n.classList.remove("_gmh_css_"):n.className&&n.className.indexOf("_gmh_css_")>-1&&(n.className=n.className.replace("_gmh_css_","")),n.shadowRoot)){let t=n.getAttribute("style")||"";t&&t.indexOf("--mkg-background-color")>-1&&(t=t.replace("--ion-background-color: var(--mkg-background-color) !important;","").replace("--background-color: var(--mkg-background-color) !important;","").replace("--background: var(--mkg-background-color) !important;","")),n.setAttribute("style",t);const e=n.querySelectorAll("*");Array.prototype.splice(e,0).forEach(s=>Gt(s))}},Mt=n=>n?!!(n.classList&&n.classList.contains("_gmh_css_")||n.className&&n.className.indexOf("_gmh_css_")>-1):!1;class Qt extends O{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.template=document.createElement("template"),this._keepParentNode=null,this.projection=new qt,this._execQueue=new L,this._bind_onExecute=()=>this.onExecute(),this._bind_onInitStatusChanged=t=>this._onInitStatusChanged(t),this.bufferedCommands=[],this.cmdQueue=window.mkgeeklab.googlemaps.getCommandQueue("api"),this.addEventListener("initStatus_changed",this._bind_onInitStatusChanged)}getShadowRoot(){return this.shadow}getProjection(){return this.projection}onChildrenRemoved(t){const e=t.map(i=>i.__pluginDomId);this.execPromise(this.viewId,"detachOverlayFromMap",e)}remove(){super.remove(),this.execPromise(this.viewId,"releaseView",[{id:this.__pluginDomId}])}execPromise(t,e,i=[],s={}){return this.isRemoved?Promise.reject(`<${this.tagName} __pluginDomId="${this.viewId}"> has been already removed`):this.cmdQueue&&this.initStatus<u.VIEW_CREATED&&t==="GoogleMaps"?this.cmdQueue.execPromise(t,e,i,s):new Promise((o,r)=>{this._execQueue.push({pluginName:t,methodName:e,args:i,execOptions:s,onSuccess:o,onError:r})})}async connectedCallback(){await super.connectedCallback(),this.style.overflow="hidden !important";let t=this.parentElement;for(;!!t&&t.nodeType===Node.ELEMENT_NODE;){if(!Mt(t)){let e=y(t,"--background");e||(e=y(t,"background-color")),e=(e||"").trim(),ge(t)}t=t.parentElement}this._keepParentNode=this.parentElement}disconnectedCallback(){super.disconnectedCallback(),this.initStatus=u.VIEW_RELEASED;let t=this._keepParentNode;for(;!!t&&t.nodeType===Node.ELEMENT_NODE;)Mt(t)&&Gt(t),t=t.parentElement;this._keepParentNode=null}_onInitStatusChanged(t){const e=t.detail.status;e===u.VIEW_CREATED?(this._execQueue.addEventListener("insert_at",this._bind_onExecute),this._execQueue.dispatchEvent(new CustomEvent("insert_at")),this.bufferedCommands.forEach(i=>{this._execQueue.push(i)}),this.bufferedCommands=[]):e===u.VIEW_RELEASED&&this._execQueue.removeEventListener("insert_at",this._bind_onExecute)}onExecute(){if(!this.cmdQueue)return;const t=this.getId();for(;this._execQueue.getLength()>0;){const e=this._execQueue.removeAt(0,!0);e&&(e.pluginName=e.pluginName==="(parent)"?t:e.pluginName,this.cmdQueue.execPromise(e.pluginName,e.methodName,e.args,e.execOptions).then(e.onSuccess).catch(e.onError))}}onCommandFromChildren(t){this.getId();const i=t.detail;this.initStatus!==u.VIEW_CREATED?i.forEach(s=>{this.bufferedCommands.push(s)}):(this.bufferedCommands.length>0&&(this.bufferedCommands.forEach(s=>{this._execQueue.push(s)}),this.bufferedCommands=[]),i.forEach(s=>{this._execQueue.push(s)}))}}const Xt=(n,t)=>n===null||t===null?!1:(n instanceof p&&(n=n.toJSON()),t instanceof p&&(t=t.toJSON()),w(n)&&w(t)&&n.lat===t.lat&&n.lng===t.lng),me=(n,t={})=>{let e;return typeof CustomEvent=="function"?e=new CustomEvent(n,{bubbles:!0,detail:t||null}):(e=document.createEvent("Event"),e.initEvent(n,!0,!1),t&&Object.keys(t).forEach(i=>{i in t||Reflect.defineProperty(e,i,{value:t[i],writable:!1,enumerable:!0})})),e},v=(n,t)=>{let e=y(n,`--${t}`);if(!(e===""||e===null||e===void 0)){if(typeof e=="string"){e=e.trim();const i=e.toLowerCase();if(i==="true"||i==="false")return e==="true";if(i==="none"||i==="undefined")return}return e}},U=n=>{if(!window.mkgeeklab||!window.mkgeeklab.googlemaps)return;if(n in window.mkgeeklab.googlemaps.elements)return window.mkgeeklab.googlemaps.elements[n];const e=Array.from(document.querySelectorAll("*")).filter(i=>i.__pluginDomId===n);if(e.length===1)return window.mkgeeklab.googlemaps.elements[n]=e[0],e[0];delete window.mkgeeklab.googlemaps.elements[n]},K=n=>{if(!Jt(n))throw new Error(`[getElementRect] given element ${n.tagName} is not supported.`);const t={left:0,top:0,width:0,height:0},e=n.getBoundingClientRect();return n===document.body?(t.left=Math.max(e.left,window.pageXOffset),t.top=Math.max(e.top,window.pageYOffset),t.width=Math.max(e.width,window.innerWidth),t.height=Math.max(e.height,window.innerHeight)):(t.left=e.left,t.top=e.top,t.width=e.width,t.height=e.height),t};window.getElementRect=K;var M=[],_e=function(){return M.some(function(n){return n.activeTargets.length>0})},ve=function(){return M.some(function(n){return n.skippedTargets.length>0})},Dt="ResizeObserver loop completed with undelivered notifications.",be=function(){var n;typeof ErrorEvent=="function"?n=new ErrorEvent("error",{message:Dt}):(n=document.createEvent("Event"),n.initEvent("error",!1,!1),n.message=Dt),window.dispatchEvent(n)},tt;(function(n){n.BORDER_BOX="border-box",n.CONTENT_BOX="content-box",n.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(tt||(tt={}));var D=function(n){return Object.freeze(n)},Ee=function(){function n(t,e){this.inlineSize=t,this.blockSize=e,D(this)}return n}(),Kt=function(){function n(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,D(this)}return n.prototype.toJSON=function(){var t=this,e=t.x,i=t.y,s=t.top,o=t.right,r=t.bottom,a=t.left,h=t.width,l=t.height;return{x:e,y:i,top:s,right:o,bottom:r,left:a,width:h,height:l}},n.fromRect=function(t){return new n(t.x,t.y,t.width,t.height)},n}(),Lt=function(n){return n instanceof SVGElement&&"getBBox"in n},te=function(n){if(Lt(n)){var t=n.getBBox(),e=t.width,i=t.height;return!e&&!i}var s=n,o=s.offsetWidth,r=s.offsetHeight;return!(o||r||n.getClientRects().length)},zt=function(n){var t;if(n instanceof Element)return!0;var e=(t=n==null?void 0:n.ownerDocument)===null||t===void 0?void 0:t.defaultView;return!!(e&&n instanceof e.Element)},ye=function(n){switch(n.tagName){case"INPUT":if(n.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},Q=typeof window!="undefined"?window:{},ot=new WeakMap,Nt=/auto|scroll/,we=/^tb|vertical/,Ie=/msie|trident/i.test(Q.navigator&&Q.navigator.userAgent),x=function(n){return parseFloat(n||"0")},H=function(n,t,e){return n===void 0&&(n=0),t===void 0&&(t=0),e===void 0&&(e=!1),new Ee((e?t:n)||0,(e?n:t)||0)},Ft=D({devicePixelContentBoxSize:H(),borderBoxSize:H(),contentBoxSize:H(),contentRect:new Kt(0,0,0,0)}),ee=function(n,t){if(t===void 0&&(t=!1),ot.has(n)&&!t)return ot.get(n);if(te(n))return ot.set(n,Ft),Ft;var e=getComputedStyle(n),i=Lt(n)&&n.ownerSVGElement&&n.getBBox(),s=!Ie&&e.boxSizing==="border-box",o=we.test(e.writingMode||""),r=!i&&Nt.test(e.overflowY||""),a=!i&&Nt.test(e.overflowX||""),h=i?0:x(e.paddingTop),l=i?0:x(e.paddingRight),d=i?0:x(e.paddingBottom),c=i?0:x(e.paddingLeft),f=i?0:x(e.borderTopWidth),g=i?0:x(e.borderRightWidth),m=i?0:x(e.borderBottomWidth),k=i?0:x(e.borderLeftWidth),C=c+l,S=h+d,_=k+g,R=f+m,z=a?n.offsetHeight-R-n.clientHeight:0,N=r?n.offsetWidth-_-n.clientWidth:0,q=s?C+_:0,vt=s?S+R:0,F=i?i.width:x(e.width)-q-N,W=i?i.height:x(e.height)-vt-z,bt=F+C+N+_,ue=W+S+z+R,Ot=D({devicePixelContentBoxSize:H(Math.round(F*devicePixelRatio),Math.round(W*devicePixelRatio),o),borderBoxSize:H(bt,ue,o),contentBoxSize:H(F,W,o),contentRect:new Kt(c,h,F,W)});return ot.set(n,Ot),Ot},ie=function(n,t,e){var i=ee(n,e),s=i.borderBoxSize,o=i.contentBoxSize,r=i.devicePixelContentBoxSize;switch(t){case tt.DEVICE_PIXEL_CONTENT_BOX:return r;case tt.BORDER_BOX:return s;default:return o}},Ce=function(){function n(t){var e=ee(t);this.target=t,this.contentRect=e.contentRect,this.borderBoxSize=D([e.borderBoxSize]),this.contentBoxSize=D([e.contentBoxSize]),this.devicePixelContentBoxSize=D([e.devicePixelContentBoxSize])}return n}(),se=function(n){if(te(n))return 1/0;for(var t=0,e=n.parentNode;e;)t+=1,e=e.parentNode;return t},Se=function(){var n=1/0,t=[];M.forEach(function(r){if(r.activeTargets.length!==0){var a=[];r.activeTargets.forEach(function(l){var d=new Ce(l.target),c=se(l.target);a.push(d),l.lastReportedSize=ie(l.target,l.observedBox),c<n&&(n=c)}),t.push(function(){r.callback.call(r.observer,a,r.observer)}),r.activeTargets.splice(0,r.activeTargets.length)}});for(var e=0,i=t;e<i.length;e++){var s=i[e];s()}return n},Wt=function(n){M.forEach(function(e){e.activeTargets.splice(0,e.activeTargets.length),e.skippedTargets.splice(0,e.skippedTargets.length),e.observationTargets.forEach(function(s){s.isActive()&&(se(s.target)>n?e.activeTargets.push(s):e.skippedTargets.push(s))})})},Le=function(){var n=0;for(Wt(n);_e();)n=Se(),Wt(n);return ve()&&be(),n>0},wt,ne=[],xe=function(){return ne.splice(0).forEach(function(n){return n()})},Pe=function(n){if(!wt){var t=0,e=document.createTextNode(""),i={characterData:!0};new MutationObserver(function(){return xe()}).observe(e,i),wt=function(){e.textContent="".concat(t?t--:t++)}}ne.push(n),wt()},ke=function(n){Pe(function(){requestAnimationFrame(n)})},lt=0,Oe=function(){return!!lt},Re=250,Te={attributes:!0,characterData:!0,childList:!0,subtree:!0},Bt=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],Vt=function(n){return n===void 0&&(n=0),Date.now()+n},It=!1,Ae=function(){function n(){var t=this;this.stopped=!0,this.listener=function(){return t.schedule()}}return n.prototype.run=function(t){var e=this;if(t===void 0&&(t=Re),!It){It=!0;var i=Vt(t);ke(function(){var s=!1;try{s=Le()}finally{if(It=!1,t=i-Vt(),!Oe())return;s?e.run(1e3):t>0?e.run(t):e.start()}})}},n.prototype.schedule=function(){this.stop(),this.run()},n.prototype.observe=function(){var t=this,e=function(){return t.observer&&t.observer.observe(document.body,Te)};document.body?e():Q.addEventListener("DOMContentLoaded",e)},n.prototype.start=function(){var t=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Bt.forEach(function(e){return Q.addEventListener(e,t.listener,!0)}))},n.prototype.stop=function(){var t=this;this.stopped||(this.observer&&this.observer.disconnect(),Bt.forEach(function(e){return Q.removeEventListener(e,t.listener,!0)}),this.stopped=!0)},n}(),St=new Ae,$t=function(n){!lt&&n>0&&St.start(),lt+=n,!lt&&St.stop()},Me=function(n){return!Lt(n)&&!ye(n)&&getComputedStyle(n).display==="inline"},De=function(){function n(t,e){this.target=t,this.observedBox=e||tt.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return n.prototype.isActive=function(){var t=ie(this.target,this.observedBox,!0);return Me(this.target)&&(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},n}(),ze=function(){function n(t,e){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=e}return n}(),rt=new WeakMap,Ut=function(n,t){for(var e=0;e<n.length;e+=1)if(n[e].target===t)return e;return-1},at=function(){function n(){}return n.connect=function(t,e){var i=new ze(t,e);rt.set(t,i)},n.observe=function(t,e,i){var s=rt.get(t),o=s.observationTargets.length===0;Ut(s.observationTargets,e)<0&&(o&&M.push(s),s.observationTargets.push(new De(e,i&&i.box)),$t(1),St.schedule())},n.unobserve=function(t,e){var i=rt.get(t),s=Ut(i.observationTargets,e),o=i.observationTargets.length===1;s>=0&&(o&&M.splice(M.indexOf(i),1),i.observationTargets.splice(s,1),$t(-1))},n.disconnect=function(t){var e=this,i=rt.get(t);i.observationTargets.slice().forEach(function(s){return e.unobserve(t,s.target)}),i.activeTargets.splice(0,i.activeTargets.length)},n}(),Ne=function(){function n(t){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof t!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");at.connect(this,t)}return n.prototype.observe=function(t,e){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!zt(t))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");at.observe(this,t,e)},n.prototype.unobserve=function(t){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!zt(t))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");at.unobserve(this,t)},n.prototype.disconnect=function(){at.disconnect(this)},n.toString=function(){return"function ResizeObserver () { [polyfill code] }"},n}();class xt{constructor(t){this.children=[],this.zIndex=null,this.overflowX=0,this.overflowY=0,this.pointerEvents=1,this.rect={left:0,top:0,width:0,height:0},this.parent=null,this._positionChanged=!1,this.element=t,this.id=P(t)}equals(t){return!t||!(t instanceof xt)?!1:ht(this.toJSON(),t.toJSON())}toJSON(){if(!this.element)return{};const t=[];this.children.forEach(i=>{t.push(i.toJSON())});const e=[];return this.zIndex&&(e.push(this.zIndex.isInherit?1:0),e.push(this.zIndex.z)),{c:t,t:this.pointerEvents,o:this.overflowX<<2|this.overflowY,r:[Math.round(this.rect.left),Math.round(this.rect.top),Math.round(this.rect.width),Math.round(this.rect.height)],i:this.id,z:e,n:this.element.tagName}}}class Fe{constructor(){this.cache={}}_clearInternalCache(){this.cache={}}_removeCacheById(t){delete this.cache[t]}getZIndex(t){if(!t)return null;t===document.body&&(this.cache={});let e=y(t,"z-index");const s=t.__pluginDomId,o=t.parentElement;let r;if(!o)return{z:0,isInherit:!0};const a=o.__pluginDomId;r=a in this.cache?this.cache[a]:this.getZIndex(o);const h=y(t,"position");let l=!1;return e==="unset"||e==="initial"||h==="relative"?e=0:e==="auto"||e==="inherit"?(e=0,l=!0):typeof e=="string"&&(e=parseInt(e,10)),e==null&&(e=0),this.cache[s]=e+(r?r.z:0),{isInherit:l,z:e}}}const We=window.ResizeObserver||Ne;class Be{constructor(t){this.zManager=new Fe,this.mutationObserver=new MutationObserver(this.mutationListener.bind(this)),this.tree={},this.rootElement=null,this.actions={},this.cmdQueue=null,this.positionTimer=null,this.scrollEndCnt=0,this.isScrollEventProcessing=!1,this.resizeObserver=new We(e=>{window.requestAnimationFrame(()=>{this.onDomResize(e)})}),this._bind_onScroll=e=>this.onDomScroll(e),this._bind_removeDomIdFromGMH=e=>this.removeDomIdFromGMH(e),this._bind_followViewElements=()=>this.followViewElements(),this._any_change=!1,this.overflowCssToNumber=(e,i)=>{switch(y(e,i)){case"hidden":return 1;case"scroll":return 1;case"visible":return 2}return 0},this.disconnect=()=>{this.mutationObserver.disconnect(),Object.keys(this.tree).forEach(i=>{const s=this.tree[i];!s||(this.removeObservers(s.element),this.resizeObserver.unobserve(s.element),delete this.tree[i])})},this.cmdQueue=t,this.actions.childList=this.onDomTreeChange.bind(this),this.actions.characterData=this.onAttrSize.bind(this),this.actions.attributes=this.onAttrSize.bind(this),window.addEventListener("gmhObservePositions",()=>{this.positionTimer&&(clearTimeout(this.positionTimer),this.positionTimer=null),this._any_change=!0,this.scrollEndCnt=5,Promise.resolve().then(this._bind_followViewElements)})}observe(t){this.rootElement||(this._any_change=!0,this.rootElement=t,this.invalidate(),this.mutationObserver.observe(this.rootElement,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style","class"]}))}invalidate(){if(!this._any_change)return;if(!this.rootElement)throw new Error("this.rootElement is null");this.tree={},this.scrollEndCnt=0;const t=this.buildTree(this.rootElement);if(!t)throw new Error("partTree is null");this._any_change=!1;const e=t.parent?t.parent.id:"";this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:e,t:t.toJSON()}],"invalidate"],{sync:!0})}updateDomRect(t){!t.element||(t.rect=K(t.element),t.children.forEach(this.updateDomRect.bind(this)))}removeObservers(t){if(t instanceof HTMLElement){const i=t.__pluginDomId;if(i){const s=this.tree[i];s&&(s.parent=null),delete this.tree[i],Reflect.deleteProperty(t,"__pluginDomId"),Reflect.deleteProperty(t,"__isShadowChildren")}}t.removeEventListener("scroll",this._bind_onScroll),t.removeEventListener("transitionstart",this._bind_onScroll),t.removeEventListener("transitionrun",this._bind_onScroll),t.removeEventListener("transitionend",this._bind_onScroll),t.removeEventListener("transitioncancel",this._bind_onScroll),this.resizeObserver.unobserve(t);let e=[];t instanceof HTMLSlotElement?e=Array.prototype.slice.call(t.assignedElements()):t.shadowRoot?e=Array.prototype.slice.call(t.shadowRoot.children,0):e=Array.prototype.slice.call(t.children,0),e.forEach(i=>{this.removeObservers(i)})}buildTree(t){if(!t||!Yt(t))return null;t.__pluginDomId===void 0&&(this.resizeObserver.observe(t),t.addEventListener("scroll",this._bind_onScroll),t.addEventListener("transitionstart",this._bind_onScroll),t.addEventListener("transitionrun",this._bind_onScroll),t.addEventListener("transitionend",this._bind_onScroll),t.addEventListener("transitioncancel",this._bind_onScroll));const e=P(t);let i=null;e in this.tree&&(i=this.tree[e],i.element!==t&&(delete this.tree[e],i=null)),i||(i=new xt(t)),i.zIndex=this.zManager.getZIndex(t),i.pointerEvents=y(t,"pointer-events")==="none"?0:1,i.overflowX=this.overflowCssToNumber(t,"overflow-x"),i.overflowY=this.overflowCssToNumber(t,"overflow-y");const s=K(t),o=[];let r=[];return t instanceof HTMLSlotElement?r=Array.prototype.slice.call(t.assignedElements()):t.shadowRoot&&t.shadowRoot.children.length>0?r=Array.prototype.slice.call(t.shadowRoot.children,0):r=Array.prototype.slice.call(t.children,0),r.forEach((a,h)=>{const l=a.tagName;if(l.startsWith("g-")&&!l.endsWith("view"))return;const d=this.buildTree(a);d&&(d.parent=i,o.push(d))}),i.rect=s,i.children=o,this.tree[e]=i,i}onDomScroll(t){if(this._any_change=!0,this.isScrollEventProcessing){this.positionTimer=setTimeout(this._bind_followViewElements,20);return}this.positionTimer&&(clearTimeout(this.positionTimer),this.positionTimer=null),this.scrollEndCnt=5,this.isScrollEventProcessing=!0;const e=t.target;if(!(P(e)in this.tree)){this.isScrollEventProcessing=!1,this.positionTimer=setTimeout(this._bind_followViewElements,20);return}const s=this.buildTree(e);if(!s||!s.zIndex)return;const o=s.parent?s.parent.id:P(s.element.parentElement);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:o,t:s.toJSON()}],"onDomScroll"],{sync:!1}).then(()=>{this.isScrollEventProcessing=!1,this.positionTimer=setTimeout(this._bind_followViewElements,20)})}onDomResize(t){this._any_change=!0;const e=[],i=new Set;if(t.forEach(s=>{if(s.target.nodeType!==Node.ELEMENT_NODE||s.target instanceof SVGElement)return;const o=s.target,r=P(o);if(!(r in this.tree)||i.has(r))return;const a=this.buildTree(o);if(!a||!a.zIndex)return;const h=a.parent?a.parent.id:P(a.element.parentElement);i.has(h)||(i.add(r),e.push({p:h,t:a.toJSON()}))}),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e.splice(0,3),"onDomResize"]);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e,"onDomResize"],{sync:!1})}}onDomTreeChange(t){if(this._any_change=!0,t.addedNodes&&t.addedNodes.length>0){const e=[];if(t.addedNodes.forEach(i=>{if(i.nodeType!==Node.ELEMENT_NODE)return;const s=i,o=s.parentElement;if(!o)return;const r=P(s);let a=null;if(r in this.tree&&(a=this.tree[r]),a||(a=this.buildTree(o)),!a||!a.zIndex)return;const h=a.parent?a.parent.id:P(a.element.parentElement);e.push({p:h,t:a.toJSON()})}),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e.splice(0,3),"onDomTreeChange"]);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e,"onDomTreeChange"],{sync:!1})}}if(t.removedNodes&&t.removedNodes.length>0){const e=[];if(t.removedNodes.forEach(i=>{if(i.nodeType!==Node.ELEMENT_NODE)return;const s=i;this.removeObservers(s);const o=s.__pluginDomId;if(!o)return;const r=this.tree[o];let a="";r&&r.parent&&(a=r.parent.id+"",a&&a in this.tree&&(r.parent.children=this.tree[a].children.filter(h=>r!==h)),r.parent=null),e.push({p:a,i:o}),this.removeDomIdFromGMH(s)}),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","removeFromDomTree",e.splice(0,3));this.cmdQueue.execPromise("GoogleMaps","removeFromDomTree",e,{sync:!0})}}}removeDomIdFromGMH(t){if(!t)return;const e=t.__pluginDomId;e&&(delete window.gmh.elements[e],Array.from(t.children).forEach(this._bind_removeDomIdFromGMH))}onAttrSize(t){if(this._any_change=!0,t.target.nodeType!==Node.ELEMENT_NODE)return;const e=t.target,i=e.__pluginDomId;if(!i)return;if(y(e,"transform")!=="none")e.dispatchEvent(me("gmhObservePositions"));else{const o=this.buildTree(e),r=this.tree[i];if(!r||!o||r.equals(o))return;const a=o.parent?o.parent.id:P(o.element.parentElement);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:a,t:o.toJSON()}],"onAttrSize"],{sync:!1})}}followViewElements(){this.scrollEndCnt===0?this.invalidate():(this.scrollEndCnt-=1,this.positionTimer=setTimeout(this._bind_followViewElements,20))}mutationListener(t,e){t.forEach(i=>{this.actions[i.type].call(this,i)})}}const ct=n=>{if(!n||typeof n!="string")return!1;if(n[0]==="#")return!!(/^#[0-9A-F]{3}$/i.test(n)||/^#[0-9A-F]{4}$/i.test(n)||/^#[0-9A-F]{6}$/i.test(n)||/^#[0-9A-F]{8}$/i.test(n));if(n.includes("rgba")){const t=n.match(/^rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*((?:(?:0+)|1)\.[0-9]+)\s*\)$/i);return!(t==null||t.length!==5||parseInt(t[1],10)<0||parseInt(t[1],10)>255||parseInt(t[2],10)<0||parseInt(t[2],10)>255||parseInt(t[3],10)<0||parseInt(t[3],10)>255||parseFloat(t[4])<0||parseFloat(t[4])>1)}if(n.includes("rgb")){const t=n.match(/^rgb\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\)$/i);return!(t==null||t.length!==4||parseInt(t[1],10)<0||parseInt(t[1],10)>255||parseInt(t[2],10)<0||parseInt(t[2],10)>255||parseInt(t[3],10)<0||parseInt(t[3],10)>255)}return n=n.toLowerCase(),n in Ct},j=(n,t=1)=>{if(!ct(n))throw new Error(`"${n}" is unknown color value`);if(typeof t!="number"||t<0||t>1)throw new Error("The second argument of HTMLColor2RGBA() must be a value from 0.0 to 1.0");let e=Math.floor(255*t),i=n.toLowerCase();i in Ct&&(i=Ct[i]);let s;if(i[0]==="#"&&i.length===4){if(s=i.match(/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i),s){const o=parseInt(s[1],16),r=parseInt(s[2],16),a=parseInt(s[3],16);return[(o<<4)+o,(r<<4)+r,(a<<4)+a,e]}throw new Error(`Can not parse color: ${n}`)}if(i[0]==="#"&&i.length===5){if(s=i.match(/^#([0-9A-F])([0-9A-F])([0-9A-F])([0-9A-F])$/i),s){const o=parseInt(s[1],16),r=parseInt(s[2],16),a=parseInt(s[3],16),h=parseInt(s[4],16);return[(o<<4)+o,(r<<4)+r,(a<<4)+a,(h<<4)+h]}throw new Error(`Can not parse color: ${n}`)}if(i[0]==="#"&&i.length===7){if(s=i.match(/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i),s){const o=parseInt(s[1],16),r=parseInt(s[2],16),a=parseInt(s[3],16);return[o,r,a,e]}throw new Error(`Can not parse color: ${n}`)}if(i[0]==="#"&&i.length===9){if(s=i.match(/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i),s){const o=parseInt(s[1],16),r=parseInt(s[2],16),a=parseInt(s[3],16),h=parseInt(s[4],16);return[o,r,a,h]}throw new Error(`Can not parse color: ${n}`)}if(i.match(/^rgba?\([\d,.\s]+\)$/)){if(s=i.match(/([\d.]+)/g),!s){const o=btoa(JSON.stringify({case:"Can not parse color information correctly",colorStr:i}));throw new Error(`Please report this error message: ${o}`)}return e=s.length===4?Math.floor(parseFloat(s[3])*255):e,[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10),e]}throw new Error(`Can not parse color: ${n}`)};class Pt extends O{static get observedAttributes(){return["class","id"]}constructor(){super(),this._hasMap=!1,this._parentView=null,this._execQueue=new L,this._bind_onExecute=()=>this._onExecute(),this._bind_runExecute=()=>this._runExecute(),this._bind_applyOptions=()=>this._applyOptions(),this._bind_onPropertyChanged=t=>this._onPropertyChanged(t),this._bind_redraw=()=>this.onRedraw(),this._exec_delay_timer=null,this.setAttributeChangeListener("class",this._bind_redraw),this.setAttributeChangeListener("id",this._bind_redraw)}onRedraw(){}getVisible(){return this.state.get("visible")}setVisible(t){this.state.set("visible",t===!0)}setHasMap(t){this._hasMap=t}get hasMap(){return this._hasMap}setParentView(t){this._parentView=t,t&&(t.ready?this._runExecute():t.addEventListener("ready",this._bind_runExecute,{once:!0}))}_runExecute(){this._execQueue.dispatchEvent(new CustomEvent("insert_at"))}get parentView(){return this._parentView}_onPropertyChanged(t){const e=t.detail.key,i=t.detail.value,s=this.state.get("waitOptions")||{};s[e]=i,this.state.set("waitOptions",s);const o=this.state.get("propEventTimer");o!==void 0&&clearTimeout(o),this.state.set("propEventTimer",setTimeout(this._bind_applyOptions,100))}_applyOptions(){if(!this.isConnected||this.initStatus!==u.VIEW_CREATED){const e=this.state.get("propEventTimer");e!==void 0&&clearTimeout(e),this.state.set("propEventTimer",setTimeout(this._bind_applyOptions,100));return}const t=this.state.get("waitOptions")||{};Object.keys(t).length!==0&&(this.state.set("waitOptions",{}),this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},t]))}execPromise(t,e,i=[],s={}){return this.isRemoved?Promise.reject(`<${this.tagName} __pluginDomId="${this.viewId}"> has been already removed`):new Promise((o,r)=>{const a={pluginName:t,methodName:e,args:i,execOptions:s,onSuccess:o,onError:r};if(this.initStatus<u.VIEW_CREATED&&t==="GoogleMaps"){this.dispatchCmdEvent([a]);return}this._execQueue.push({pluginName:t,methodName:e,args:i,execOptions:s,onSuccess:o,onError:r})})}_onExecute(){if(!this.hasEventListener("command"))return;if(this._exec_delay_timer===null){this._exec_delay_timer=setTimeout(this._bind_onExecute,10);return}let t=[];for(;this._execQueue.getLength()>0;){const e=this._execQueue.removeAt(0,!0);!e||(e.execOptions.sync?(this.dispatchCmdEvent(t),t=[],this.dispatchCmdEvent([e])):t.push(e))}this.dispatchCmdEvent(t),this._exec_delay_timer=null}dispatchCmdEvent(t=[]){t.length>0&&!this.isRemoved&&this.dispatchEvent(new CustomEvent("command",{detail:t}))}remove(){super.remove(),this.setAttributeChangeListener("class",void 0),this.setAttributeChangeListener("id",void 0)}async onConnected(){await super.onConnected();let t=this.parentElement;for(;t;){if(t instanceof Qt){this.setParentView(t),this._execQueue.addEventListener("insert_at",this._bind_onExecute);return}t=t.parentElement}throw new Error("Overlay (marker, polygon, etc) must be under <mkg-mapview> tag")}async disconnectedCallback(){await super.disconnectedCallback(),this.setParentView(null),this.isRemoved||this._execQueue.removeEventListener("insert_at",this._bind_onExecute)}}const oe=n=>n instanceof Event&&"detail"in n,ut=n=>typeof n=="string"?n.toLowerCase()==="true":typeof n=="boolean"?n:!1,et=n=>{const t=n.split(",").map(s=>parseFloat(s));if(t.length!==2)throw new Error(`Can not parse latLng string: "${n}"`);const e=Math.max(-90,Math.min(90,t[0])),i=Math.max(-180,Math.min(180,t[1]));return{lat:e,lng:i}};class kt extends Pt{static get observedAttributes(){return["class","id","position"]}constructor(t){super(),this._bind_onPositionChangedFromNative=e=>this._onPositionChangedFromNative(e),this._bind_onPositionChanged=e=>this._onPositionChanged(e),this.state.set("position",{lat:0,lng:0}),this.state.set("visible",!0),this.state.set("draggable",!1),this.state.set("position",void 0),this.state.set("initOptions",t),this.state.set("propEventTimer",void 0)}_onPositionChanged(t){if(this.dispatchEvent(t),this._childLatLng){const e=t.detail;this._childLatLng.lat=e.value.lat,this._childLatLng.lng=e.value.lng}}onRedraw(){this.initStatus<u.VIEW_CREATED||this.applyOptionsToState()}getClickable(){return this.state.get("clickable")}setClickable(t){this.state.set("clickable",t===!0)}getDraggable(){return this.state.get("draggable")}setDraggable(t){this.state.set("draggable",t===!0)}applyOptionsToState(t){const e={visible:this.state.get("visible"),clickable:this.state.get("clickable"),dragable:this.state.get("dragable"),icon:this.state.get("icon"),position:this.state.get("position"),zIndex:this.state.get("zIndex"),extra:this.state.get("extra")};["visible","clickable","draggable"].forEach(r=>{const a=v(this,`mkg-${r}`);a!==void 0&&(e[r]=ut(a))});const i=v(this,"mkg-icon")+"";i&&(e.icon=this._normalizedIcon(i));const s=v(this,"mkg-z-index")+"";s!==""&&(e.zIndex=parseInt(s.replace(/[^\d].*$/g,""),10));const o=this.getAttribute("position");if(o&&(e.position=et(o)),t){if("extra"in t&&(e.extra=t.extra),typeof t.visible=="boolean"&&(e.visible=t.visible===!0),typeof t.clickable=="boolean"&&(e.clickable=t.clickable===!0),typeof t.draggable=="boolean"&&(e.draggable=t.draggable===!0),t.icon&&(e.icon=this._normalizedIcon(t.icon)),typeof t.zIndex=="number"){if(!Number.isInteger(t.zIndex))throw new Error("MarkerOptions.zIndex must be an integer value");e.zIndex=t.zIndex}t.position&&this.setPosition(t.position)}isNaN(e.zIndex)&&(e.zIndex=0),Object.keys(e).forEach(r=>{this.state.set(r,e[r])})}_onPositionChangedFromNative(t){if(!oe(t))return;const i=t.detail.latLng;this.state.set("position",i)}onCommandFromChildren(t){const e=t.detail;switch(e.methodName){case"setPosition":this.setPosition(e.latLng);break}}getPosition(){const t=this.state.get("position");return{lat:t.lat,lng:t.lng}}setPosition(t){if(w(t)){const e=this.state.get("position");Xt(e,t)||this.state.set("position",t)}else throw new Error("setPosition() accepts only ILatLng value")}_normalizedIcon(t){if(t){if(ct(t))return{type:"color",value:j(t)};if(/url\([\"']?([^\"']+)[\"']?\)/i.test(t)){const e=document.createElement("a");e.href=t.replace(/url\([\"']?([^\"']+)[\"']?\)/i,"$1");const i=`${e.protocol}//${e.host}${e.pathname}${e.search}`;return e.remove(),{type:"img",value:i}}}return{type:"color",value:j("red")}}_normalizedPosition(t){if(t instanceof p)return t.toJSON();if(w(t))return{lat:t.lat,lng:t.lng};if(typeof t=="string")return et(t);throw new Error(`Can not parse given value : ${t}`)}async onConnected(){if(await super.onConnected(),this.state.addEventListener("visible_changed",this._bind_onPropertyChanged),this.state.addEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.addEventListener("draggable_changed",this._bind_onPropertyChanged),this.state.addEventListener("icon_changed",this._bind_onPropertyChanged),this.state.addEventListener("position_changed",this._bind_onPropertyChanged),this.state.addEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.addEventListener("position_changed",this._bind_onPositionChanged),this.addEventListener("dragstart",this._bind_onPositionChangedFromNative),this.addEventListener("drag",this._bind_onPositionChangedFromNative),this.addEventListener("dragend",this._bind_onPositionChangedFromNative),this.hasMap||this.initStatus===u.VIEW_CREATING)return;this.setHasMap(!0);const t=Array.from(this.children).filter((e,i,s)=>(console.log(e,e instanceof p),e instanceof p));if(t.length>1)throw new Error("<mkg-marker> can have only one <mkg-latlng>");new Promise(e=>{let i=this.state.get("position");t.length===1&&(this._childLatLng=t[0],i=this._childLatLng.toJSON(),this.state.set("position",i));const s=this.state.get("initOptions");s&&s.position&&"position"in s&&s.position&&(w(s.position)?this.state.set("position",s.position):s.position instanceof p&&this.state.set("position",s.position.toJSON())),this.initStatus===u.NOT_READY?(this.initStatus=u.VIEW_CREATING,this.execPromise("(parent)","createMarker",[{id:this.viewId},{position:this.state.get("position"),visible:!1}]).then(e)):this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{position:this.state.get("position"),visible:!1}]).then(e)}).then(()=>this.execPromise("(parent)","attachOverlayToMap",[{id:this.viewId}])).then(()=>{this.initStatus=u.VIEW_CREATED;const e=v(this,"mkg-icon");e?(this.state.set("icon",e),this.state.set("calculatedIcon",this._normalizedIcon(e))):this.state.set("calculatedIcon",{type:"color",value:j("red")});const i=this.state.get("initOptions");this.applyOptionsToState(i),this.state.trigger("visible_changed",{key:"visible",prevValue:void 0,value:this.state.get("visible")}),this.state.set("initOptions",void 0)})}async onDisconnected(){await super.onDisconnected(),this.state.removeEventListener("visible_changed",this._bind_onPropertyChanged),this.state.removeEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("draggable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("icon_changed",this._bind_onPropertyChanged),this.state.removeEventListener("position_changed",this._bind_onPropertyChanged),this.state.removeEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.removeEventListener("position_changed",this._bind_onPositionChanged),this.removeEventListener("dragstart",this._bind_onPositionChangedFromNative),this.removeEventListener("drag",this._bind_onPositionChangedFromNative),this.removeEventListener("dragend",this._bind_onPositionChangedFromNative),this.hasMap&&this.initStatus===u.VIEW_CREATED&&this.execPromise("(parent)","detachOverlayFromMap",[{id:this.getId()}]).then(()=>{this.setHasMap(!1)})}}class re extends Pt{static get observedAttributes(){return["class","id","content"]}constructor(t=5){super(),this._frame=document.createElement("div"),this._contentBox=document.createElement("div"),this._bind_onPositionChanged=()=>this._onPositionChanged(),this._bind_onTargetDisconnected=()=>this.close(),this._bind_onStyleChanged=()=>{!this._canvas||(this.onClear(this._canvas),this.onCanvas(this._canvas),this._onPositionChanged())},this._binds={},this.platformId=window.mkgeeklab.googlemaps.getPlatformId(),this._target=null,this._slot=null,this._canvas=document.createElement("canvas"),this._isSafari=window.navigator.userAgent.includes("AppleWebKit"),this._options={padding:5,canvasSize:{width:0,height:0},contentSize:{width:0,height:0},anchorPosition:{x:0,y:0},contentPosition:{x:0,y:0},content:"",shapeType:"poly",tailSize:{width:10,height:15},shapeCoords:[]},this.DOMevents=["click","touchstart","touchend","mousedown","mouseup","mousemove"],this.assignedListeners=!1,this.isOpen=!1,this._options.padding=t,this._frame.style.position="relative",this._frame.style.display="block",this._frame.style.width="auto",this._frame.style.height="auto",this._frame.style.overflow="hidden",this._contentBox.style.position="relative",this._contentBox.style.left="0px",this._contentBox.style.top="0px",this._contentBox.style.display="inline-block",this._contentBox.style.padding="0px",this._contentBox.style.boxSizing="content-box",this._contentBox.style.minWidth="50px",this._contentBox.style.width="auto",this._contentBox.style.height="auto",this._contentBox.style.cursor="pointer",this._contentBox.style.userSelect="none",this._contentBox.style.pointerEvents="auto",this._canvas.width=900,this._canvas.height=900,this._canvas.style.position="absolute",this._canvas.style.zIndex="-1",this._canvas.style.left="0px",this._canvas.style.top="0px",this.setAttributeChangeListener("class",this._bind_onStyleChanged),this.setAttributeChangeListener("id",this._bind_onStyleChanged)}getPadding(){return this._options.padding}onCanvas(t){throw new Error("Please override the onCanvas method")}onContentMeasure(t,e){return{width:t,height:e}}getContentSize(){return{width:this._options.contentSize.width,height:this._options.contentSize.height}}onContentPosition(t,e){return{x:t,y:e}}getContentPosition(){return{x:this._options.contentPosition.x,y:this._options.contentPosition.y}}onAnchorPosition(t,e){return{x:t,y:e}}getAnchorPosition(){return{x:this._options.anchorPosition.x,y:this._options.anchorPosition.y}}onCanvasMeasure(t,e){return{width:t,height:e}}getCanvasSize(){return{width:this._options.canvasSize.width,height:this._options.canvasSize.height}}onTailSize(t,e){return{width:t,height:e}}getTailSize(){return{width:this._options.tailSize.width,height:this._options.tailSize.height}}addEventListener(t,e,i){let s=e._hashCode;if(s||(s=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:s,writable:!1,enumerable:!1})),this._binds[t]=this._binds[t]||{},this.DOMevents.indexOf(t)>-1){const o=r=>{const a=r;e(new MouseEvent(r.type,{screenX:a.screenX,screenY:a.screenY,clientX:a.clientX,clientY:a.clientY,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey,metaKey:a.metaKey,button:a.button,buttons:a.buttons,relatedTarget:this._canvas}))};this._binds[t][s]=o,this._frame.addEventListener(t,o,!0)}else this._binds[t][s]=e,super.addEventListener(t,e)}removeEventListener(t,e){if(t in this._binds){const i=e._hashCode;i&&i in this._binds[t]&&(t in this.DOMevents?this._frame.removeEventListener(t,this._binds[t][i]):super.removeEventListener(t,this._binds[t][i]),delete this._binds[t][i])}}onClear(t){const e=t.getContext("2d");!e||e.clearRect(0,0,t.width,t.height)}onDraw(){this._contentBox.parentElement!==null&&this._frame.removeChild(this._contentBox),this.style.overflow="visible",this._frame.innerHTML="",this._frame.appendChild(this._contentBox),this._frame.style.width="90vmax",this._frame.style.height="90vmax",this._contentBox.style.position="static",this._contentBox.style.width="auto",this._contentBox.style.height="auto",this._contentBox.style.padding="1px",this._frame.style.overflow="visible",typeof this._options.content=="string"?(this._contentBox.style.whiteSpace="pre-wrap",this._contentBox.innerHTML=this._options.content):this._options.content?this._options.content.nodeType===1?(this._contentBox.innerHTML="",this._contentBox.appendChild(this._options.content)):this._contentBox.innerText=`${this._options.content}`:this._contentBox.innerText="";const t=this._contentBox.offsetWidth,e=this._contentBox.offsetHeight;this._contentBox.style.padding="0px";const i=this.onContentMeasure(t,e);this._options.contentSize.width=i.width,this._options.contentSize.height=i.height;const s=this.onTailSize(this._options.tailSize.width,this._options.tailSize.height);this._options.tailSize.width=s.width,this._options.tailSize.height=s.height;const o=this.onCanvasMeasure(this._options.contentSize.width+this._options.padding*2,this._options.contentSize.height+this._options.padding*2+this._options.tailSize.height);this._options.canvasSize.width=o.width,this._options.canvasSize.height=o.height;const r=this.onContentPosition(this._options.padding,this._options.padding);this._options.contentPosition.x=r.x,this._options.contentPosition.y=r.y;const a=this.onAnchorPosition(this._options.canvasSize.width/2,this._options.canvasSize.height);this._options.anchorPosition.x=a.x,this._options.anchorPosition.y=a.y,this._frame.style.width=`${this._options.canvasSize.width}px`,this._frame.style.height=`${this._options.canvasSize.height}px`,this._frame.style.overflow="hidden",this.style.position="absolute",this.style.zIndex="-100000",this.style.width="1px",this.style.height="1px",this._frame.appendChild(this._canvas),this._options.shapeCoords=[],this.onClear(this._canvas),this.onCanvas(this._canvas),this._contentBox.style.position="absolute",this._contentBox.style.left=`${this._options.contentPosition.x}px`,this._contentBox.style.top=`${this._options.contentPosition.y}px`,this._contentBox.style.width=`${this._options.contentSize.width}px`,this._contentBox.style.height=`${this._options.contentSize.height}px`,this.style.position="absolute",this.style.zIndex="1",this.style.width="0px",this.style.height="0px",this.style.left="0px",this.style.top="0px",this.style.visibility="visible"}get content(){return this._options.content}set content(t){this.setContent(t)}setContent(t){t==null&&(t=""),this._options.content!==t&&(this._options.content=t,this.isOpen&&this.onDraw())}getContent(){return this._options.content}async open(t){if(!t||!(t instanceof kt))return;this.isOpen=!0,t.ready||await new Promise(i=>{t.addEventListener("ready",()=>i(),{once:!0})}),this.parentView||await new Promise(i=>{this.initStatus=u.VIEW_CREATING,this.addEventListener("ready",()=>{this.setHasMap(!0),i()},{once:!0})}),this._target=t;const e=this.parentView;if(!this._slot){const i=e.getShadowRoot();this._slot=document.createElement("slot");const s=i.querySelector("div.info_layer");s&&s.appendChild(this._slot),this._isSafari?(this._slot.name=this.viewId,this.setAttribute("slot",this.viewId)):this._slot.assign(this)}this.onDraw(),this._onPositionChanged(),this.assignedListeners||(this.assignedListeners=!0,e.addEventListener("camera_move",this._bind_onPositionChanged),e.addEventListener("resize",this._bind_onPositionChanged),this._target.addEventListener("position_changed",this._bind_onPositionChanged),this._target.addEventListener("isConnected_changed",this._bind_onTargetDisconnected)),window.dispatchEvent(new Event("gmhObservePositions"))}close(){const t=this.parentView;if(!this._slot||!this._target||!this.isOpen||!t)return;this.dispatchEvent(new Event("close"));const e=t.getShadowRoot();this.assignedListeners=!1,t.removeEventListener("bounds_changed",this._bind_onPositionChanged),t.removeEventListener("resize",this._bind_onPositionChanged),this._target.removeEventListener("position_changed",this._bind_onPositionChanged),this._target.removeEventListener("isConnected_changed",this._bind_onTargetDisconnected);const i=e.querySelector(".info_layer");i&&i.removeChild(this._slot),this._isSafari?this.removeAttribute("slot"):this._slot.assign(),this._slot=null,this._target=null,window.dispatchEvent(new Event("gmhObservePositions")),this.isOpen=!1,this._options.content=void 0}_onInfoClick(t){this.dispatchEvent(t)}_onPositionChanged(){if(!this._target){this.close();return}const t=this._target.getPosition(),e=this.parentView;if(!e)return;const i=e.fromLatLngToContainerPixel(t);if(!i){this.style.visibility="hidden";return}const s={x:I(parseFloat(v(this._target,"g-anchor-point-x")||"0.5"),0,1),y:I(parseFloat(v(this._target,"g-anchor-point-y")||"0.2"),0,1)},o={x:I(parseInt(v(this._target,"g-icon-width")||"42",10),1,64),y:I(parseInt(v(this._target,"g-icon-height")||"42",10),1,64)};let r=1;if(this.platformId===b.ANDROID||this.platformId===b.IOS){const h=e.offsetHeight,l=i.y-h/2,d=e.getTilt()*(Math.PI/180),c=1625,f=c*c+l*l;r=(c+l*Math.tan(d))/Math.sqrt(f);const m=this._options.anchorPosition.x;this._options.anchorPosition.y,this.style.transformOrigin=`${m} ${m}`,this.style.transform=`scale(${r})`}const a={x:-(o.x*(.5-s.x))-this._options.anchorPosition.x,y:-(o.y*(1-s.y))*r-this._options.anchorPosition.y};this._frame.style.left=`${a.x}px`,this._frame.style.top=`${a.y}px`,this.style.left=`${i.x}px`,this.style.top=`${i.y}px`,(this.platformId===b.ANDROID||this.platformId===b.IOS)&&window.dispatchEvent(new Event("gmhObservePositions")),this.dispatchEvent(new Event("close"))}async onConnected(){if(await super.onConnected(),this.appendChild(this._frame),this.hasAttribute("content")){const t=this.getAttribute("content");t&&this.setContent(t)}this.initStatus=u.VIEW_CREATED,this.setHasMap(!0)}async onDisconnected(){await super.onDisconnected(),this.setHasMap(!1),this.removeChild(this._frame)}}class ae extends re{onContentMeasure(t,e){let i=t;return v(this,"g-max-width")&&(i=parseFloat(v(this,"g-max-width"))),{width:I(t,0,i),height:e}}onCanvas(t){const e=this.getCanvasSize(),i=e.width,s=e.height,o=t.getContext("2d");if(!o)throw new Error("Could not get the canvas context");const r=this.getContentSize(),a=this.getPadding(),h=r.height+a*2,l=i/2,d=s,f=this.getTailSize().width;o.beginPath();const g=y(this,"background-color");let m="white";ct(g)&&j(g)[3]>0&&(m=g),o.fillStyle=m;const k=y(this,"border-color");o.strokeStyle=ct(k)?k:"black";const C=y(this,"border-width");let S=1;/^\d+(\s*?px)?$/.test(C)&&(S=parseInt(C.replace(/[^\d]/g,""),10)),o.lineWidth=S;const _=10;o.moveTo(_,0),o.shadowColor="rgba(0, 0, 0, 0.5)",o.shadowOffsetX=5,o.shadowOffsetY=5,o.shadowBlur=5,o.lineTo(i-_,0),o.quadraticCurveTo(i,0,i,_),o.lineTo(i,h-_),o.quadraticCurveTo(i,h,i-_,h),o.lineTo(l+_+f/2,h),o.lineTo(l,d),o.lineTo(l-_-f/2,h),o.lineTo(_,h),o.quadraticCurveTo(0,h,0,h-_),o.stroke(),o.shadowColor="transparent",o.shadowBlur=0,o.lineTo(0,_),o.quadraticCurveTo(0,0,_,0),o.fill(),o.stroke(),o.closePath()}}const X=n=>!!n&&"southWest"in n&&"northEast"in n&&"lat"in n.southWest&&typeof n.southWest.lat=="number"&&"lng"in n.southWest&&typeof n.southWest.lng=="number"&&"lat"in n.northEast&&typeof n.northEast.lat=="number"&&"lng"in n.northEast&&typeof n.northEast.lng=="number",J=n=>!!n&&"north"in n&&typeof n.north=="number"&&"east"in n&&typeof n.east=="number"&&"west"in n&&typeof n.west=="number"&&"south"in n&&typeof n.south=="number",ft=n=>{if(!n)throw new Error("The first argument of toILatLngBounds() can not be null");if(J(n)){const t=n;return{northEast:{lat:t.north,lng:t.east},southWest:{lat:t.south,lng:t.west}}}else if(X(n)){const t=n;return{northEast:{lat:t.northEast.lat,lng:t.northEast.lng},southWest:{lat:t.southWest.lat,lng:t.southWest.lng}}}else if(n instanceof E){const t=n,e=t.getSouthWest(),i=t.getNorthEast();return{northEast:{lat:i.lat,lng:i.lng},southWest:{lat:e.lat,lng:e.lng}}}else{if(Array.isArray(n))return new E(n).toJSON();if(typeof n=="string"){const t=n.split(","),e=t.filter(s=>/[\-\+]?\d+(?:\.\d+)?/.test(s));if(t.length!==e.length)throw new Error(`Can not parse latLngBounds string: "${n}"`);const i=e.map(s=>et(s));return new E(i).toJSON()}}throw new Error("Can not convert to ILatLngBounds")};class E{constructor(t,e){if(this.northEast=void 0,this.southWest=void 0,this.beyond0=!1,this.beyond180=!1,!!t){if(J(t)||X(t)||t instanceof E){const i=ft(t);this.northEast={lat:i.northEast.lat,lng:i.northEast.lng},this.southWest={lat:i.southWest.lat,lng:i.southWest.lng}}else(t instanceof p||w(t))&&(e instanceof p||w(e))?(this.southWest=G(t),this.northEast=G(e)):Array.isArray(t)&&t.forEach(s=>{this.extend(s)});this.isEmpty()||(this.beyond0=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng,this.beyond180=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng)}}toString(){if(this.isEmpty())return"((1, 180), (-1, -180))";const t=this.toJSON();return`((${t.south}, ${t.west}), (${t.north}, ${t.east}))`}isEmpty(){return!this.southWest&&!this.northEast}toJSON(){return this.isEmpty()?{east:-180,north:-1,south:1,west:180}:{east:this.northEast.lng,north:this.northEast.lat,south:this.southWest.lat,west:this.southWest.lng}}toUrlValue(t=6){return this.isEmpty()?[1,180,-1,-180].join(","):[$(this.southWest.lat,t),$(this.southWest.lng,t),$(this.northEast.lat,t),$(this.northEast.lng,t)].join(",")}extend(t){if(!t||!("lat"in t&&"lng"in t))return;const e=G(t);if(this.isEmpty())this.southWest=e,this.northEast=e,this.beyond0=this.southWest.lng<0&&this.northEast.lng>0||this.southWest.lng>this.northEast.lng,this.beyond180=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng;else{const i=Math.min(e.lat,this.southWest.lat),s=Math.max(e.lat,this.northEast.lat);let o=this.northEast.lng,r=this.southWest.lng;const a=o>0,h=r>0,l=e.lng>0;let d=0,c=0,f=0;if(this.contains(e))return;let g=!1;if(this.beyond180?g=e.lng>=r&&e.lng<=180||e.lng<=o&&e.lng>=-180:g=e.lng>=r&&e.lng<=o,!g)if(h&&a&&!l&&!this.beyond0&&!this.beyond180||!h&&a&&!l&&this.beyond0&&!this.beyond180||!h&&!a&&!l&&e.lng<r&&!this.beyond0&&!this.beyond180||h&&a&&l&&e.lng<r&&!this.beyond0&&!this.beyond180?(d=180-o+(e.lng+180),c=r-e.lng,f=1):h&&!a&&!l&&!this.beyond0&&this.beyond180?(d=e.lng-o,c=r-e.lng,f=2):!h&&!a&&!l&&this.beyond0||a&&h&&l&&this.beyond0&&this.beyond180||!a&&h&&l&&!this.beyond0&&this.beyond180?(d=e.lng-o,c=r-e.lng,f=3):(h&&a&&l&&e.lng>o&&!this.beyond0&&!this.beyond180||a&&!h&&l&&this.beyond0&&!this.beyond180||!a&&!h&&l&&!this.beyond0&&!this.beyond180||!a&&!h&&!l&&e.lng>o&&!this.beyond0&&!this.beyond180)&&(d=e.lng-o,c=180+r+(180-e.lng),f=4),f>0)d<c?o=e.lng:r=e.lng;else{const m=btoa(JSON.stringify({case:"LatLngBounds.extends did not match",bounds:this.toUrlValue(),target:e.lng,beyond0:this.beyond0,beyond180:this.beyond180}));throw new Error(`[LatLngBounds.extend] Please report this error message: "${m}"`)}this.southWest={lat:i,lng:r},this.northEast={lat:s,lng:o},this.beyond0=this.beyond0||r<0&&o>0||this.southWest.lng>this.northEast.lng,this.beyond180=this.beyond180||r>0&&o<0||this.southWest.lng>this.northEast.lng}}equals(t){if(!t)return!1;const e={south:-999,north:-999,east:-999,west:-999};if(t instanceof E){const i=t,s=i.getSouthWest(),o=i.getNorthEast();e.south=s.lat,e.west=s.lng,e.north=o.lat,e.east=o.lng}else if(X(t)){const i=t;e.south=i.southWest.lat,e.west=i.southWest.lng,e.north=i.northEast.lat,e.east=i.northEast.lng}else if(J(t)){const i=t;e.south=i.south,e.west=i.west,e.north=i.north,e.east=i.east}else return!1;return this.southWest.lat===e.south&&this.southWest.lng===e.west&&this.northEast.lat===e.north&&this.northEast.lng===e.east}contains(t){if(!t||!("lat"in t)||!("lng"in t))return!1;const e=G(t),i=e.lat<=this.northEast.lat&&e.lat>=this.southWest.lat,s=this.northEast.lng,o=this.southWest.lng;let r=!1;return this.beyond180?r=e.lng>=o&&e.lng<=180||e.lng<=s&&e.lng>=-180:r=e.lng>=o&&e.lng<=s,i&&r}getCenter(){if(this.isEmpty())return new p(0,-180);const t=this.beyond180?this.northEast.lng:this.southWest.lng,e=this.beyond180?this.southWest.lng:this.northEast.lng;let i;if(this.beyond180){const o=(180-t+(180+e))/2;i=t+o,i=i>180?-180+(i-180):i}else i=(this.southWest.lng+this.northEast.lng)/2;const s=(this.southWest.lat+this.northEast.lat)/2;return new p(s,i)}union(t){if(!t)return this.isEmpty()?new E:new E(this.southWest,this.northEast);if(!X(t)&&!J(t)&&!(t instanceof E))throw new Error("[LatLng.union] unknown type data was given.");const e=ft(t);return this.isEmpty()?new E(e.southWest,e.northEast):(this.extend(e.southWest),this.extend(e.northEast),this)}getSouthWest(){return new p(this.southWest.lat,this.southWest.lng)}getNorthEast(){return new p(this.northEast.lat,this.northEast.lng)}toSpan(){return this.isEmpty()?new p(0,0):new p(this.northEast.lat-this.southWest.lat,(this.northEast.lng-this.southWest.lng+360)%360||360)}intersects(t){let e;if(this.isEmpty())return!1;if("north"in t&&"east"in t&&"west"in t&&"south"in t){const i=t;e={north:i.north,east:i.east,south:i.south,west:i.west}}else if("northEast"in t&&"southWest"in t){const i=t;e={north:i.northEast.lat,east:i.northEast.lng,south:i.southWest.lat,west:i.southWest.lng}}else if(t instanceof E){const i=t;if(i.isEmpty())return!1;const s=i.getNorthEast(),o=i.getSouthWest();e={north:s.lat,east:s.lng,south:o.lat,west:o.lng}}else return!1;return this.contains({lat:e.south,lng:e.west})||this.contains({lat:e.south,lng:e.east})||this.contains({lat:e.north,lng:e.west})||this.contains({lat:e.north,lng:e.east})}}const V={ROADMAP:"roadmap",HYBRID:"hybrid",SATELLITE:"satellite",TERRAIN:"terrain",NONE:"none"},Zt=(n,t,e)=>{if(t>e){const s=e;e=t,t=s}const i=e-t;return n-=Math.floor((n-t)/i)*i,n>e?n-=i:n<t&&(n+=i),n},Ht=0,Ve=30;class $e extends Qt{static get observedAttributes(){return["center","zoom","maptype","tilt","heading","class","id"]}constructor(t={}){if(super(),this.nativeEvent2apiEvent={"camera:move:start":"camera_move_start","camera:move":"camera_move","camera:move:end":"camera_move_end",dragging:"drag","drag:end":"drag_end","drag:start":"drag_start","tiles:loaded":"tiles_loaded"},this._bind_onMvcChanged=i=>this._onMvcChanged(i),this._bind_onCameraPropertyChanged=()=>this._onCameraPropertyChanged(),this._bind_updateCameraParams=()=>this.updateCameraParams(),this._mat=[],this._inv=[],this.state.set("maptype",V.NONE,!0),this.state.set("center",{lat:0,lng:0},!0),this.state.set("zoom",0,!0),this.state.set("heading",0,!0),this.state.set("tilt",0,!0),this.state.set("northEast",{lat:0,lng:0},!0),this.state.set("southWest",{lat:0,lng:0},!0),this.state.set("farLeft",{lat:0,lng:0},!0),this.state.set("farRight",{lat:0,lng:0},!0),this.state.set("nearLeft",{lat:0,lng:0},!0),this.state.set("nearRight",{lat:0,lng:0},!0),this.state.set("minZoom",Ht,!0),this.state.set("maxZoom",Ve,!0),this.state.set("building",!0,!0),this.state.set("clickableIcons",!1,!0),t){if("mapType"in t&&t.mapType&&this.state.set("maptype",this._normalizedMapType(t.mapType)),"camera"in t&&t.camera&&this.state.set("initCamera",t.camera),"preferences"in t&&t.preferences){const i=t.preferences;"minZoom"in i&&typeof i.minZoom=="number"&&this.state.set("minZoom",this._normalizedMinZoom(t.preferences.minZoom)),"maxZoom"in i&&typeof i.maxZoom=="number"&&this.state.set("maxZoom",this._normalizedMaxZoom(t.preferences.maxZoom)),"building"in i&&this.state.set("building",i.building===!0),"clickableIcons"in i&&this.state.set("clickableIcons",i.clickableIcons===!0),"restriction"in i&&this.state.set("restriction",this._normalizedRestriction(t.preferences.restriction))}"controls"in t&&t.controls&&t.controls,"gestures"in t&&t.gestures,"styles"in t&&t.styles}this.state.set("cameraEventTimer",void 0),this.state.addEventListener("bounds_changed",this._bind_onMvcChanged),this.state.addEventListener("center_changed",this._bind_onMvcChanged),this.state.addEventListener("tilt_changed",this._bind_onMvcChanged),this.state.addEventListener("heading_changed",this._bind_onMvcChanged),this.state.addEventListener("zoom_changed",this._bind_onMvcChanged),this.template.innerHTML=`
      <style>
      :host {
        position: relative;
        display: block;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        overflow: hidden;
      }
      .info_layer {
        position: absolute;
        width: 0px;
        height: 0px;
        left: 0px;
        top: 0px;
        color: black;
        pointer-events: none;
        text-align: left;
      }
      .contents_layer {
        position: relative;
        z-index: 20;
      }
      </style>
      <div class='info_layer' id='info_layer'></div>
      <div class='contents_layer'><slot name='contents'></slot></div>
    `,this.shadow.appendChild(this.template.content.cloneNode(!0));const e=window.mkgeeklab.googlemaps.getPlatformId();(e===b.ANDROID||e===b.IOS)&&this.addEventListener("tiles:loaded",this._onTilesLoadeFromNative.bind(this)),this.addEventListener("camera:move",this._onCameraChangedFromNative.bind(this)),this.addEventListener("camera:move:end",this._onCameraChangedFromNative.bind(this))}_onMvcChanged(t){this.dispatchEvent(t)}_onCameraPropertyChanged(){let t=this.state.get("cameraEventTimer");t!==void 0&&clearTimeout(t),t=setTimeout(this._bind_updateCameraParams,100)}updateCameraParams(){this.state.set("cameraEventTimer",void 0);const t={camera:{target:[this.state.get("center")],zoom:this.state.get("zoom"),tilt:this.state.get("tilt"),heading:this.state.get("heading")}};this.isConnected&&this.initStatus===u.VIEW_CREATED&&this.execPromise(this.viewId,"setOptions",[t])}_normalizedMinZoom(t){return t==null?2:(typeof t=="string"&&(t=parseInt(t,10)),typeof t=="number"?I(t,2,30):2)}_normalizedMaxZoom(t){return t==null?30:(typeof t=="string"&&(t=parseInt(t,10)),typeof t=="number"?I(t,2,30):30)}_normalizedBuilding(t){return t==null?ut(v(this,"g-pref-building")):t===!0}_normalizedClickableIcons(t){return t==null?ut(v(this,"g-pref-clickable-icons")):t===!0}_normalizedRestriction(t){return t==null?ft(v(this,"g-pref-restriction")):ft(t)}_normalizedCenter(t){if(t instanceof p)return t.toJSON();if(w(t))return{lat:t.lat,lng:t.lng};if(typeof t=="string")return et(t);throw new Error(`Can not parse given value : ${t}`)}_normalizedZoom(t){return t==null?this.state.get("minZoom"):(typeof t=="string"&&(t=parseInt(t,10)),I(t,this.state.get("minZoom"),this.state.get("maxZoom")))}_normalizedTilt(t){return t==null?0:(typeof t=="string"&&(t=parseInt(t,10)),I(t,0,90))}_normalizedHeading(t){return t==null?0:(typeof t=="string"&&(t=parseInt(t,10)||0),t<0&&(t=t+360),t%360)}_normalizedMapType(t){return t?(t=t.toLowerCase(),t=t==="roadmap"||t==="hybrid"||t==="satellite"||t==="terrain"||t==="none"?t:"roadmap",t):"roadmap"}convertToCameraParams(t){if(!t)return{padding:0};const e={padding:10},i=[];if(Array.isArray(t.target)){const s=new E(t.target);i.push(s.getNorthEast().toJSON()),i.push(s.getSouthWest().toJSON())}else if(t.target instanceof p)i.push(t.target.toJSON());else if(w(t.target))i.push(t.target);else if(t.target instanceof E){const s=t.target;i.push(s.getNorthEast().toJSON()),i.push(s.getSouthWest().toJSON())}else if(X(t.target)){const s=new E(t.target);i.push(s.getNorthEast().toJSON()),i.push(s.getSouthWest().toJSON())}else if(J(t.target)){const s=new E(t.target);i.push(s.getNorthEast().toJSON()),i.push(s.getSouthWest().toJSON())}return i.length>0&&(e.target=i,i.length>1?typeof t.padding=="number"&&(e.padding=Math.max(0,t.padding)):typeof t.zoom=="number"&&(e.zoom=t.zoom)),typeof t.tilt=="number"&&(e.tilt=t.tilt),typeof t.heading=="number"&&(e.heading=t.heading),typeof t.duration=="number"&&(e.duration=t.duration),e}moveCamera(t){if(!t)return Promise.resolve();const e=this.convertToCameraParams(t);return this.execPromise(this.viewId,"moveCamera",[e])}get maptype(){return this.state.get("maptype")}set maptype(t){t==null?(this.removeAttribute("maptype"),this.state.set("maptype","none")):this.state.set("maptype",this._normalizedMapType(t))}getHeading(){return this.state.get("heading")}setHeading(t){if(typeof t=="number")t<0&&(t=t+360),this.state.set("heading",t%360),Promise.resolve().then(this._bind_onCameraPropertyChanged);else throw new Error("setHeading() accepts a number")}get heading(){return this.state.get("heading")}set heading(t){t==null?(this.removeAttribute("heading"),this.state.set("heading",0)):t!==this.state.get("heading")&&(this.state.set("heading",this._normalizedHeading(t)),Promise.resolve().then(this._bind_onCameraPropertyChanged))}getTilt(){return this.state.get("tilt")}setTilt(t){if(typeof t=="number")this.state.set("tilt",I(t,0,90)),Promise.resolve().then(this._bind_onCameraPropertyChanged);else throw new Error("setTilt() accepts an integer number from 0 to 90")}get tilt(){return this.state.get("tilt")}set tilt(t){t==null?(this.removeAttribute("tilt"),this.state.set("tilt",0)):t!==this.state.get("tilt")&&(this.state.set("tilt",this._normalizedTilt(t)),Promise.resolve().then(()=>this._onCameraPropertyChanged()))}getCenter(){const t=this.state.get("center");return{lat:t.lat,lng:t.lng}}setCenter(t){if(t instanceof p)this.state.set("center",t.toJSON()),Promise.resolve().then(this._bind_onCameraPropertyChanged);else if(w(t))this.state.set("center",t),Promise.resolve().then(this._bind_onCameraPropertyChanged);else throw new Error("setCenter() accepts a value of ILatLng or LatLng")}get center(){return this.state.get("center")}set center(t){if(typeof t=="string")try{et(t)}catch{throw new Error('The center property must be formatted with "(latitude), (longitude)"')}t!==this.state.get("center")&&(this.state.set("center",this._normalizedCenter(t)),Promise.resolve().then(this._bind_onCameraPropertyChanged))}getZoom(){return this.state.get("zoom")}setZoom(t){if(typeof t=="number")this.state.set("zoom",I(t,this.state.get("minZoom"),this.state.get("maxZoom"))),Promise.resolve().then(this._bind_onCameraPropertyChanged);else throw new Error("setZoom() accepts from 2 to 30 interger")}get zoom(){return this.state.get("zoom")}set zoom(t){t==null?(this.removeAttribute("zoom"),this.state.set("zoom",this.state.get("minZoom"))):t!==this.state.get("zoom")&&(this.state.set("zoom",this._normalizedZoom(t)),Promise.resolve().then(()=>this._onCameraPropertyChanged()))}_onTilesLoadeFromNative(t){}_onCameraChangedFromNative(t){if(!oe(t))return;const i=t.detail;this._mat=i.mat,this._inv=i.inv,this.state.set("farLeft",i.farLeft),this.state.set("farRight",i.farRight),this.state.set("nearLeft",i.nearLeft),this.state.set("nearRight",i.nearRight),this.state.set("center",i.center),this.state.set("tilt",i.tilt),this.state.set("heading",i.heading),this.state.set("zoom",i.zoom),this.state.set("northEast",i.northEast),this.state.set("southWest",i.southWest),this.state.set("bounds",{northEast:i.northEast,southWest:i.southWest}),this.dispatchEvent(new CustomEvent(this.nativeEvent2apiEvent[t.type]))}fromContainerPixelToLatLng(t,e=!1){if(this._mat.length!==9)return;const i={x:t.x,y:t.y};i.x-=this.offsetWidth/2,i.y-=this.offsetHeight/2,i.x+=128,i.y+=128,i.x/=256,i.y/=256;const s=this.applyMatrix(i,this._mat),o=this.getProjection();return e!==!0&&(s.x=Zt(s.x,-128,128)),o.fromPointToLatLng(s,e)}fromLatLngToContainerPixel(t){if(this._inv.length!==9)return;const e=this.getProjection(),i=e.fromLatLngToPoint(t),s=e.fromLatLngToPoint(this.state.get("center"));i.x=Zt(i.x,s.x-128,s.x+128);const o=this.applyMatrix(i,this._inv);return o.x*=256,o.y*=256,o.x-=128,o.y-=128,{x:o.x+this.offsetWidth/2,y:o.y+this.offsetHeight/2}}applyMatrix(t,e){const i=e[6]*t.x+e[7]*t.y+e[8],s=(e[0]*t.x+e[1]*t.y+e[2])/i,o=(e[3]*t.x+e[4]*t.y+e[5])/i;return{x:s,y:o}}get bounds(){const t=this.state.get("northEast"),e=this.state.get("southWest");return new E(t,e)}get farLeft(){return this.state.get("farLeft")}get farRight(){return this.state.get("farRight")}get nearLeft(){return this.state.get("nearLeft")}get nearRight(){return this.state.get("nearRight")}get northEast(){return this.state.get("northEast")}get southWest(){return this.state.get("southWest")}_onRedrawMap(t){this.initStatus<u.VIEW_CREATED}addEventListener(t,e,i){t==="click"?super.addEventListener(t,s=>{s instanceof MouseEvent||e(s)},i):super.addEventListener(t,e,i)}async connectedCallback(){if(super.connectedCallback(),this.initStatus===u.VIEW_CREATING)return;const t={id:this.getId()};new Promise(e=>{let i=K(this),s=0;const o=setInterval(()=>{const r=K(this);if(i.left===r.left&&i.top===r.top&&i.width===r.width&&i.height===r.height){if(++s===10){clearInterval(o),e();return}}else s=0;i=r},50)}).then(()=>{const e=v(this,"g-js-mapid"),i=v(this,"g-android-mapid"),s=v(this,"g-ios-mapid");this.hasAttribute("maptype")&&(this.maptype=this.getAttribute("maptype"));const o=this.state.get("initCamera"),r=this.convertToCameraParams(o);this.hasAttribute("center")&&(this.center=this.getAttribute("center"),r.target=[this.state.get("center")]),this.hasAttribute("zoom")&&(this.zoom=this.getAttribute("zoom"),r.zoom=this.state.get("zoom")),this.hasAttribute("tilt")&&(this.tilt=this.getAttribute("tilt"),r.tilt=this.state.get("tilt")),this.hasAttribute("heading")&&(this.heading=this.getAttribute("heading"),r.heading=this.state.get("heading"));const a={mapType:this.state.get("maptype"),controls:{},gestures:{},jsMapId:e,androidMapId:i,iosMapId:s,camera:r,preferences:{zoom:{minZoom:this.state.get("minZoom")||Ht,maxZoom:this.state.get("maxZoom")},building:this.state.get("building"),clickableIcons:this.state.get("clickableIcons"),restriction:this.state.get("restriction")}};return new Promise(h=>{this.initStatus===u.NOT_READY?(this.initStatus=u.VIEW_CREATING,this.execPromise("GoogleMaps","createMapView",[t,a],{sync:!0}).then(h)):Promise.resolve(h)})}).then(()=>this.execPromise("GoogleMaps","attachToWindow",[t],{sync:!0})).then(()=>{this.initStatus=u.VIEW_CREATED})}disconnectedCallback(){super.disconnectedCallback(),this.initStatus===u.VIEW_CREATED&&this.execPromise("GoogleMaps","detachFromWindow",[{id:this.getId()}],{sync:!0})}}class dt extends O{constructor(){super(),this._hasMap=!1,this._parentOverlay=null,this._children=[],this._path=new L,this._bind_onUpdate=t=>this._onUpdate(t),this._execQueue=new L}setParentOverlay(t){this._parentOverlay=t}get parentOverlay(){return this._parentOverlay}_onUpdate(t){const e=t.detail;this.dispatchEvent(new CustomEvent("command",{detail:{methodName:t.type,index:e.index,latLng:e.value}}))}onChildrenAdded(t){const e=Array.from(this.children),i=t.map(s=>({child:s,index:e.indexOf(s)}));i.sort((s,o)=>o.index-s.index),i.forEach(s=>{this._children.splice(s.index,0,s.child),this._path.insertAt(s.index,s.child.toJSON())})}onChildrenRemoved(t){const e=t.map(i=>this._children.indexOf(i));e.sort((i,s)=>s-i),e.forEach(i=>{i>-1&&(this._children.splice(i,1),this._path.removeAt(i))})}onCommandFromChildren(t){const e=t.detail,i=this._children.indexOf(t.target);if(i!==-1)switch(e.methodName){case"setPosition":this._path.setAt(i,e.latLng);break}}toJSON(){return this._path.toArray()}connectedCallback(){super.connectedCallback(),this._path.addEventListener("insert_at",this._bind_onUpdate),this._path.addEventListener("set_at",this._bind_onUpdate),this._path.addEventListener("remove_at",this._bind_onUpdate),this._path.addEventListener("remove_all",this._bind_onUpdate);const t=!0;Array.from(this.children).forEach((e,i,s)=>{if(e instanceof p)this._path.push(e.toJSON(),t),this._children.push(e);else throw new Error("<mkg-path> can contain only <mkg-latlng>")})}disconnectedCallback(){super.disconnectedCallback(),this._path.removeEventListener("insert_at",this._bind_onUpdate),this._path.removeEventListener("set_at",this._bind_onUpdate),this._path.removeEventListener("remove_at",this._bind_onUpdate),this._path.removeEventListener("remove_all",this._bind_onUpdate),this.dispatchEvent(new CustomEvent("command",{detail:{methodName:"remove_all",path:[]}})),this._path.clear(!0),this._children.length=0,this.setParentOverlay(null)}}class Ue extends Pt{constructor(t){super(),this._path=new L,this._bind_onRemoveAll=e=>this._onRemoveAll(e),this._bind_onUpdate=e=>this._onPathUpdate(e),this.state.set("zIndex",void 0),this.state.set("visible",!0),this.state.set("clickable",!0),this.state.set("geodesic",!1),this.state.set("zIndex",0),this.state.set("strokeWidth",1),this.state.set("strokeColor",[0,0,0,255]),this.state.set("initOptions",t)}onRedraw(){this.initStatus<u.VIEW_CREATED||this.applyOptionsToState()}_onRemoveAll(t){this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setPath"},[]])}applyOptionsToState(t){const e={visible:this.state.get("visible"),clickable:this.state.get("clickable"),geodesic:this.state.get("geodesic"),strokeColor:this.state.get("strokeColor"),strokeWidth:this.state.get("strokeWidth"),zIndex:this.state.get("zIndex"),extra:this.state.get("extra")};["visible","clickable","geodesic"].forEach(r=>{const a=v(this,`mkg-${r}`);a!==void 0&&(e[r]=ut(a))});const i=v(this,"mkg-stroke-color")||"";i!==""&&(e.strokeColor=j(i));const s=v(this,"mkg-stroke-width")||"";s!==""&&(e.strokeWidth=parseInt(s.replace(/[^\d].*$/g,""),10));const o=v(this,"mkg-z-index")||"";if(o!==""&&(e.zIndex=parseInt(o.replace(/[^\d].*$/g,""),10)),t){if("extra"in t&&(e.extra=t.extra),typeof t.visible=="boolean"&&(e.visible=t.visible===!0),typeof t.clickable=="boolean"&&(e.clickable=t.clickable===!0),typeof t.geodesic=="boolean"&&(e.geodesic=t.geodesic===!0),t.strokeColor&&(e.strokeColor=j(t.strokeColor)),typeof t.strokeWidth=="number"&&t.strokeWidth>=0&&(e.strokeWidth=t.strokeWidth),typeof t.zIndex=="number"){if(!Number.isInteger(t.zIndex))throw new Error("PolylineOptions.zIndex must be an integer value");e.zIndex=t.zIndex}t.path&&this.setPath(t.path)}isNaN(e.zIndex)&&(e.zIndex=0),Object.keys(e).forEach(r=>{this.state.set(r,e[r])})}_onPathUpdate(t){const e=t.detail;this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setPath"},{action:e.methodName,index:e.index,latLng:e.latLng}])}onCommandFromChildren(t){this._onPathUpdate(t)}addEventListenersToPath(){this._path.addEventListener("remove_all",this._bind_onUpdate),this._path.addEventListener("set_at",this._bind_onUpdate),this._path.addEventListener("insert_at",this._bind_onUpdate),this._path.addEventListener("remove_at",this._bind_onUpdate)}removeEventListenersFromPath(){this._path.removeEventListener("remove_all",this._bind_onUpdate),this._path.removeEventListener("set_at",this._bind_onUpdate),this._path.removeEventListener("insert_at",this._bind_onUpdate),this._path.removeEventListener("remove_at",this._bind_onUpdate)}getPath(){return this._path}setPath(t){this._path instanceof dt?(this._path=new L,this.addEventListenersToPath()):this._path.clear(!0);let i=[];if(t instanceof L)t.forEach((s,o)=>{if(w(s))i.push(s);else throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.")}),this.removeEventListenersFromPath(),this._path=t,this.addEventListenersToPath();else if(Array.isArray(t))t.forEach((s,o)=>{if(w(s))i.push(s),this._path.push(s,!0);else throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.")});else if(t instanceof dt)this._path=t,i=this._path.toJSON();else throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.");this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{path:i}])}async onConnected(){if(await super.onConnected(),this.state.addEventListener("visible_changed",this._bind_onPropertyChanged),this.state.addEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.addEventListener("geodesic_changed",this._bind_onPropertyChanged),this.state.addEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.addEventListener("strokeColor_changed",this._bind_onPropertyChanged),this.state.addEventListener("strokeWidth_changed",this._bind_onPropertyChanged),this._path instanceof L&&this.addEventListenersToPath(),this.hasMap||this.initStatus===u.VIEW_CREATING)return;this.setHasMap(!0);const t=Array.from(this.children).filter((e,i,s)=>e instanceof dt);if(t.length>1)throw new Error("<mkg-polyline> can have only one <mkg-path>");t.length===1&&(this._path instanceof L&&this.removeEventListenersFromPath(),this._path=t[0]),new Promise(e=>{let i=[];i=this._path instanceof L?this._path.toArray():this._path.toJSON(),console.log(i),this.initStatus===u.NOT_READY?(this.initStatus=u.VIEW_CREATING,this.execPromise("(parent)","createPolyline",[{id:this.viewId},{path:i,visible:!1}]).then(e)):this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{path:i,visible:!1}]).then(e)}).then(()=>this.execPromise("(parent)","attachOverlayToMap",[{id:this.viewId}])).then(()=>{this.initStatus=u.VIEW_CREATED;const e=this.state.get("initOptions");this.applyOptionsToState(e),this.state.trigger("visible_changed",{key:"visible",prevValue:void 0,value:this.state.get("visible")}),this.state.set("initOptions",void 0)})}async onDisconnected(){await super.onDisconnected(),this.state.removeEventListener("visible_changed",this._bind_onPropertyChanged),this.state.removeEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("geodesic_changed",this._bind_onPropertyChanged),this.state.removeEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeColor_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeWidth_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeStyle_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeStyleRepeat_changed",this._bind_onPropertyChanged),this._path instanceof L&&this.removeEventListenersFromPath(),this.hasMap&&this.initStatus===u.VIEW_CREATED&&(this.setHasMap(!1),this.initStatus=u.VIEW_RELEASED,this.execPromise("(parent)","detachOverlayFromMap",[{id:this.getId()}]))}}const Ze=()=>new Promise(n=>{const t=()=>{document.readyState!=="complete"?setTimeout(t,50):n()};t()});class He{constructor(t){this.qName=t,this.commandQueue=[],this.stopRequested=!1,this.isExecuting=!1,this._bind_nextTick=()=>this.nextTick(),this.waitSync=!1}purge(){this.stopRequested=!0}set bridge(t){this._bridge=t,t&&Promise.resolve().then(this._bind_nextTick)}get bridge(){return this._bridge}execPromise(t,e,i=[],s={}){return new Promise((o,r)=>{this.commandQueue.push({pluginName:t,methodName:e,args:i,execOptions:s,onSuccess:(...a)=>{if(this.stopRequested){o.apply(this,a);return}s.sync&&(this.waitSync=!1),o.apply(this,a),Promise.resolve().then(this._bind_nextTick)},onError:a=>{this.stopRequested||(s.sync&&(this.waitSync=!1),r(a))}}),!(this.isExecuting||this.waitSync||this.commandQueue.length===0||!this._bridge)&&this.nextTick()})}nextTick(){if(!(this.isExecuting||!this._bridge)){for(this.isExecuting=!0;this.commandQueue.length>0&&!this.waitSync;){const t=this.commandQueue.shift(),e=t.pluginName,i=t.methodName,s=btoa(JSON.stringify(t.args)),o=t.execOptions;this.stopRequested&&!o.remove||(o.sync&&(this.waitSync=!0),this._bridge.execute(this.qName,e,i,s).then(t.onSuccess).catch(t.onError))}this.isExecuting=!1}}}class Z{constructor(){this.elements={},this._options={},this._queues={},this._frameworkId=this.getFrameworkId(),this._platformId=this.getPlatformId()}static getInstance(){return Z.instance||(Z.instance=new Z),Z.instance}async setUp(t){if(!t)return;const e=this.getPlatformId();if(t.bridge&&e in t.bridge)this.bridge=t.bridge[e],this.bridge.onInit(e,t),Object.keys(this._queues).forEach(r=>{this._queues[r].bridge=this.bridge});else throw`options.bridge.${e} is required`;const i=this.getCommandQueue("system");if(e!==b.ANDROID&&e!==b.IOS)return;const s=new Be(i);Ze().then(()=>{s.observe(document.body)}),window.addEventListener("unload",()=>{s.disconnect(),i.execPromise("GoogleMaps","unload",[],{sync:!0})},{once:!0,passive:!0});const o=document.createElement("style");o.innerHTML=`
        ._gmh_css_ {
            background-image: none !important;
            background: rgba(0,0,0,0) none !important;
            background-color: rgba(0,0,0,0) !important;
        }
        ._gmh_css_ .nav-decor {
            background-color: rgba(0,0,0,0) !important;
            background: rgba(0,0,0,0) none !important;
            display:none !important;
        }
        .framework7-root .page-previous {
            display:none !important;
        }
        `,document.head.appendChild(o)}getFrameworkId(){return this._frameworkId?this._frameworkId:(this._frameworkId=A.NO_FRAMEWORK,"cordova"in window&&window.cordova.platformId&&(this._frameworkId=A.CORDOVA),"Capacitor"in window&&window.Capacitor.platform&&(this._frameworkId=A.CAPACITOR),this._frameworkId)}getPlatformId(){if(this._platformId)return this._platformId;const t=this.getFrameworkId();let e=b.BROWSER;return t===A.CORDOVA&&(window.cordova.platformId==="browser"&&(e=b.BROWSER),window.cordova.platformId==="android"&&(e=b.ANDROID),window.cordova.platformId==="ios"&&(e=b.IOS)),t===A.CAPACITOR&&(window.Capacitor.platform==="web"&&(e=b.BROWSER),window.Capacitor.platform==="android"&&(e=b.ANDROID),window.Capacitor.platform==="ios"&&(e=b.IOS)),this._platformId=e,e}getCommandQueue(t){return t in this._queues||(this._queues[t]=new He(t)),this._queues[t].bridge||(this._queues[t].bridge=this.bridge),this._queues[t]}}window.mkgeeklab||Reflect.defineProperty(window,"mkgeeklab",{enumerable:!1,value:{},writable:!1});window.mkgeeklab.googlemaps||Reflect.defineProperty(window.mkgeeklab,"googlemaps",{enumerable:!1,value:Z.getInstance(),writable:!1});window.getElementByPluginDomId||Reflect.defineProperty(window,"getElementByPluginDomId",{enumerable:!1,value:U,writable:!1});window.customElements.get("mkg-mapview")===void 0&&(window.customElements.define("mkg-marker",kt),window.customElements.define("mkg-polyline",Ue),window.customElements.define("mkg-infobase",re),window.customElements.define("mkg-infowindow",ae),window.customElements.define("mkg-latlng",p),window.customElements.define("mkg-path",dt),window.customElements.define("mkg-mapview",$e));class je{constructor(t={}){this.options={mapTypeId:google.maps.MapTypeId.ROADMAP,restriction:null,maxZoom:null,minZoom:0,clickableIcons:!1,center:{lat:0,lng:0},zoom:0,zoomControl:!0,disableDoubleClickZoom:!1,scrollwheel:!0,rotateControl:!0,scaleControl:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1,heading:0,tilt:0,mapId:null,isFractionalZoomEnabled:!0},this.compassEnabled=!1,this.mapToolbarEnabled=!1,this.myLocationButtonEnabled=!1,this.myLocationEnabled=!1,this.indoorEnabled=!1,this.buildingEnabled=!1,this.styles="",this.tiltGestureEnabled=!1,this.scrollGesturesEnabledDuringRotateOrZoom=!1,this.setValues(t)}setValues(t){if(!!t&&t){if(t.mapTypeId&&(this.mapTypeId=t.mapTypeId),t.jsMapId===void 0||t.jsMapId===null||t.jsMapId===""?this.mapId=void 0:typeof t.jsMapId=="string"&&(this.mapId=t.jsMapId),t.controls){const e=t.controls;this.compassEnabled=e.compass===!0,this.options.zoomControl=e.zoom===!0,this.mapToolbarEnabled=e.mapToolbar===!0,this.myLocationButtonEnabled=e.myLocationButton===!0,this.myLocationEnabled=e.myLocation===!0,this.indoorEnabled=e.indoor===!0}if(t.gestures){const e=t.gestures;this.options.draggable=e.scroll===!0||e.scroll===void 0,this.options.disableDoubleClickZoom=e.zoom===!1,this.options.scrollwheel=!this.options.disableDoubleClickZoom,this.options.rotateControl=e.rotate===!0||e.rotate===void 0,this.tiltGestureEnabled=e.tilt===!0||e.tilt===void 0,this.scrollGesturesEnabledDuringRotateOrZoom=e.scrollGesturesEnabledDuringRotateOrZoom===!0||e.scrollGesturesEnabledDuringRotateOrZoom===void 0}if(t.preferences){const e=t.preferences;if(e.padding){const i=e.padding;i.left=i.left||0,i.top=i.top||0,i.right=i.right||0,i.bottom=i.bottom||0}if(e.restriction&&J(e.restriction)){const i=e.restriction;this.options.restriction={strictBounds:!0,latLngBounds:i}}if(e.zoom){const i=e.zoom;typeof i.minZoom=="number"&&(this.options.minZoom=i.minZoom),typeof i.maxZoom=="number"&&(this.options.maxZoom=i.maxZoom)}this.options.clickableIcons=e.clickableIcons===!0,this.buildingEnabled=e.building===!0}if(t.camera){const e=t.camera;if("target"in e&&Array.isArray(e.target)){if(e.target.length===0)typeof e.zoom=="number"&&(this.zoom=Math.max(e.zoom,0));else if(e.target.length===1)this.center=e.target[0],typeof e.zoom=="number"&&(this.zoom=Math.max(e.zoom,0));else if(e.target.length===2){const i=e.target[0];this.center=e.target[1];const s=new qt,o=s.fromLatLngToPoint(this.center),r=s.fromLatLngToPoint(i),a=Math.sqrt(Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)),h=Math.log(256/a)/Math.log(2),l=Math.sqrt(Math.pow(o.x-r.x-e.padding/(256*Math.pow(2,h)),2)+Math.pow(o.y-r.y-e.padding/(256*Math.pow(2,h)),2)),d=Math.log(256/l)/Math.log(2);this.zoom=d}}"zoom"in e&&(this.zoom=e.zoom||0),"tilt"in e&&(this.tilt=e.tilt||0),"heading"in e&&(this.heading=e.heading||0)}typeof t.styles=="string"&&(this.styles=t.styles||"")}}set mapId(t){this.options.mapId=t}get mapId(){return this.options.mapId}set mapTypeId(t){this.options.mapTypeId=this.convertToMapType(t)}get mapTypeId(){return this.options.mapTypeId}set center(t){this.options.center=t}get center(){return this.options.center}set tilt(t){this.options.tilt=t||0}get tilt(){return this.options.tilt}set heading(t){this.options.heading=t||0}get heading(){return this.options.heading}set zoom(t){this.options.zoom=Math.min(Math.max(t||0,0),25)}get zoom(){return this.options.zoom}set minZoom(t){this.options.minZoom=typeof t=="number"?Math.min(Math.max(t,0),25):0}get minZoom(){return this.options.minZoom}set maxZoom(t){this.options.maxZoom=typeof t=="number"?Math.min(Math.max(t,0),25):null}get maxZoom(){return this.options.maxZoom}getMapOptions(){return JSON.parse(JSON.stringify(this.options))}convertToMapType(t){if(!t)return google.maps.MapTypeId.ROADMAP;t=t.toLowerCase();let e=V.NONE;return e=t==="normal"||t==="roadmap"?V.ROADMAP:e,e=t==="hybrid"?V.HYBRID:e,e=t==="satellite"?V.SATELLITE:e,e=t==="terrain"?V.TERRAIN:e,e}}class Je extends st{constructor(t){super(),this.id="",this.marker=new google.maps.Marker,this._gsMarkerOptions(t).then(e=>{!this.marker||(this.marker.setOptions(e),this.marker.addListener("click",this._onMarkerEvent.bind(this,"click")),this.marker.addListener("dragstart",this._onMarkerEvent.bind(this,"dragstart")),this.marker.addListener("drag",this._onMarkerEvent.bind(this,"drag")),this.marker.addListener("dragend",this._onMarkerEvent.bind(this,"dragend")))})}_gsMarkerOptions(t){const e={};return new Promise((i,s)=>{if(t.position&&(e.position=t.position),typeof t.clickable=="boolean"&&(e.clickable=t.clickable),typeof t.draggable=="boolean"&&(e.draggable=t.draggable),typeof t.visible=="boolean"&&(e.visible=t.visible),typeof t.zIndex=="number"&&(e.zIndex=t.zIndex),!t.icon){i(e);return}if(t.icon.type==="color")e.icon=this._generateIcon(t.icon.value),i(e);else if(t.icon.type==="img"){const o=document.createElement("img"),r=()=>{o.removeEventListener("load",r),o.removeEventListener("error",a);let h=o.width,l=o.height;if(h>32||l>32){const c=h>32?32/h:32/l;h=h*c,l=l*c}const d=new google.maps.Size(h,l);e.icon={url:t.icon.value,scaledSize:d},i(e)},a=h=>{o.removeEventListener("load",r),o.removeEventListener("error",a),s(new Error("error"))};o.addEventListener("load",r),o.addEventListener("error",a),o.src=t.icon.value}else i(e)})}_generateIcon(t){return{path:"m12 0c-4.4183 2.3685e-15 -8 3.5817-8 8 0 1.421 0.3816 2.75 1.0312 3.906 0.1079 0.192 0.221 0.381 0.3438 0.563l6.625 11.531 6.625-11.531c0.102-0.151 0.19-0.311 0.281-0.469l0.063-0.094c0.649-1.156 1.031-2.485 1.031-3.906 0-4.4183-3.582-8-8-8zm0 4c2.209 0 4 1.7909 4 4 0 2.209-1.791 4-4 4-2.2091 0-4-1.791-4-4 0-2.2091 1.7909-4 4-4z",fillColor:`rgb(${t[0]},${t[1]},${t[2]})`,fillOpacity:t[3]/255,scale:1.3,strokeWeight:1,strokeColor:"rgb(255, 255, 255)",strokeOpacity:.65,anchor:new google.maps.Point(12,27)}}setId(t){this.id=t}getId(){return this.id}setMap(t){this.marker&&this.marker.setMap(t)}setEventCallback(t){this.eventCallback=t}setOptions(t){if(!this.marker)return Promise.reject(new Error("marker is invalid"));const e=t[1];return this._gsMarkerOptions(e).then(i=>{this.marker&&this.marker.setOptions(i)})}_onMarkerEvent(t){if(!this.eventCallback||!this.marker)return;const e=this.marker.getPosition();e&&this.eventCallback(this.id,new CustomEvent(t,{detail:{latLng:e.toJSON()}}))}}class Ye extends st{constructor(t){super(),this.id="",this.path=new google.maps.MVCArray,this.set("strokeStryle",void 0),this.set("strokeColor","black"),this.set("strokeOpacity",1),this.set("strokeWidth",1),this.polyline=new google.maps.Polyline({path:this.path}),this._gsPolylineOptions(t).then(e=>{!this.polyline||(this.polyline.setOptions(e),this.polyline.addListener("click",this._onPolylineEvent.bind(this,"click")))})}getIconForStrokeStyle(t){const e=this.get("strokeWidth"),i=this.get("strokeColor"),s=this.get("strokeOpacity"),o=this.get("strokeStyleRepeat")||"10px";switch(t){case"solid":return[];case"dashed":return[{icon:{path:"M 0,-1 0,1",fillOpacity:s,fillColor:i,strokeColor:i,strokeOpacity:s,strokeWeight:e},repeat:o}];case"dotted":return[{icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:s,fillColor:i,strokeColor:i,strokeOpacity:s,strokeWeight:e},repeat:o}];default:return[]}}_gsPolylineOptions(t){const e={};return new Promise((i,s)=>{if(t.path&&(this.path.clear(),t.path.forEach(o=>{this.path.push(new google.maps.LatLng(o.lat,o.lng))})),typeof t.clickable=="boolean"&&(e.clickable=t.clickable),typeof t.visible=="boolean"&&(e.visible=t.visible),typeof t.geodesic=="boolean"&&(e.geodesic=t.geodesic),typeof t.strokeWidth=="number"&&(e.strokeWeight=t.strokeWidth),typeof t.zIndex=="number"&&(e.zIndex=t.zIndex),Array.isArray(t.strokeColor)){const o=t.strokeColor;this.set("strokeColor",`rgb(${o[0]},${o[1]},${o[2]})`,!0),this.set("strokeOpacity",o[3]/255,!0)}Number.isInteger(t.strokeWidth)&&t.strokeWidth>=0&&this.set("strokeWidth",t.strokeWidth,!0),t.strokeStyle&&t.strokeStyle!==""?this.set("strokeStyle",t.strokeStyle,!0):t.strokeStyle===""&&this.set("strokeStyle",void 0,!0),t.strokeStyleRepeat&&t.strokeStyleRepeat!==""?this.set("strokeStyleRepeat",t.strokeStyleRepeat,!0):t.strokeStyle===""&&this.set("strokeStyleRepeat",void 0,!0),this.get("strokeStyle")?(e.icons=this.getIconForStrokeStyle(this.get("strokeStyle")),e.strokeOpacity=0):(e.icons=[],e.strokeColor=this.get("strokeColor"),e.strokeOpacity=this.get("strokeOpacity"),e.strokeWeight=this.get("strokeWidth")),i(e)})}setId(t){this.id=t}getId(){return this.id}setMap(t){this.polyline&&this.polyline.setMap(t)}setEventCallback(t){this.eventCallback=t}setOptions(t){if(!this.polyline)return Promise.reject(new Error("polyline is invalid"));const e=t[1];return this._gsPolylineOptions(e).then(i=>{this.polyline&&this.polyline.setOptions(i)})}setPath(t){if(!this.polyline)return Promise.reject(new Error("polyline is invalid"));const e=t[1];switch(e.action){case"insert_at":this.path.insertAt(e.index,new google.maps.LatLng(e.latLng.lat,e.latLng.lng));break;case"set_at":this.path.setAt(e.index,new google.maps.LatLng(e.latLng.lat,e.latLng.lng));break;case"remove_at":this.path.removeAt(e.index);break;case"remove_all":this.path.clear();break}return Promise.resolve()}_onPolylineEvent(t){!this.eventCallback||this.polyline}}class qe extends st{constructor(t,e){super(),this.id="",this.mapOptions=new je({}),this.container=document.createElement("div"),this.shadow=this.container.attachShadow({mode:"closed"}),this.shadowWrapper=document.createElement("div"),this.isMapCameraMoving=!1,this.overlayView=new google.maps.OverlayView,this.mapCanvasProjection=null,this.overlays={},this._bind_onBoundsChanged=()=>this._onBoundsChanged(),this._bind_onCameraIdle=()=>this._onCameraIdle(),this._bind_trackCamera=()=>this._trackCamera(),this.prevFarLeft={lat:0,lng:0},this.stopCounter=0,this.cornerPoints=[new google.maps.Point(-128,-128),new google.maps.Point(128,-128),new google.maps.Point(128,128),new google.maps.Point(-128,128)],this.container.style.position="absolute",this.container.style.left="0px",this.container.style.top="0px",this.container.style.right="0px",this.container.style.bottom="0px",this.container.style.width="100%",this.container.style.height="100%",this.shadowWrapper.style.position="absolute",this.shadowWrapper.style.left="0px",this.shadowWrapper.style.top="0px",this.shadowWrapper.style.right="0px",this.shadowWrapper.style.bottom="0px",this.shadowWrapper.style.width="100%",this.shadowWrapper.style.height="100%",this.shadowWrapper.style.padding="0px",this.shadowWrapper.style.margin="0px",this.shadowWrapper.style.border="none",this.shadowWrapper.style.userSelect="none",this.shadow.appendChild(this.shadowWrapper),this.pluginOptions=t,this.id=t.id,this.map=new google.maps.Map(this.shadowWrapper,e),this.overlayView.onAdd=()=>{google.maps.event.trigger(this.map,"ready")},this.overlayView.onRemove=()=>{},this.overlayView.draw=()=>{},this.overlayView.setMap(this.map);let i=!1;this.map.addListener("click",o=>{i||this._onMouseEvent("click",o),i=!1});let s=0;this.map.addListener("mousedown",o=>{s=Date.now(),i=!1}),this.map.addListener("mouseup",o=>{this.map.set("originalHeading",void 0),this.map.set("originalAngle",void 0),Date.now()-s>500&&(this._onMouseEvent("longclick",o),i=!0)}),this.addEventListenerOnce("remove",()=>{google.maps.event.clearInstanceListeners(this.map)}),this.map.addListener("drag",()=>{s=Date.now(),i=!0}),this.map.addListener("resize",this._bind_onBoundsChanged),this.map.addListener("center_changed",this._bind_onBoundsChanged),this.map.addListener("heading_changed",this._bind_onBoundsChanged),this.map.addListener("tilt_changed",this._bind_onBoundsChanged),this.map.addListener("zoom_changed",this._bind_onBoundsChanged),this.map.addListener("drag",this._bind_onBoundsChanged),this.map.addListener("idle",this._bind_onCameraIdle),this.map.addListener("drag",this._onMapEvent.bind(this,"dragging")),this.map.addListener("dragend",this._onMapEvent.bind(this,"drag:end")),this.map.addListener("dragstart",this._onMapEvent.bind(this,"drag:start")),this.map.addListener("tilesloaded",this._onMapEvent.bind(this,"tiles:loaded")),window.screen&&window.screen.orientation?window.screen.orientation.addEventListener("change",this._onOrientationChanged.bind(this)):window.addEventListener("orientationchange",this._onOrientationChanged.bind(this))}_onOrientationChanged(){this._onCameraEvent("camera:move")}_onBoundsChanged(){this.isMapCameraMoving||(this.stopCounter=0,this.isMapCameraMoving=!0,this._onCameraEvent("camera:move:start"),window.requestAnimationFrame(this._bind_trackCamera))}_trackCamera(){!this.isMapCameraMoving||(this._onCameraEvent("camera:move"),window.requestAnimationFrame(this._bind_trackCamera))}_onCameraIdle(){this.isMapCameraMoving=!1,this._onCameraEvent("camera:move:end")}execute(t){const e=t[0],i=e.id;if(e.subMethodName){const s=e.subMethodName;if(console.log(`${i}.${s}`),i in this.overlays){const o=this.overlays[i];return o[s].call(o,t)}else return Promise.reject(`Can not find overlay: ${i}`)}else return Promise.reject("PluginMap.execute() needs subMethodName property in args[0]")}getMap(){return this.map}getView(){return this.container}setId(t){this.id=t}getId(){return this.id}setOptions(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const e=t[0];this.mapOptions.setValues(e);const i=this.mapOptions.getMapOptions();return this.map.setOptions(i),this._onCameraEvent("camera:move"),Promise.resolve()}createMarker(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const i=t[0].id,s=t[1],o=new Je(s);return o.setId(i),o.setEventCallback(this._onOverlayEvent.bind(this)),this.overlays[i]=o,Promise.resolve()}createPolyline(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const i=t[0].id,s=t[1],o=new Ye(s);return o.setId(i),o.setEventCallback(this._onOverlayEvent.bind(this)),this.overlays[i]=o,Promise.resolve()}attachOverlayToMap(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const i=t[0].id;return i in this.overlays?(this.overlays[i].setMap(this.map),Promise.resolve()):Promise.reject(new Error(`can not find overlay2: ${i}`))}detachOverlayFromMap(t){return this.map?(t.forEach(i=>{i in this.overlays&&this.overlays[i].setMap(null)}),Promise.resolve()):Promise.reject(new Error("map is invalid"))}moveCamera(t){if(!this.map)return Promise.reject(new Error("map is invalid"));if(!this.map.getDiv())return Promise.reject(new Error("Can not manipulate the map when mapDiv is unset"));if(!this.overlayView)return Promise.reject(new Error("map is not ready"));if(!this.overlayView.getProjection())return Promise.reject(new Error("map is not ready"));const s=t[0],o=this.map.getZoom(),r={fromCenter:this.map.getCenter().toJSON(),fromZoom:o,fromTilt:this.map.getTilt(),fromHeading:this.map.getHeading(),toCenter:this.map.getCenter().toJSON(),toZoom:o,toTilt:this.map.getTilt(),toHeading:this.map.getHeading(),duration:0,changeCenter:!1,changeZoom:!1,changeTilt:!1,changeHeading:!1};if(typeof s.duration=="number"&&(r.duration=Math.max(s.duration,0)),Array.isArray(s.target))if(s.target.length===0)typeof s.zoom=="number"&&(r.toZoom=Math.max(s.zoom,0));else if(s.target.length===1)r.toCenter=s.target[0],typeof s.zoom=="number"&&(r.toZoom=Math.max(s.zoom,0));else{const a=new google.maps.LatLngBounds;s.target.forEach(g=>{a.extend(g)}),r.toCenter=a.getCenter();const h=this.map.getProjection();this.shadowWrapper.offsetWidth,this.shadowWrapper.offsetHeight;const l=h.fromLatLngToPoint(r.toCenter),d=h.fromLatLngToPoint(a.getNorthEast()),c=Math.sqrt(Math.pow(l.x-d.x,2)+Math.pow(l.y-d.y,2)),f=Math.log(256/c)/Math.log(2);r.toZoom=f}return typeof s.heading=="number"&&(r.toHeading=Math.max(s.heading,0)),typeof s.tilt=="number"&&(r.toTilt=Math.max(s.tilt,0)),r.changeCenter=!Xt(r.fromCenter,r.toCenter),r.changeZoom=Math.ceil(r.fromZoom)!==Math.ceil(r.toZoom),r.changeTilt=r.fromTilt!==r.toTilt,r.changeHeading=r.fromHeading!==r.toHeading,!r.changeCenter&&!r.changeZoom&&!r.changeTilt&&!r.changeHeading&&(r.duration=0),new Promise(a=>{let h=-1,l=0;const d=()=>{const c=Date.now();if(h<0&&(h=c,l=h),!this.map){a();return}const f=c-h;if(l!==c){const g=this.easeInOutQuart(f/r.duration),m={};r.changeCenter&&(m.center=google.maps.geometry.spherical.interpolate(r.fromCenter,r.toCenter,g).toJSON()),r.changeZoom&&(m.zoom=r.fromZoom+(r.toZoom-r.fromZoom)*g),r.changeHeading&&(m.heading=r.fromHeading+(r.toHeading-r.fromHeading)*g),r.changeTilt&&(m.tilt=r.fromTilt+(r.toTilt-r.fromTilt)*g),this.map.moveCamera(m)}f<s.duration?(l=c,window.requestAnimationFrame(d)):(this.map.moveCamera({center:r.toCenter,zoom:r.toZoom,heading:r.toHeading,tilt:r.toTilt}),a())};window.requestAnimationFrame(d)})}easeInOutQuart(t){return t<.5?2*t*t:-1+(4-2*t)*t}onAttached(){return new Promise((t,e)=>{if(!this.map)return e(new Error("map is invalid"));this.map.setOptions(this.mapOptions.getMapOptions()),google.maps.event.trigger(this.map,"resize");const i=[],s=()=>{t(i)};this.overlayView.getProjection()!==void 0?(i.push(this.map.addListener("projection_changed",s)),i.push(this.map.addListener("bounds_changed",s))):i.push(this.map.addListener("ready",s))}).then(t=>{t.forEach(e=>e.remove()),this._onCameraEvent("camera:move2")})}onReleased(){return this.map?(this.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,center:{lat:0,lng:0},zoom:0,clickableIcons:!0,tilt:0,heading:0,restriction:void 0,minZoom:void 0,maxZoom:void 0}),Promise.resolve()):Promise.reject(new Error("map is invalid"))}releaseOverlay(t=[]){return t.forEach(i=>{this.overlays[i]=void 0,delete this.overlays[i]}),Promise.resolve()}_onCameraEvent(t){if(!t||!this.map||!this.overlayView)return;const e=this.map.getProjection();if(!e)return;const i=this.overlayView.getProjection();if(!i)return;const s=i.getVisibleRegion();if(!s||!s.latLngBounds||!s.farLeft||!s.farRight||!s.nearLeft||!s.nearRight)return;this.prevFarLeft.lat===s.farLeft.lat()&&this.prevFarLeft.lng===s.farLeft.lng()&&(this.stopCounter+=1,this.stopCounter===10&&(this.isMapCameraMoving=!1)),this.prevFarLeft.lat=s.farLeft.lat(),this.prevFarLeft.lng=s.farLeft.lng();const o={center:this.map.getCenter().toJSON(),zoom:this.map.getZoom()||0,tilt:this.map.getTilt()||0,heading:this.map.getHeading()||0,northEast:s.latLngBounds.getNorthEast().toJSON(),southWest:s.latLngBounds.getSouthWest().toJSON(),farLeft:s.farLeft.toJSON(),farRight:s.farRight.toJSON(),nearLeft:s.nearLeft.toJSON(),nearRight:s.nearRight.toJSON(),mat:[],inv:[]};this.mapOptions.tilt=o.tilt,this.mapOptions.center=o.center,this.mapOptions.zoom=o.zoom,this.mapOptions.heading=o.heading;const r=this.cornerPoints.map(h=>{const l=i.fromDivPixelToLatLng(h,!0),d=e.fromLatLngToPoint(l);return{x:d.x,y:d.y}});o.mat=this.calcHomographyMatrix(r[0],r[1],r[2],r[3]),o.inv=this.calcInverseMatrix(o.mat),this.prevCameraStatus=o,this.mapOptions.setValues(o);const a=U(this.getId());!a||a.dispatchEvent(new CustomEvent(t,{detail:o}))}calcHomographyMatrix(t,e,i,s){const o=t.x,r=t.y,a=s.x,h=s.y,l=e.x,d=e.y,c=i.x,f=i.y,g=l-c,m=a-c,k=o-a-l+c,C=d-f,S=h-f,_=r-h-d+f,R=o,z=r,N=(k*C-g*_)/(m*C-g*S),q=(k*S-m*_)/(g*S-m*C),vt=l-o+q*l,F=a-o+N*a,W=d-r+q*d,bt=h-r+N*h;return[vt,F,R,W,bt,z,q,N,1]}calcInverseMatrix(t){const e=t[0],i=t[1],s=t[2],o=t[3],r=t[4],a=t[5],h=t[6],l=t[7],d=1,c=1/(+(e*r*d)+i*a*h+s*o*l-s*r*h-i*o*d-e*a*l),f=(r*d-a*l)/c,g=(-i*d+s*l)/c,m=(i*a-s*r)/c,k=(-o*d+a*h)/c,C=(e*d-s*h)/c,S=(-e*a+s*o)/c,_=(o*l-r*h)/c,R=(-e*l+i*h)/c,z=(e*r-i*o)/c;return[f,g,m,k,C,S,_,R,z]}_onMapEvent(t){if(!t)return;const e=U(this.getId());!e||e.dispatchEvent(new Event(t))}_onMouseEvent(t,e){if(!t||!e)return;e.stop();const i=e.placeId||"",s=e.latLng?e.latLng.toJSON():null,o=U(this.getId());!o||o.dispatchEvent(new CustomEvent(t,{detail:{placeId:i,latLng:s}}))}_onOverlayEvent(t,e){if(!t||!e)return;const i=U(t);!i||i.dispatchEvent(e)}}const Ge=new class{constructor(){this.viewInstances={},this.initOptions={}}forRoot(n={}){if(!n)return this;const t="jsApiKey"in n?n.jsApiKey:void 0;return this.loadGoogleMapsJS(t),this}async onInit(n,t){}onWindowReady(){console.log("window.ready")}execute(n,t,e,i){const s=JSON.parse(atob(i));if(t==="GoogleMaps")return this[e].call(this,s);if(t in this.viewInstances){const o=this.viewInstances[t];if(!(e in o))throw new Error(`Can not find ${t}.${e}`);return o[e].call(o,s)}else throw new Error(`Can not find ${t} plugin`)}createMapView(n=[]){const t=n[0],e=t.id,i=n[1],s=new qe(t,{mapId:i.jsMapId});return this.viewInstances[e]=s,s.setOptions([i])}attachToWindow(n=[]){const e=n[0].id;if(!(e in this.viewInstances))return Promise.reject(`Can not find the view for ${e}`);const i=this.viewInstances[e],s=U(e);return s&&s.shadowRoot?(s.shadowRoot.insertBefore(i.getView(),s.shadowRoot.firstElementChild),i.onAttached()):Promise.reject(`Can not target element : ${e}`)}detachFromWindow(n=[]){const t=n[0],e=t.id;if(t.autoRelease,e in this.viewInstances){const s=this.viewInstances[e].getView();s.parentElement&&s.parentElement.removeChild(s)}else return Promise.reject(new Error(`can not find view: ${e}`));return Promise.resolve()}async loadGoogleMapsJS(n){if(!("google"in window&&"maps"in window.google))return new Promise((t,e)=>{const i=document.createElement("script");n&&n.length>35?i.setAttribute("src",`https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry&v=beta&key=${n}`):i.setAttribute("src","https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry&v=beta"),window.initMap=()=>{window.initMap=void 0,t()},i.onerror=s=>{e(new Error("Could not load Google Maps JavaScript API v3"))},document.getElementsByTagName("head")[0].appendChild(i)})}releaseView(n=[]){const e=n[0].id;if(!(e in this.viewInstances))return Promise.resolve();const i=this.viewInstances[e];delete this.viewInstances[e];const s=i.getView();return s.parentElement&&s.parentElement.removeChild(s),i.onReleased()}removeFromDomTree(n=[]){return console.log("removeFromDomTree",n),Promise.resolve()}updateDomTree(n=[]){return console.log("updateDomTree",n),Promise.resolve()}onScrollWebview(n=[]){return console.log("onScrollWebview",n),Promise.resolve()}},Qe=()=>{try{return"AIzaSyBpNKkll5yJ2YbS-i0dE5yIdEk8sef-S6g"}catch{return""}};window.mkgeeklab.googlemaps.setUp({bridge:{browser:Ge.forRoot({jsApiKey:Qe()})}});var Y,it,gt,pt,he,mt,le,_t,de;class Xe{constructor(t){T(this,pt);T(this,mt);T(this,_t);T(this,Y,new ae);T(this,it,void 0);T(this,gt,1);yt(this,it,t),t.appendChild(B(this,Y)),ce.addEventListener("click",e=>nt(this,mt,le).call(this,e))}}Y=new WeakMap,it=new WeakMap,gt=new WeakMap,pt=new WeakSet,he=function(){const t=Math.floor(255*Math.random()),e=Math.floor(255*Math.random()),i=Math.floor(255*Math.random());return`rgb(${t}, ${e}, ${i})`},mt=new WeakSet,le=function(t){const e=new kt({position:t.detail.latLng,icon:nt(this,pt,he).call(this),extra:{lat:t.detail.latLng.lat,lng:t.detail.latLng.lng,cnt:Rt(this,gt)._++}});e.addEventListener("click",i=>nt(this,_t,de).call(this,i)),B(this,it).appendChild(e),setTimeout(()=>{e.dispatchEvent(new Event("click"))},300)},_t=new WeakSet,de=function(t){const e=t.target;console.log(e.extra);const i=`
        <table border=1>
        <tr>
            <th>cnt</th>
            <td>${e.extra.cnt}</td>
        </tr>
        <tr>
            <th>latitude</th>
            <td>${e.extra.lat}</td>
        </tr>
        <tr>
            <th>longitude</th>
            <td>${e.extra.lng}</td>
        </tr>
        </table>
        `;B(this,Y).setContent(i),B(this,Y).open(e)};const ce=document.getElementById("map_canvas");new Xe(ce);
