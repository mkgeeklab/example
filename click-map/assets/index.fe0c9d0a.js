var t,e,i,n,s,o,r,a,h,l=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},d=(t,e,i)=>(l(t,e,"read from private field"),i?i.call(t):e.get(t)),c=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},g=(t,e,i,n)=>(l(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),p=(t,e,i)=>(l(t,e,"access private method"),i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var m,u;(u=m||(m={})).NO_FRAMEWORK="no_framework",u.CORDOVA="cordova",u.CAPACITOR="capacitor";const f={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo  ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"#00000000",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},_=0,v=1,b=2,y=3,E=["script","style","caption","svg"];var w,C,I,x;(C=w||(w={})).BROWSER="browser",C.ANDROID="android",C.IOS="ios",(x=I||(I={}))[x.CONTINUE=0]="CONTINUE",x[x.VOID=1]="VOID",x[x.STRING=2]="STRING",x[x.DICTIONARY=3]="DICTIONARY";const L=t=>{if(t&&!t.tagName.startsWith("g-")&&(t.classList&&!t.classList.contains("_gmh_css_")?t.classList.add("_gmh_css_"):t.className&&-1===t.className.indexOf("_gmh_css_")&&(t.className=t.className+" _gmh_css_"),t.shadowRoot)){let e=t.getAttribute("style")||"";e=[e,"--ion-background-color: var(--mkg-background-color) !important;","--background-color: var(--mkg-background-color) !important;","--background: var(--mkg-background-color) !important;"].join(""),t.setAttribute("style",e)}},S=(t,e)=>{const i=typeof t;if(i!==typeof e)return!1;let n=!0;if(t&&"object"===i)if(Array.isArray(t)){n=t.length===e.length;for(let i=0;i<t.length&&n;i++)n=S(t[i],e[i])}else{const i=Object.keys(t),s=Object.keys(e);n=S(i,s);for(let o=0;n&&o<i.length;o++){const s=i[o];n=S(t[s],e[s])}}else n=t===e;return n},P=(t,e)=>document.defaultView.getComputedStyle(t,null).getPropertyValue(e);window.getStyle=P;const k=t=>!!t&&(t.nodeType===Node.ELEMENT_NODE&&-1===E.indexOf(t.tagName.toLowerCase())&&t instanceof SVGElement==!1&&"function"==typeof t.getBoundingClientRect),O=t=>{if(t===document.body)return!0;if(!t||t.nodeType!==Node.ELEMENT_NODE||!k(t))return!1;const e=t.tagName.toLowerCase();if(E.indexOf(e)>-1)return!1;return"none"!==P(t,"display")},T=t=>{if(!t||!O(t))return"";let e=t.__pluginDomId||"";return e||(e=t===document.body?"root":`mkg${Math.floor(Math.random()*Date.now())}`,Reflect.defineProperty(t,"__pluginDomId",{enumerable:!1,value:e,writable:!1})),e},R=Symbol("HTMLElementBase");class M extends HTMLElement{constructor(){super(),this.state=new W,this.viewId=T(this),this.changeFunctions={},this._initStatus=_,this._isConnected=!1,this._isRemoved=!1,this.mutationObserver=new MutationObserver(this._onMutations.bind(this)),this.onInsertAtListener=this.onCommandFromChildren.bind(this),this.SUBSCRIPTIONS_FIELD={},window.mkgeeklab.googlemaps.elements[this.viewId]=this,Reflect.defineProperty(this,"_symbol",{enumerable:!1,value:R,writable:!1})}setAttributeChangeListener(t,e){e?this.changeFunctions[t]=e:delete this.changeFunctions[t]}getId(){return`${this.viewId}`}attributeChangedCallback(t,e,i){t in this.changeFunctions&&this.changeFunctions[t].call(this,t,e,i)}get hasParent(){return this._isConnected}get initStatus(){return this._initStatus}set initStatus(t){(t===v&&this._initStatus===_||t===b&&(this._initStatus===v||this._initStatus===y)||t===y&&this._initStatus===b)&&(this._initStatus=t,this.dispatchEvent(new CustomEvent("initStatus_changed",{detail:{status:t}})),t===b&&this.dispatchEvent(new CustomEvent("ready")))}get ready(){return this._initStatus===b}get isRemoved(){return this._isRemoved}get extra(){return this.state.get("extra")}set extra(t){this.state.set("extra",t)}onCommandFromChildren(t){}onChildrenAdded(t){}onChildrenRemoved(t){}_onMutations(t,e){const i=[],n=[];t.forEach((t=>{t.addedNodes&&t.addedNodes.length>0&&t.addedNodes.forEach((t=>{if(t instanceof M){const e=t;i.push(e),e.addEventListener("command",this.onInsertAtListener)}})),t.removedNodes&&t.removedNodes.length>0&&t.removedNodes.forEach((t=>{if(t instanceof M){const e=t;e.removeEventListener("command",this.onInsertAtListener),n.push(e)}}))})),i.length>0&&this.onChildrenAdded(i),n.length>0&&this.onChildrenRemoved(n)}connectedCallback(){this._isConnected=!0,this.onConnected()}async onConnected(){await window.customElements.whenDefined("mkg-mapview");Array.from(this.children).forEach((t=>{t instanceof M&&t.addEventListener("command",this.onInsertAtListener)})),this.mutationObserver.observe(this,{childList:!0}),this.dispatchEvent(new CustomEvent("isConnected_changed",{detail:!0}))}disconnectedCallback(){this._isConnected=!1,this.onDisconnected()}async onDisconnected(){this.mutationObserver.disconnect(),new CustomEvent("parentChanged",{detail:{connected:!1}});Array.from(this.children).forEach((t=>{t instanceof M&&t.removeEventListener("command",this.onInsertAtListener)})),this.dispatchEvent(new CustomEvent("isConnected_changed",{detail:!1}))}remove(){super.remove(),this._isRemoved=!0,this.dispatchEvent(new CustomEvent("removed"))}hasEventListener(t){return t in this.SUBSCRIPTIONS_FIELD&&Object.keys(this.SUBSCRIPTIONS_FIELD[t]).length>0}addEventListener(t,e,i){if(!e||"function"!=typeof e)throw Error("Listener for addEventListener() method is not a function");let n=e._hashCode;n||(n=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:n,writable:!1,enumerable:!1})),this.SUBSCRIPTIONS_FIELD[t]=this.SUBSCRIPTIONS_FIELD[t]||{},this.SUBSCRIPTIONS_FIELD[t][n]={kind:"on",once:i&&!0===i.once,listener:e}}removeEventListener(t,e){if(t)if(e){const i=e._hashCode;if(!i)return;this.SUBSCRIPTIONS_FIELD[t]&&this.SUBSCRIPTIONS_FIELD[t][i]&&(this.SUBSCRIPTIONS_FIELD[t][i].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][i])}else{Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach((e=>{this.SUBSCRIPTIONS_FIELD[t][e].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][e]})),0===this.SUBSCRIPTIONS_FIELD[t].length&&delete this.SUBSCRIPTIONS_FIELD[t]}else{Object.keys(this.SUBSCRIPTIONS_FIELD).forEach((t=>{Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach((e=>{this.SUBSCRIPTIONS_FIELD[t][e].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][e]}))}))}}dispatchEvent(t){if(!t)return!1;Object.defineProperty(t,"target",{value:this,writable:!1,enumerable:!0});const e=t.type;if(!this.SUBSCRIPTIONS_FIELD[e])return!1;const i=this.SUBSCRIPTIONS_FIELD[e];return Object.keys(i).forEach((i=>{if(this.SUBSCRIPTIONS_FIELD&&e in this.SUBSCRIPTIONS_FIELD&&i in this.SUBSCRIPTIONS_FIELD[e]){const n=this.SUBSCRIPTIONS_FIELD[e][i];Promise.resolve().then((()=>n.listener(t))),!0===n.once&&delete this.SUBSCRIPTIONS_FIELD[e][i]}})),!0}}const A=(t,e=6)=>t.toFixed(e).replace(/0+$/,"").replace(/\.$/,"");class N extends M{static get observedAttributes(){return["lat","lng"]}constructor(t=0,e=0,i=!1){super(),this._timer=null,this._changed=!1,this._update=this._onUpdate.bind(this),this._on_attr_changed=(t,e,i)=>this._onAttrChanged(t,e,i),i||(t=Math.max(-90,Math.min(90,t)),e>180?e=e%180-180:e<-180&&(e=180+e%180)),this._lat=t,this._lng=e,this.setAttributeChangeListener("lat",this._on_attr_changed),this.setAttributeChangeListener("lng",this._on_attr_changed)}connectedCallback(){if(this.hasAttribute("lat")&&this.hasAttribute("lng")){const t=this.getAttribute("lat"),e=this.getAttribute("lng");null!==t&&null!==e&&(this._lat=parseFloat(t),this._lng=parseFloat(e),this._changed=!0,this._onUpdate())}}_onAttrChanged(t,e,i){"lat"===t?this._lat=parseFloat(i):this._lng=parseFloat(i),this._changed=!0,this._onPropertyChanged()}_onPropertyChanged(){this._timer&&clearTimeout(this._timer),this._timer=setTimeout(this._update,5)}_onUpdate(){this._timer=null,this._changed&&(this._changed=!1,this.dispatchEvent(new CustomEvent("command",{detail:{methodName:"setPosition",latLng:{lat:this._lat,lng:this._lng}}})))}equals(t){return!!t&&(this._lat===t.lat&&this._lng===t.lng)}set lat(t){this.setAttribute("lat",t+""),"string"==typeof t&&(t=parseFloat(t)),this._lat=t,this._changed=!0,this._onPropertyChanged()}get lat(){return this._lat}set lng(t){this.setAttribute("lng",t+""),"string"==typeof t&&(t=parseFloat(t)),this._lng=t,this._changed=!0,this._onPropertyChanged()}get lng(){return this._lng}setPosition(t){this._lat=t.lat,this._lng=t.lng,this._changed=!0,this._onPropertyChanged()}getPosition(){return{lat:this._lat,lng:this._lng}}toString(){return"("+this._lat+", "+this._lng+")"}toUrlValue(t=6){return[A(this._lat,t),A(this._lng,t)].join(",")}toJSON(){return{lat:this._lat,lng:this._lng}}}const D=t=>!!t&&"object"==typeof t&&"lat"in t&&"number"==typeof t.lat&&"lng"in t&&"number"==typeof t.lng,z=t=>{if(!t)throw new Error("The first argument of toILatlng can not be null");if(D(t))return{lat:t.lat,lng:t.lng};if(t instanceof N)return{lat:t.lat,lng:t.lng};throw new Error("Cannot convert to ILatLng")},F=(t,e,i)=>Math.min(Math.max(t,e),i);class B{constructor(){this.TILE_SIZE=256,this.pixelOrigin={x:0,y:0},this.pixelsPerLngDegree=0,this.pixelsPerLngRadian=0,this.pixelOrigin={x:this.TILE_SIZE/2,y:this.TILE_SIZE/2},this.pixelsPerLngDegree=this.TILE_SIZE/360,this.pixelsPerLngRadian=this.TILE_SIZE/(2*Math.PI)}degreesToRadius(t){return t*(Math.PI/180)}radiansToDegrees(t){return t/(Math.PI/180)}fromLatLngToPoint(t){const e=z(t),i={x:0,y:0};i.x=this.pixelOrigin.x+e.lng*this.pixelsPerLngDegree;const n=F(Math.sin(this.degreesToRadius(e.lat)),-.9999,.9999);return i.y=this.pixelOrigin.y+.5*Math.log((1+n)/(1-n))*-this.pixelsPerLngRadian,i}fromPointToLatLng(t,e=!1){const i=(t.x-this.pixelOrigin.x)/this.pixelsPerLngDegree,n=(t.y-this.pixelOrigin.y)/-this.pixelsPerLngRadian;return{lat:this.radiansToDegrees(2*Math.atan(Math.exp(n))-Math.PI/2),lng:i,noWrap:e}}}class W{constructor(){this.VARS_FIELD={},this.SUBSCRIPTIONS_FIELD={},this.hashCode=Math.floor(Date.now()*Math.random())}remove(t){delete this.VARS_FIELD[t]}has(t){return this.VARS_FIELD.hasOwnProperty(t)}get(t){return this.VARS_FIELD.hasOwnProperty(t)?this.VARS_FIELD[t]:void 0}set(t,e,i=!1){if("__mkgId"===t)return;const n=this.get(t);this.VARS_FIELD[t]=e,i||n===e||this.dispatchEvent(new CustomEvent(`${t}_changed`,{detail:{prevValue:n,value:e,key:t}}))}bindTo(t,e,i,n=!1){"__mkgId"!==t&&(i=i||t,e.set(i,this.VARS_FIELD[t],n),this.addEventListener(t+"_changed",(t=>{e.set(i,t.detail.value)})))}trigger(t,e={}){return this.dispatchEvent(new CustomEvent(t,{detail:e}))}dispatchEvent(t){if(!t)return!1;const e=t.type;if(!this.SUBSCRIPTIONS_FIELD[e])return!1;const i=this.SUBSCRIPTIONS_FIELD[e];return Object.keys(i).forEach((i=>{if(this.SUBSCRIPTIONS_FIELD&&e in this.SUBSCRIPTIONS_FIELD&&i in this.SUBSCRIPTIONS_FIELD[e]){const n=this.SUBSCRIPTIONS_FIELD[e][i];switch(n.kind){case"on":n.listener.call(this,t);break;case"onThrottled":n.event=t,n.timer||(n.timer=setTimeout((()=>{n.listener.apply(this,n.event),n.timer=null}),n.interval))}}})),!0}addEventListener(t,e){if(!e||"function"!=typeof e)throw Error("Listener for addEventListener() method is not a function");let i=e._hashCode;i||(i=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:i,writable:!1,enumerable:!1})),this.SUBSCRIPTIONS_FIELD[t]=this.SUBSCRIPTIONS_FIELD[t]||{},this.SUBSCRIPTIONS_FIELD[t][i]={kind:"on",listener:e}}removeEventListener(t,e){if(t)if(e){const i=e._hashCode;if(!i)return;this.SUBSCRIPTIONS_FIELD[t]&&this.SUBSCRIPTIONS_FIELD[t][i]&&(this.SUBSCRIPTIONS_FIELD[t][i].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][i])}else{Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach((e=>{this.SUBSCRIPTIONS_FIELD[t][e].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][e]})),0===this.SUBSCRIPTIONS_FIELD[t].length&&delete this.SUBSCRIPTIONS_FIELD[t]}else{Object.keys(this.SUBSCRIPTIONS_FIELD).forEach((t=>{Object.keys(this.SUBSCRIPTIONS_FIELD[t]).forEach((e=>{this.SUBSCRIPTIONS_FIELD[t][e].listener._protect||delete this.SUBSCRIPTIONS_FIELD[t][e]}))}))}}addEventListenerOnce(t,e){const i=n=>{this.removeEventListener(t,i),e.call(this,n)};this.addEventListener(t,i)}hasEventListener(t){return t in this.SUBSCRIPTIONS_FIELD&&Object.keys(this.SUBSCRIPTIONS_FIELD[t]).length>0}release(){this.removeEventListener();const t=this.VARS_FIELD;Object.keys(t).forEach((e=>{t[e]=null,delete t[e]}))}toJSON(){const t={};return Object.keys(this.VARS_FIELD).forEach((e=>{const i=this.VARS_FIELD[e];t[e]=i&&"function"==typeof i.toJSON?i.toJSON():i})),t}}const U=t=>{Promise.resolve().then(t)};class $ extends W{constructor(t){super(),this.ARRAY_FIELD=[],t&&(t instanceof Array||Array.isArray(t))&&t.forEach((t=>{this.ARRAY_FIELD.push(t)}))}mapSeries(t){if("function"!=typeof t)throw new Error("iteratee must be a function");const e=this.ARRAY_FIELD.length;if(0===e)return Promise.resolve([]);let i=0;const n=(o,r)=>{t(this.ARRAY_FIELD[o],o,(t=>{s[o]=t,i++,e===i?r(s):U((()=>{n(o+1,r)}))}))},s=[];return new Promise(((t,e)=>{try{U((()=>{n(0,t)}))}catch(i){e(i)}}))}mapAsync(t){if("function"!=typeof t)throw new Error("iteratee must be a function");const e=this.ARRAY_FIELD.length,i=new Array(e);let n=0;return 0===e?Promise.resolve([]):new Promise(((s,o)=>{this.ARRAY_FIELD.forEach(((r,a)=>{try{t(r,a,(t=>{i[a]=t,n++,n===e&&s(i)}))}catch(h){o(h)}}))}))}forEach(t){if("function"!=typeof t)throw new Error("iteratee must be a function");this.ARRAY_FIELD.forEach(t)}forEachAsync(t){if("function"!=typeof t)throw new Error("iteratee must be a function");let e=0;const i=this.ARRAY_FIELD.length;return 0===i?Promise.resolve():new Promise(((n,s)=>{this.ARRAY_FIELD.forEach(((o,r)=>{try{t(o,r,(()=>{e++,e===i&&n()}))}catch(a){s(a)}}))}))}filterAsync(t){if("function"!=typeof t)throw new Error("iteratee must be a function");let e=0;const i=this.ARRAY_FIELD.length;return 0===i?Promise.resolve([]):new Promise(((n,s)=>{const o=[];try{this.ARRAY_FIELD.forEach(((s,r)=>{t(s,(t=>{o[r]=t,e++,e===i&&n(this.ARRAY_FIELD.filter(((t,e)=>o[e])))}))}))}catch(r){s(r)}}))}indexOf(t,e){if("number"!=typeof(e=null==e?0:e))throw new Error("searchElement must be a number");if(e<0)throw new Error("searchElement must be over number than 0");return this.ARRAY_FIELD.indexOf(t,e)}clear(t){this.ARRAY_FIELD.length=0,!0!==t&&this.dispatchEvent(new Event("remove_all"))}push(t,e){return this.ARRAY_FIELD.push(t),!0!==e&&this.dispatchEvent(new CustomEvent("insert_at",{detail:{index:this.ARRAY_FIELD.length-1,value:t}})),this.ARRAY_FIELD.length}insertAt(t,e,i){if("number"!=typeof t)throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");return this.ARRAY_FIELD.splice(t,0,e),!0!==i&&this.dispatchEvent(new CustomEvent("insert_at",{detail:{index:t,value:e}})),this.ARRAY_FIELD.length}toArray(){const t=[];return this.ARRAY_FIELD.forEach((e=>{t.push(e)})),t}getAt(t){if("number"!=typeof t)throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");if(t>=this.ARRAY_FIELD.length)throw new Error("index must be lower number than "+this.ARRAY_FIELD.length);return this.ARRAY_FIELD[t]}setAt(t,e,i){if("number"!=typeof t)throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");t>this.ARRAY_FIELD.length&&(this.ARRAY_FIELD.length=t);const n=this.ARRAY_FIELD[t];return this.ARRAY_FIELD[t]=e,!0!==i&&this.dispatchEvent(new CustomEvent("set_at",{detail:{index:t,prevValue:n,value:e}})),n}removeAt(t,e){if("number"!=typeof t)throw new Error("index must be a number");if(t<0)throw new Error("index must be over number than 0");if(t>=this.ARRAY_FIELD.length)throw new Error("index must be lower number than "+this.ARRAY_FIELD.length);const i=this.ARRAY_FIELD[t];return this.ARRAY_FIELD.splice(t,1),!0!==e&&this.dispatchEvent(new CustomEvent("remove_at",{detail:{index:t,prevValue:i}})),i}pop(t){const e=this.ARRAY_FIELD.length-1,i=this.ARRAY_FIELD.pop();return!0!==t&&this.dispatchEvent(new CustomEvent("remove_at",{detail:{index:e,value:i}})),i}getLength(){return this.ARRAY_FIELD.length}reverse(){this.ARRAY_FIELD.reverse()}sort(t){"function"==typeof t?this.ARRAY_FIELD.sort(t):this.ARRAY_FIELD.sort()}}const V=t=>{if(t&&(t.classList&&t.classList.contains("_gmh_css_")?t.classList.remove("_gmh_css_"):t.className&&t.className.indexOf("_gmh_css_")>-1&&(t.className=t.className.replace("_gmh_css_","")),t.shadowRoot)){let e=t.getAttribute("style")||"";e&&e.indexOf("--mkg-background-color")>-1&&(e=e.replace("--ion-background-color: var(--mkg-background-color) !important;","").replace("--background-color: var(--mkg-background-color) !important;","").replace("--background: var(--mkg-background-color) !important;","")),t.setAttribute("style",e);const i=t.querySelectorAll("*");Array.prototype.splice(i,0).forEach((t=>V(t)))}},Z=t=>!!t&&!!(t.classList&&t.classList.contains("_gmh_css_")||t.className&&t.className.indexOf("_gmh_css_")>-1);class j extends M{constructor(){super(),this.shadow=this.attachShadow({mode:"open"}),this.template=document.createElement("template"),this._keepParentNode=null,this.projection=new B,this._execQueue=new $,this._bind_onExecute=()=>this.onExecute(),this._bind_onInitStatusChanged=t=>this._onInitStatusChanged(t),this.bufferedCommands=[],this.cmdQueue=window.mkgeeklab.googlemaps.getCommandQueue("api"),this.addEventListener("initStatus_changed",this._bind_onInitStatusChanged)}getShadowRoot(){return this.shadow}getProjection(){return this.projection}onChildrenRemoved(t){const e=t.map((t=>t.__pluginDomId));this.execPromise(this.viewId,"detachOverlayFromMap",e)}remove(){super.remove(),this.execPromise(this.viewId,"releaseView",[{id:this.__pluginDomId}])}execPromise(t,e,i=[],n={}){return this.isRemoved?Promise.reject(`<${this.tagName} __pluginDomId="${this.viewId}"> has been already removed`):this.cmdQueue&&this.initStatus<b&&"GoogleMaps"===t?this.cmdQueue.execPromise(t,e,i,n):new Promise(((s,o)=>{this._execQueue.push({pluginName:t,methodName:e,args:i,execOptions:n,onSuccess:s,onError:o})}))}async connectedCallback(){await super.connectedCallback(),this.style.overflow="hidden !important";let t=this.parentElement;for(;t&&t.nodeType===Node.ELEMENT_NODE;){if(!Z(t)){let e=P(t,"--background");e||(e=P(t,"background-color")),e=(e||"").trim(),L(t)}t=t.parentElement}this._keepParentNode=this.parentElement}disconnectedCallback(){super.disconnectedCallback(),this.initStatus=y;let t=this._keepParentNode;for(;t&&t.nodeType===Node.ELEMENT_NODE;)Z(t)&&V(t),t=t.parentElement;this._keepParentNode=null}_onInitStatusChanged(t){const e=t.detail.status;e===b?(this._execQueue.addEventListener("insert_at",this._bind_onExecute),this._execQueue.dispatchEvent(new CustomEvent("insert_at")),this.bufferedCommands.forEach((t=>{this._execQueue.push(t)})),this.bufferedCommands=[]):e===y&&this._execQueue.removeEventListener("insert_at",this._bind_onExecute)}onExecute(){if(!this.cmdQueue)return;const t=this.getId();for(;this._execQueue.getLength()>0;){const e=this._execQueue.removeAt(0,!0);e&&(e.pluginName="(parent)"===e.pluginName?t:e.pluginName,this.cmdQueue.execPromise(e.pluginName,e.methodName,e.args,e.execOptions).then(e.onSuccess).catch(e.onError))}}onCommandFromChildren(t){this.getId();const e=t.detail;this.initStatus!==b?e.forEach((t=>{this.bufferedCommands.push(t)})):(this.bufferedCommands.length>0&&(this.bufferedCommands.forEach((t=>{this._execQueue.push(t)})),this.bufferedCommands=[]),e.forEach((t=>{this._execQueue.push(t)})))}}const J=(t,e)=>null!==t&&null!==e&&(t instanceof N&&(t=t.toJSON()),e instanceof N&&(e=e.toJSON()),D(t)&&D(e)&&t.lat===e.lat&&t.lng===e.lng),H=(t,e)=>{let i=P(t,`--${e}`);if(""!==i&&null!=i){if("string"==typeof i){i=i.trim();const t=i.toLowerCase();if("true"===t||"false"===t)return"true"===i;if("none"===t||"undefined"===t)return}return i}},q=t=>{if(!window.mkgeeklab||!window.mkgeeklab.googlemaps)return;if(t in window.mkgeeklab.googlemaps.elements)return window.mkgeeklab.googlemaps.elements[t];const e=Array.from(document.querySelectorAll("*")).filter((e=>e.__pluginDomId===t));return 1===e.length?(window.mkgeeklab.googlemaps.elements[t]=e[0],e[0]):void delete window.mkgeeklab.googlemaps.elements[t]},Y=t=>{if(!k(t))throw new Error(`[getElementRect] given element ${t.tagName} is not supported.`);const e={left:0,top:0,width:0,height:0},i=t.getBoundingClientRect();return t===document.body?(e.left=Math.max(i.left,window.pageXOffset),e.top=Math.max(i.top,window.pageYOffset),e.width=Math.max(i.width,window.innerWidth),e.height=Math.max(i.height,window.innerHeight)):(e.left=i.left,e.top=i.top,e.width=i.width,e.height=i.height),e};window.getElementRect=Y;var Q,G,X=[],K="ResizeObserver loop completed with undelivered notifications.";(G=Q||(Q={})).BORDER_BOX="border-box",G.CONTENT_BOX="content-box",G.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box";var tt,et=function(t){return Object.freeze(t)},it=function(t,e){this.inlineSize=t,this.blockSize=e,et(this)},nt=function(){function t(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,et(this)}return t.prototype.toJSON=function(){var t=this;return{x:t.x,y:t.y,top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),st=function(t){return t instanceof SVGElement&&"getBBox"in t},ot=function(t){if(st(t)){var e=t.getBBox(),i=e.width,n=e.height;return!i&&!n}var s=t,o=s.offsetWidth,r=s.offsetHeight;return!(o||r||t.getClientRects().length)},rt=function(t){var e;if(t instanceof Element)return!0;var i=null===(e=null==t?void 0:t.ownerDocument)||void 0===e?void 0:e.defaultView;return!!(i&&t instanceof i.Element)},at="undefined"!=typeof window?window:{},ht=new WeakMap,lt=/auto|scroll/,dt=/^tb|vertical/,ct=/msie|trident/i.test(at.navigator&&at.navigator.userAgent),gt=function(t){return parseFloat(t||"0")},pt=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=!1),new it((i?e:t)||0,(i?t:e)||0)},mt=et({devicePixelContentBoxSize:pt(),borderBoxSize:pt(),contentBoxSize:pt(),contentRect:new nt(0,0,0,0)}),ut=function(t,e){if(void 0===e&&(e=!1),ht.has(t)&&!e)return ht.get(t);if(ot(t))return ht.set(t,mt),mt;var i=getComputedStyle(t),n=st(t)&&t.ownerSVGElement&&t.getBBox(),s=!ct&&"border-box"===i.boxSizing,o=dt.test(i.writingMode||""),r=!n&&lt.test(i.overflowY||""),a=!n&&lt.test(i.overflowX||""),h=n?0:gt(i.paddingTop),l=n?0:gt(i.paddingRight),d=n?0:gt(i.paddingBottom),c=n?0:gt(i.paddingLeft),g=n?0:gt(i.borderTopWidth),p=n?0:gt(i.borderRightWidth),m=n?0:gt(i.borderBottomWidth),u=c+l,f=h+d,_=(n?0:gt(i.borderLeftWidth))+p,v=g+m,b=a?t.offsetHeight-v-t.clientHeight:0,y=r?t.offsetWidth-_-t.clientWidth:0,E=s?u+_:0,w=s?f+v:0,C=n?n.width:gt(i.width)-E-y,I=n?n.height:gt(i.height)-w-b,x=C+u+y+_,L=I+f+b+v,S=et({devicePixelContentBoxSize:pt(Math.round(C*devicePixelRatio),Math.round(I*devicePixelRatio),o),borderBoxSize:pt(x,L,o),contentBoxSize:pt(C,I,o),contentRect:new nt(c,h,C,I)});return ht.set(t,S),S},ft=function(t,e,i){var n=ut(t,i),s=n.borderBoxSize,o=n.contentBoxSize,r=n.devicePixelContentBoxSize;switch(e){case Q.DEVICE_PIXEL_CONTENT_BOX:return r;case Q.BORDER_BOX:return s;default:return o}},_t=function(t){var e=ut(t);this.target=t,this.contentRect=e.contentRect,this.borderBoxSize=et([e.borderBoxSize]),this.contentBoxSize=et([e.contentBoxSize]),this.devicePixelContentBoxSize=et([e.devicePixelContentBoxSize])},vt=function(t){if(ot(t))return 1/0;for(var e=0,i=t.parentNode;i;)e+=1,i=i.parentNode;return e},bt=function(){var t=1/0,e=[];X.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(e){var i=new _t(e.target),s=vt(e.target);n.push(i),e.lastReportedSize=ft(e.target,e.observedBox),s<t&&(t=s)})),e.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,n=e;i<n.length;i++){(0,n[i])()}return t},yt=function(t){X.forEach((function(e){e.activeTargets.splice(0,e.activeTargets.length),e.skippedTargets.splice(0,e.skippedTargets.length),e.observationTargets.forEach((function(i){i.isActive()&&(vt(i.target)>t?e.activeTargets.push(i):e.skippedTargets.push(i))}))}))},Et=function(){var t,e=0;for(yt(e);X.some((function(t){return t.activeTargets.length>0}));)e=bt(),yt(e);return X.some((function(t){return t.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?t=new ErrorEvent("error",{message:K}):((t=document.createEvent("Event")).initEvent("error",!1,!1),t.message=K),window.dispatchEvent(t)),e>0},wt=[],Ct=function(t){if(!tt){var e=0,i=document.createTextNode("");new MutationObserver((function(){return wt.splice(0).forEach((function(t){return t()}))})).observe(i,{characterData:!0}),tt=function(){i.textContent="".concat(e?e--:e++)}}wt.push(t),tt()},It=0,xt={attributes:!0,characterData:!0,childList:!0,subtree:!0},Lt=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],St=function(t){return void 0===t&&(t=0),Date.now()+t},Pt=!1,kt=new(function(){function t(){var t=this;this.stopped=!0,this.listener=function(){return t.schedule()}}return t.prototype.run=function(t){var e=this;if(void 0===t&&(t=250),!Pt){Pt=!0;var i,n=St(t);i=function(){var i=!1;try{i=Et()}finally{if(Pt=!1,t=n-St(),!It)return;i?e.run(1e3):t>0?e.run(t):e.start()}},Ct((function(){requestAnimationFrame(i)}))}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var t=this,e=function(){return t.observer&&t.observer.observe(document.body,xt)};document.body?e():at.addEventListener("DOMContentLoaded",e)},t.prototype.start=function(){var t=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Lt.forEach((function(e){return at.addEventListener(e,t.listener,!0)})))},t.prototype.stop=function(){var t=this;this.stopped||(this.observer&&this.observer.disconnect(),Lt.forEach((function(e){return at.removeEventListener(e,t.listener,!0)})),this.stopped=!0)},t}()),Ot=function(t){!It&&t>0&&kt.start(),!(It+=t)&&kt.stop()},Tt=function(){function t(t,e){this.target=t,this.observedBox=e||Q.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var t,e=ft(this.target,this.observedBox,!0);return t=this.target,st(t)||function(t){switch(t.tagName){case"INPUT":if("image"!==t.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(t)||"inline"!==getComputedStyle(t).display||(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),Rt=function(t,e){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=e},Mt=new WeakMap,At=function(t,e){for(var i=0;i<t.length;i+=1)if(t[i].target===e)return i;return-1},Nt=function(){function t(){}return t.connect=function(t,e){var i=new Rt(t,e);Mt.set(t,i)},t.observe=function(t,e,i){var n=Mt.get(t),s=0===n.observationTargets.length;At(n.observationTargets,e)<0&&(s&&X.push(n),n.observationTargets.push(new Tt(e,i&&i.box)),Ot(1),kt.schedule())},t.unobserve=function(t,e){var i=Mt.get(t),n=At(i.observationTargets,e),s=1===i.observationTargets.length;n>=0&&(s&&X.splice(X.indexOf(i),1),i.observationTargets.splice(n,1),Ot(-1))},t.disconnect=function(t){var e=this,i=Mt.get(t);i.observationTargets.slice().forEach((function(i){return e.unobserve(t,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},t}(),Dt=function(){function t(t){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof t)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");Nt.connect(this,t)}return t.prototype.observe=function(t,e){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!rt(t))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");Nt.observe(this,t,e)},t.prototype.unobserve=function(t){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!rt(t))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");Nt.unobserve(this,t)},t.prototype.disconnect=function(){Nt.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}();class zt{constructor(t){this.children=[],this.zIndex=null,this.overflowX=0,this.overflowY=0,this.pointerEvents=1,this.rect={left:0,top:0,width:0,height:0},this.parent=null,this._positionChanged=!1,this.element=t,this.id=T(t)}equals(t){return!!(t&&t instanceof zt)&&S(this.toJSON(),t.toJSON())}toJSON(){if(!this.element)return{};const t=[];this.children.forEach((e=>{t.push(e.toJSON())}));const e=[];return this.zIndex&&(e.push(this.zIndex.isInherit?1:0),e.push(this.zIndex.z)),{c:t,t:this.pointerEvents,o:this.overflowX<<2|this.overflowY,r:[Math.round(this.rect.left),Math.round(this.rect.top),Math.round(this.rect.width),Math.round(this.rect.height)],i:this.id,z:e,n:this.element.tagName}}}class Ft{constructor(){this.cache={}}_clearInternalCache(){this.cache={}}_removeCacheById(t){delete this.cache[t]}getZIndex(t){if(!t)return null;t===document.body&&(this.cache={});let e=P(t,"z-index");const i=t.__pluginDomId,n=t.parentElement;let s;if(!n)return{z:0,isInherit:!0};const o=n.__pluginDomId;s=o in this.cache?this.cache[o]:this.getZIndex(n);const r=P(t,"position");let a=!1;return"unset"===e||"initial"===e||"relative"===r?e=0:"auto"===e||"inherit"===e?(e=0,a=!0):"string"==typeof e&&(e=parseInt(e,10)),null==e&&(e=0),this.cache[i]=e+(s?s.z:0),{isInherit:a,z:e}}}const Bt=window.ResizeObserver||Dt;class Wt{constructor(t){this.zManager=new Ft,this.mutationObserver=new MutationObserver(this.mutationListener.bind(this)),this.tree={},this.rootElement=null,this.actions={},this.cmdQueue=null,this.positionTimer=null,this.scrollEndCnt=0,this.isScrollEventProcessing=!1,this.resizeObserver=new Bt((t=>{window.requestAnimationFrame((()=>{this.onDomResize(t)}))})),this._bind_onScroll=t=>this.onDomScroll(t),this._bind_removeDomIdFromGMH=t=>this.removeDomIdFromGMH(t),this._bind_followViewElements=()=>this.followViewElements(),this._any_change=!1,this.overflowCssToNumber=(t,e)=>{switch(P(t,e)){case"hidden":case"scroll":return 1;case"visible":return 2}return 0},this.disconnect=()=>{this.mutationObserver.disconnect();Object.keys(this.tree).forEach((t=>{const e=this.tree[t];e&&(this.removeObservers(e.element),this.resizeObserver.unobserve(e.element),delete this.tree[t])}))},this.cmdQueue=t,this.actions.childList=this.onDomTreeChange.bind(this),this.actions.characterData=this.onAttrSize.bind(this),this.actions.attributes=this.onAttrSize.bind(this),window.addEventListener("gmhObservePositions",(()=>{this.positionTimer&&(clearTimeout(this.positionTimer),this.positionTimer=null),this._any_change=!0,this.scrollEndCnt=5,Promise.resolve().then(this._bind_followViewElements)}))}observe(t){this.rootElement||(this._any_change=!0,this.rootElement=t,this.invalidate(),this.mutationObserver.observe(this.rootElement,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["style","class"]}))}invalidate(){if(!this._any_change)return;if(!this.rootElement)throw new Error("this.rootElement is null");this.tree={},this.scrollEndCnt=0;const t=this.buildTree(this.rootElement);if(!t)throw new Error("partTree is null");this._any_change=!1;const e=t.parent?t.parent.id:"";this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:e,t:t.toJSON()}],"invalidate"],{sync:!0})}updateDomRect(t){t.element&&(t.rect=Y(t.element),t.children.forEach(this.updateDomRect.bind(this)))}removeObservers(t){if(t instanceof HTMLElement){const e=t.__pluginDomId;if(e){const i=this.tree[e];i&&(i.parent=null),delete this.tree[e],Reflect.deleteProperty(t,"__pluginDomId"),Reflect.deleteProperty(t,"__isShadowChildren")}}t.removeEventListener("scroll",this._bind_onScroll),t.removeEventListener("transitionstart",this._bind_onScroll),t.removeEventListener("transitionrun",this._bind_onScroll),t.removeEventListener("transitionend",this._bind_onScroll),t.removeEventListener("transitioncancel",this._bind_onScroll),this.resizeObserver.unobserve(t);let e=[];e=t instanceof HTMLSlotElement?Array.prototype.slice.call(t.assignedElements()):t.shadowRoot?Array.prototype.slice.call(t.shadowRoot.children,0):Array.prototype.slice.call(t.children,0),e.forEach((t=>{this.removeObservers(t)}))}buildTree(t){if(!t||!O(t))return null;void 0===t.__pluginDomId&&(this.resizeObserver.observe(t),t.addEventListener("scroll",this._bind_onScroll),t.addEventListener("transitionstart",this._bind_onScroll),t.addEventListener("transitionrun",this._bind_onScroll),t.addEventListener("transitionend",this._bind_onScroll),t.addEventListener("transitioncancel",this._bind_onScroll));const e=T(t);let i=null;e in this.tree&&(i=this.tree[e],i.element!==t&&(delete this.tree[e],i=null)),i||(i=new zt(t)),i.zIndex=this.zManager.getZIndex(t),i.pointerEvents="none"===P(t,"pointer-events")?0:1,i.overflowX=this.overflowCssToNumber(t,"overflow-x"),i.overflowY=this.overflowCssToNumber(t,"overflow-y");const n=Y(t),s=[];let o=[];return o=t instanceof HTMLSlotElement?Array.prototype.slice.call(t.assignedElements()):t.shadowRoot&&t.shadowRoot.children.length>0?Array.prototype.slice.call(t.shadowRoot.children,0):Array.prototype.slice.call(t.children,0),o.forEach(((t,e)=>{const n=t.tagName;if(n.startsWith("g-")&&!n.endsWith("view"))return;const o=this.buildTree(t);o&&(o.parent=i,s.push(o))})),i.rect=n,i.children=s,this.tree[e]=i,i}onDomScroll(t){if(this._any_change=!0,this.isScrollEventProcessing)return void(this.positionTimer=setTimeout(this._bind_followViewElements,20));this.positionTimer&&(clearTimeout(this.positionTimer),this.positionTimer=null),this.scrollEndCnt=5,this.isScrollEventProcessing=!0;const e=t.target;if(!(T(e)in this.tree))return this.isScrollEventProcessing=!1,void(this.positionTimer=setTimeout(this._bind_followViewElements,20));const i=this.buildTree(e);if(!i)return;if(!i.zIndex)return;const n=i.parent?i.parent.id:T(i.element.parentElement);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:n,t:i.toJSON()}],"onDomScroll"],{sync:!1}).then((()=>{this.isScrollEventProcessing=!1,this.positionTimer=setTimeout(this._bind_followViewElements,20)}))}onDomResize(t){this._any_change=!0;const e=[],i=new Set;if(t.forEach((t=>{if(t.target.nodeType!==Node.ELEMENT_NODE||t.target instanceof SVGElement)return;const n=t.target,s=T(n);if(!(s in this.tree))return;if(i.has(s))return;const o=this.buildTree(n);if(!o)return;if(!o.zIndex)return;const r=o.parent?o.parent.id:T(o.element.parentElement);i.has(r)||(i.add(s),e.push({p:r,t:o.toJSON()}))})),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e.splice(0,3),"onDomResize"]);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e,"onDomResize"],{sync:!1})}}onDomTreeChange(t){if(this._any_change=!0,t.addedNodes&&t.addedNodes.length>0){const e=[];if(t.addedNodes.forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,n=i.parentElement;if(!n)return;const s=T(i);let o=null;if(s in this.tree&&(o=this.tree[s]),o||(o=this.buildTree(n)),!o||!o.zIndex)return;const r=o.parent?o.parent.id:T(o.element.parentElement);e.push({p:r,t:o.toJSON()})})),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e.splice(0,3),"onDomTreeChange"]);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[e,"onDomTreeChange"],{sync:!1})}}if(t.removedNodes&&t.removedNodes.length>0){const e=[];if(t.removedNodes.forEach((t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t;this.removeObservers(i);const n=i.__pluginDomId;if(!n)return;const s=this.tree[n];let o="";s&&s.parent&&(o=s.parent.id+"",o&&o in this.tree&&(s.parent.children=this.tree[o].children.filter((t=>s!==t))),s.parent=null),e.push({p:o,i:n}),this.removeDomIdFromGMH(i)})),e.length>0){for(;e.length>3;)this.cmdQueue.execPromise("GoogleMaps","removeFromDomTree",e.splice(0,3));this.cmdQueue.execPromise("GoogleMaps","removeFromDomTree",e,{sync:!0})}}}removeDomIdFromGMH(t){if(!t)return;const e=t.__pluginDomId;e&&(delete window.gmh.elements[e],Array.from(t.children).forEach(this._bind_removeDomIdFromGMH))}onAttrSize(t){if(this._any_change=!0,t.target.nodeType!==Node.ELEMENT_NODE)return;const e=t.target,i=e.__pluginDomId;if(!i)return;if("none"!==P(e,"transform"))e.dispatchEvent(((t,e={})=>{let i;return"function"==typeof CustomEvent?i=new CustomEvent(t,{bubbles:!0,detail:e||null}):(i=document.createEvent("Event"),i.initEvent(t,!0,!1),e&&Object.keys(e).forEach((t=>{t in e||Reflect.defineProperty(i,t,{value:e[t],writable:!1,enumerable:!0})}))),i})("gmhObservePositions"));else{const t=this.buildTree(e),n=this.tree[i];if(!n||!t||n.equals(t))return;const s=t.parent?t.parent.id:T(t.element.parentElement);this.cmdQueue.execPromise("GoogleMaps","updateDomTree",[[{p:s,t:t.toJSON()}],"onAttrSize"],{sync:!1})}}followViewElements(){0===this.scrollEndCnt?this.invalidate():(this.scrollEndCnt-=1,this.positionTimer=setTimeout(this._bind_followViewElements,20))}mutationListener(t,e){t.forEach((t=>{this.actions[t.type].call(this,t)}))}}const Ut=t=>{if(!t||"string"!=typeof t)return!1;if("#"===t[0])return!!(/^#[0-9A-F]{3}$/i.test(t)||/^#[0-9A-F]{4}$/i.test(t)||/^#[0-9A-F]{6}$/i.test(t)||/^#[0-9A-F]{8}$/i.test(t));if(t.includes("rgba")){const e=t.match(/^rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*((?:(?:0+)|1)\.[0-9]+)\s*\)$/i);return null!=e&&5===e.length&&(!(parseInt(e[1],10)<0||parseInt(e[1],10)>255||parseInt(e[2],10)<0||parseInt(e[2],10)>255||parseInt(e[3],10)<0||parseInt(e[3],10)>255)&&!(parseFloat(e[4])<0||parseFloat(e[4])>1))}if(t.includes("rgb")){const e=t.match(/^rgb\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\)$/i);return null!=e&&4===e.length&&!(parseInt(e[1],10)<0||parseInt(e[1],10)>255||parseInt(e[2],10)<0||parseInt(e[2],10)>255||parseInt(e[3],10)<0||parseInt(e[3],10)>255)}return(t=t.toLowerCase())in f},$t=(t,e=1)=>{if(!Ut(t))throw new Error(`"${t}" is unknown color value`);if("number"!=typeof e||e<0||e>1)throw new Error("The second argument of HTMLColor2RGBA() must be a value from 0.0 to 1.0");let i,n=Math.floor(255*e),s=t.toLowerCase();if(s in f&&(s=f[s]),"#"===s[0]&&4===s.length){if(i=s.match(/^#([0-9A-F])([0-9A-F])([0-9A-F])$/i),i){const t=parseInt(i[1],16),e=parseInt(i[2],16),s=parseInt(i[3],16);return[(t<<4)+t,(e<<4)+e,(s<<4)+s,n]}throw new Error(`Can not parse color: ${t}`)}if("#"===s[0]&&5===s.length){if(i=s.match(/^#([0-9A-F])([0-9A-F])([0-9A-F])([0-9A-F])$/i),i){const t=parseInt(i[1],16),e=parseInt(i[2],16),n=parseInt(i[3],16),s=parseInt(i[4],16);return[(t<<4)+t,(e<<4)+e,(n<<4)+n,(s<<4)+s]}throw new Error(`Can not parse color: ${t}`)}if("#"===s[0]&&7===s.length){if(i=s.match(/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i),i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),n]}throw new Error(`Can not parse color: ${t}`)}if("#"===s[0]&&9===s.length){if(i=s.match(/^#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i),i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),parseInt(i[4],16)]}throw new Error(`Can not parse color: ${t}`)}if(s.match(/^rgba?\([\d,.\s]+\)$/)){if(i=s.match(/([\d.]+)/g),!i){const t=btoa(JSON.stringify({case:"Can not parse color information correctly",colorStr:s}));throw new Error(`Please report this error message: ${t}`)}return n=4===i.length?Math.floor(255*parseFloat(i[3])):n,[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),n]}throw new Error(`Can not parse color: ${t}`)};class Vt extends M{static get observedAttributes(){return["class","id"]}constructor(){super(),this._hasMap=!1,this._parentView=null,this._execQueue=new $,this._bind_onExecute=()=>this._onExecute(),this._bind_runExecute=()=>this._runExecute(),this._bind_applyOptions=()=>this._applyOptions(),this._bind_onPropertyChanged=t=>this._onPropertyChanged(t),this._bind_redraw=()=>this.onRedraw(),this._exec_delay_timer=null,this.setAttributeChangeListener("class",this._bind_redraw),this.setAttributeChangeListener("id",this._bind_redraw)}onRedraw(){}getVisible(){return this.state.get("visible")}setVisible(t){this.state.set("visible",!0===t)}setHasMap(t){this._hasMap=t}get hasMap(){return this._hasMap}setParentView(t){this._parentView=t,t&&(t.ready?this._runExecute():t.addEventListener("ready",this._bind_runExecute,{once:!0}))}_runExecute(){this._execQueue.dispatchEvent(new CustomEvent("insert_at"))}get parentView(){return this._parentView}_onPropertyChanged(t){const e=t.detail.key,i=t.detail.value,n=this.state.get("waitOptions")||{};n[e]=i,this.state.set("waitOptions",n);const s=this.state.get("propEventTimer");void 0!==s&&clearTimeout(s),this.state.set("propEventTimer",setTimeout(this._bind_applyOptions,100))}_applyOptions(){if(!this.isConnected||this.initStatus!==b){const t=this.state.get("propEventTimer");return void 0!==t&&clearTimeout(t),void this.state.set("propEventTimer",setTimeout(this._bind_applyOptions,100))}const t=this.state.get("waitOptions")||{};0!==Object.keys(t).length&&(this.state.set("waitOptions",{}),this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},t]))}execPromise(t,e,i=[],n={}){return this.isRemoved?Promise.reject(`<${this.tagName} __pluginDomId="${this.viewId}"> has been already removed`):new Promise(((s,o)=>{const r={pluginName:t,methodName:e,args:i,execOptions:n,onSuccess:s,onError:o};this.initStatus<b&&"GoogleMaps"===t?this.dispatchCmdEvent([r]):this._execQueue.push({pluginName:t,methodName:e,args:i,execOptions:n,onSuccess:s,onError:o})}))}_onExecute(){if(!this.hasEventListener("command"))return;if(null===this._exec_delay_timer)return void(this._exec_delay_timer=setTimeout(this._bind_onExecute,10));let t=[];for(;this._execQueue.getLength()>0;){const e=this._execQueue.removeAt(0,!0);e&&(e.execOptions.sync?(this.dispatchCmdEvent(t),t=[],this.dispatchCmdEvent([e])):t.push(e))}this.dispatchCmdEvent(t),this._exec_delay_timer=null}dispatchCmdEvent(t=[]){t.length>0&&!this.isRemoved&&this.dispatchEvent(new CustomEvent("command",{detail:t}))}remove(){super.remove(),this.setAttributeChangeListener("class",void 0),this.setAttributeChangeListener("id",void 0)}async onConnected(){await super.onConnected();let t=this.parentElement;for(;t;){if(t instanceof j)return this.setParentView(t),void this._execQueue.addEventListener("insert_at",this._bind_onExecute);t=t.parentElement}throw new Error("Overlay (marker, polygon, etc) must be under <mkg-mapview> tag")}async disconnectedCallback(){await super.disconnectedCallback(),this.setParentView(null),this.isRemoved||this._execQueue.removeEventListener("insert_at",this._bind_onExecute)}}const Zt=t=>t instanceof Event&&"detail"in t,jt=t=>"string"==typeof t?"true"===t.toLowerCase():"boolean"==typeof t&&t,Jt=t=>{const e=t.split(",").map((t=>parseFloat(t)));if(2!==e.length)throw new Error(`Can not parse latLng string: "${t}"`);return{lat:Math.max(-90,Math.min(90,e[0])),lng:Math.max(-180,Math.min(180,e[1]))}};class Ht extends Vt{static get observedAttributes(){return["class","id","position"]}constructor(t){super(),this._bind_onPositionChangedFromNative=t=>this._onPositionChangedFromNative(t),this._bind_onPositionChanged=t=>this._onPositionChanged(t),this.state.set("position",{lat:0,lng:0}),this.state.set("visible",!0),this.state.set("draggable",!1),this.state.set("position",void 0),this.state.set("initOptions",t),this.state.set("propEventTimer",void 0)}_onPositionChanged(t){if(this.dispatchEvent(t),this._childLatLng){const e=t.detail;this._childLatLng.lat=e.value.lat,this._childLatLng.lng=e.value.lng}}onRedraw(){this.initStatus<b||this.applyOptionsToState()}getClickable(){return this.state.get("clickable")}setClickable(t){this.state.set("clickable",!0===t)}getDraggable(){return this.state.get("draggable")}setDraggable(t){this.state.set("draggable",!0===t)}applyOptionsToState(t){const e={visible:this.state.get("visible"),clickable:this.state.get("clickable"),dragable:this.state.get("dragable"),icon:this.state.get("icon"),position:this.state.get("position"),zIndex:this.state.get("zIndex"),extra:this.state.get("extra")};["visible","clickable","draggable"].forEach((t=>{const i=H(this,`mkg-${t}`);void 0!==i&&(e[t]=jt(i))}));const i=H(this,"mkg-icon")+"";i&&(e.icon=this._normalizedIcon(i));const n=H(this,"mkg-z-index")+"";""!==n&&(e.zIndex=parseInt(n.replace(/[^\d].*$/g,""),10));const s=this.getAttribute("position");if(s&&(e.position=Jt(s)),t){if("extra"in t&&(e.extra=t.extra),"boolean"==typeof t.visible&&(e.visible=!0===t.visible),"boolean"==typeof t.clickable&&(e.clickable=!0===t.clickable),"boolean"==typeof t.draggable&&(e.draggable=!0===t.draggable),t.icon&&(e.icon=this._normalizedIcon(t.icon)),"number"==typeof t.zIndex){if(!Number.isInteger(t.zIndex))throw new Error("MarkerOptions.zIndex must be an integer value");e.zIndex=t.zIndex}t.position&&this.setPosition(t.position)}isNaN(e.zIndex)&&(e.zIndex=0),Object.keys(e).forEach((t=>{this.state.set(t,e[t])}))}_onPositionChangedFromNative(t){if(!Zt(t))return;const e=t.detail.latLng;this.state.set("position",e)}onCommandFromChildren(t){const e=t.detail;if("setPosition"===e.methodName)this.setPosition(e.latLng)}getPosition(){const t=this.state.get("position");return{lat:t.lat,lng:t.lng}}setPosition(t){if(!D(t))throw new Error("setPosition() accepts only ILatLng value");{const e=this.state.get("position");J(e,t)||this.state.set("position",t)}}_normalizedIcon(t){if(t){if(Ut(t))return{type:"color",value:$t(t)};if(/url\([\"']?([^\"']+)[\"']?\)/i.test(t)){t=t.replace(/\\+/g,"").replace(/url\([\"']?([^\"']+)[\"']?\)/i,"$1");const e=new URL(t,location.href);return{type:"img",value:`${e.protocol}//${e.host}${e.pathname}${e.search}`}}}return{type:"color",value:$t("red")}}_normalizedPosition(t){if(t instanceof N)return t.toJSON();if(D(t))return{lat:t.lat,lng:t.lng};if("string"==typeof t)return Jt(t);throw new Error(`Can not parse given value : ${t}`)}async onConnected(){if(await super.onConnected(),this.state.addEventListener("visible_changed",this._bind_onPropertyChanged),this.state.addEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.addEventListener("draggable_changed",this._bind_onPropertyChanged),this.state.addEventListener("icon_changed",this._bind_onPropertyChanged),this.state.addEventListener("position_changed",this._bind_onPropertyChanged),this.state.addEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.addEventListener("position_changed",this._bind_onPositionChanged),this.addEventListener("dragstart",this._bind_onPositionChangedFromNative),this.addEventListener("drag",this._bind_onPositionChangedFromNative),this.addEventListener("dragend",this._bind_onPositionChangedFromNative),this.hasMap||this.initStatus===v)return;this.setHasMap(!0);const t=Array.from(this.children).filter(((t,e,i)=>(console.log(t,t instanceof N),t instanceof N)));if(t.length>1)throw new Error("<mkg-marker> can have only one <mkg-latlng>");new Promise((e=>{let i=this.state.get("position");1===t.length&&(this._childLatLng=t[0],i=this._childLatLng.toJSON(),this.state.set("position",i));const n=this.state.get("initOptions");n&&n.position&&"position"in n&&n.position&&(D(n.position)?this.state.set("position",n.position):n.position instanceof N&&this.state.set("position",n.position.toJSON())),this.initStatus===_?(this.initStatus=v,this.execPromise("(parent)","createMarker",[{id:this.viewId},{position:this.state.get("position"),visible:!1}]).then(e)):this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{position:this.state.get("position"),visible:!1}]).then(e)})).then((()=>this.execPromise("(parent)","attachOverlayToMap",[{id:this.viewId}]))).then((()=>{this.initStatus=b;const t=H(this,"mkg-icon");t?(this.state.set("icon",t),this.state.set("calculatedIcon",this._normalizedIcon(t))):this.state.set("calculatedIcon",{type:"color",value:$t("red")});const e=this.state.get("initOptions");this.applyOptionsToState(e),this.state.trigger("visible_changed",{key:"visible",prevValue:void 0,value:this.state.get("visible")}),this.state.set("initOptions",void 0)}))}async onDisconnected(){await super.onDisconnected(),this.state.removeEventListener("visible_changed",this._bind_onPropertyChanged),this.state.removeEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("draggable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("icon_changed",this._bind_onPropertyChanged),this.state.removeEventListener("position_changed",this._bind_onPropertyChanged),this.state.removeEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.removeEventListener("position_changed",this._bind_onPositionChanged),this.removeEventListener("dragstart",this._bind_onPositionChangedFromNative),this.removeEventListener("drag",this._bind_onPositionChangedFromNative),this.removeEventListener("dragend",this._bind_onPositionChangedFromNative),this.hasMap&&this.initStatus===b&&this.execPromise("(parent)","detachOverlayFromMap",[{id:this.getId()}]).then((()=>{this.setHasMap(!1)}))}}class qt extends Vt{static get observedAttributes(){return["class","id","content"]}constructor(t=5){super(),this._frame=document.createElement("div"),this._contentBox=document.createElement("div"),this._bind_onPositionChanged=()=>this._onPositionChanged(),this._bind_onTargetDisconnected=()=>this.close(),this._bind_onStyleChanged=()=>{this._canvas&&(this.onClear(this._canvas),this.onCanvas(this._canvas),this._onPositionChanged())},this._binds={},this.platformId=window.mkgeeklab.googlemaps.getPlatformId(),this._target=null,this._slot=null,this._canvas=document.createElement("canvas"),this._isSafari=window.navigator.userAgent.includes("AppleWebKit"),this._options={padding:5,canvasSize:{width:0,height:0},contentSize:{width:0,height:0},anchorPosition:{x:0,y:0},contentPosition:{x:0,y:0},content:"",shapeType:"poly",tailSize:{width:10,height:15},shapeCoords:[]},this.DOMevents=["click","touchstart","touchend","mousedown","mouseup","mousemove"],this.assignedListeners=!1,this.isOpen=!1,this._options.padding=t,this._frame.style.position="relative",this._frame.style.display="block",this._frame.style.width="auto",this._frame.style.height="auto",this._frame.style.overflow="hidden",this._contentBox.style.position="relative",this._contentBox.style.left="0px",this._contentBox.style.top="0px",this._contentBox.style.display="inline-block",this._contentBox.style.padding="0px",this._contentBox.style.boxSizing="content-box",this._contentBox.style.minWidth="50px",this._contentBox.style.width="auto",this._contentBox.style.height="auto",this._contentBox.style.cursor="pointer",this._contentBox.style.userSelect="none",this._contentBox.style.pointerEvents="auto",this._canvas.width=900,this._canvas.height=900,this._canvas.style.position="absolute",this._canvas.style.zIndex="-1",this._canvas.style.left="0px",this._canvas.style.top="0px",this.setAttributeChangeListener("class",this._bind_onStyleChanged),this.setAttributeChangeListener("id",this._bind_onStyleChanged)}getPadding(){return this._options.padding}onCanvas(t){throw new Error("Please override the onCanvas method")}onContentMeasure(t,e){return{width:t,height:e}}getContentSize(){return{width:this._options.contentSize.width,height:this._options.contentSize.height}}onContentPosition(t,e){return{x:t,y:e}}getContentPosition(){return{x:this._options.contentPosition.x,y:this._options.contentPosition.y}}onAnchorPosition(t,e){return{x:t,y:e}}getAnchorPosition(){return{x:this._options.anchorPosition.x,y:this._options.anchorPosition.y}}onCanvasMeasure(t,e){return{width:t,height:e}}getCanvasSize(){return{width:this._options.canvasSize.width,height:this._options.canvasSize.height}}onTailSize(t,e){return{width:t,height:e}}getTailSize(){return{width:this._options.tailSize.width,height:this._options.tailSize.height}}addEventListener(t,e,i){let n=e._hashCode;if(n||(n=Math.floor(Date.now()*Math.random()).toString(),Reflect.defineProperty(e,"_hashCode",{value:n,writable:!1,enumerable:!1})),this._binds[t]=this._binds[t]||{},this.DOMevents.indexOf(t)>-1){const i=t=>{const i=t;e(new MouseEvent(t.type,{screenX:i.screenX,screenY:i.screenY,clientX:i.clientX,clientY:i.clientY,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,altKey:i.altKey,metaKey:i.metaKey,button:i.button,buttons:i.buttons,relatedTarget:this._canvas}))};this._binds[t][n]=i,this._frame.addEventListener(t,i,!0)}else this._binds[t][n]=e,super.addEventListener(t,e)}removeEventListener(t,e){if(t in this._binds){const i=e._hashCode;i&&i in this._binds[t]&&(t in this.DOMevents?this._frame.removeEventListener(t,this._binds[t][i]):super.removeEventListener(t,this._binds[t][i]),delete this._binds[t][i])}}onClear(t){const e=t.getContext("2d");e&&e.clearRect(0,0,t.width,t.height)}onDraw(){null!==this._contentBox.parentElement&&this._frame.removeChild(this._contentBox),this.style.overflow="visible",this._frame.innerHTML="",this._frame.appendChild(this._contentBox),this._frame.style.width="90vmax",this._frame.style.height="90vmax",this._contentBox.style.position="static",this._contentBox.style.width="auto",this._contentBox.style.height="auto",this._contentBox.style.padding="1px",this._frame.style.overflow="visible","string"==typeof this._options.content?(this._contentBox.style.whiteSpace="pre-wrap",this._contentBox.innerHTML=this._options.content):this._options.content?1===this._options.content.nodeType?(this._contentBox.innerHTML="",this._contentBox.appendChild(this._options.content)):this._contentBox.innerText=`${this._options.content}`:this._contentBox.innerText="";const t=this._contentBox.offsetWidth,e=this._contentBox.offsetHeight;this._contentBox.style.padding="0px";const i=this.onContentMeasure(t,e);this._options.contentSize.width=i.width,this._options.contentSize.height=i.height;const n=this.onTailSize(this._options.tailSize.width,this._options.tailSize.height);this._options.tailSize.width=n.width,this._options.tailSize.height=n.height;const s=this.onCanvasMeasure(this._options.contentSize.width+2*this._options.padding,this._options.contentSize.height+2*this._options.padding+this._options.tailSize.height);this._options.canvasSize.width=s.width,this._options.canvasSize.height=s.height;const o=this.onContentPosition(this._options.padding,this._options.padding);this._options.contentPosition.x=o.x,this._options.contentPosition.y=o.y;const r=this.onAnchorPosition(this._options.canvasSize.width/2,this._options.canvasSize.height);this._options.anchorPosition.x=r.x,this._options.anchorPosition.y=r.y,this._frame.style.width=`${this._options.canvasSize.width}px`,this._frame.style.height=`${this._options.canvasSize.height}px`,this._frame.style.overflow="hidden",this.style.position="absolute",this.style.zIndex="-100000",this.style.width="1px",this.style.height="1px",this._frame.appendChild(this._canvas),this._options.shapeCoords=[],this.onClear(this._canvas),this.onCanvas(this._canvas),this._contentBox.style.position="absolute",this._contentBox.style.left=`${this._options.contentPosition.x}px`,this._contentBox.style.top=`${this._options.contentPosition.y}px`,this._contentBox.style.width=`${this._options.contentSize.width}px`,this._contentBox.style.height=`${this._options.contentSize.height}px`,this.style.position="absolute",this.style.zIndex="1",this.style.width="0px",this.style.height="0px",this.style.left="0px",this.style.top="0px",this.style.visibility="visible"}get content(){return this._options.content}set content(t){this.setContent(t)}setContent(t){null==t&&(t=""),this._options.content!==t&&(this._options.content=t,this.isOpen&&this.onDraw())}getContent(){return this._options.content}async open(t){if(!(t&&t instanceof Ht))return;this.isOpen=!0,t.ready||await new Promise((e=>{t.addEventListener("ready",(()=>e()),{once:!0})})),this.parentView||await new Promise((t=>{this.initStatus=v,this.addEventListener("ready",(()=>{this.setHasMap(!0),t()}),{once:!0})})),this._target=t;const e=this.parentView;if(!this._slot){const t=e.getShadowRoot();this._slot=document.createElement("slot");const i=t.querySelector("div.info_layer");i&&i.appendChild(this._slot),this._isSafari?(this._slot.name=this.viewId,this.setAttribute("slot",this.viewId)):this._slot.assign(this)}this.onDraw(),this._onPositionChanged(),this.assignedListeners||(this.assignedListeners=!0,e.addEventListener("camera_move",this._bind_onPositionChanged),e.addEventListener("resize",this._bind_onPositionChanged),this._target.addEventListener("position_changed",this._bind_onPositionChanged),this._target.addEventListener("isConnected_changed",this._bind_onTargetDisconnected)),window.dispatchEvent(new Event("gmhObservePositions"))}close(){const t=this.parentView;if(!(this._slot&&this._target&&this.isOpen&&t))return;this.dispatchEvent(new Event("close"));const e=t.getShadowRoot();this.assignedListeners=!1,t.removeEventListener("bounds_changed",this._bind_onPositionChanged),t.removeEventListener("resize",this._bind_onPositionChanged),this._target.removeEventListener("position_changed",this._bind_onPositionChanged),this._target.removeEventListener("isConnected_changed",this._bind_onTargetDisconnected);const i=e.querySelector(".info_layer");i&&i.removeChild(this._slot),this._isSafari?this.removeAttribute("slot"):this._slot.assign(),this._slot=null,this._target=null,window.dispatchEvent(new Event("gmhObservePositions")),this.isOpen=!1,this._options.content=void 0}_onInfoClick(t){this.dispatchEvent(t)}_onPositionChanged(){if(!this._target)return void this.close();const t=this._target.getPosition(),e=this.parentView;if(!e)return;const i=e.fromLatLngToContainerPixel(t);if(!i)return void(this.style.visibility="hidden");const n=F(parseFloat(H(this._target,"g-anchor-point-x")||"0.5"),0,1),s=F(parseFloat(H(this._target,"g-anchor-point-y")||"0.2"),0,1),o=F(parseInt(H(this._target,"g-icon-width")||"42",10),1,64),r=F(parseInt(H(this._target,"g-icon-height")||"42",10),1,64);let a=1;if(this.platformId===w.ANDROID||this.platformId===w.IOS){const t=e.offsetHeight,n=i.y-t/2,s=e.getTilt()*(Math.PI/180),o=1625,r=o*o+n*n;a=(o+n*Math.tan(s))/Math.sqrt(r);const h=this._options.anchorPosition.x;this._options.anchorPosition.y,this.style.transformOrigin=`${h} ${h}`,this.style.transform=`scale(${a})`}const h=-o*(.5-n)-this._options.anchorPosition.x,l=-r*(1-s)*a-this._options.anchorPosition.y;this._frame.style.left=`${h}px`,this._frame.style.top=`${l}px`,this.style.left=`${i.x}px`,this.style.top=`${i.y}px`,this.platformId!==w.ANDROID&&this.platformId!==w.IOS||window.dispatchEvent(new Event("gmhObservePositions")),this.dispatchEvent(new Event("close"))}async onConnected(){if(await super.onConnected(),this.appendChild(this._frame),this.hasAttribute("content")){const t=this.getAttribute("content");t&&this.setContent(t)}this.initStatus=b,this.setHasMap(!0)}async onDisconnected(){await super.onDisconnected(),this.setHasMap(!1),this.removeChild(this._frame)}}class Yt extends qt{onContentMeasure(t,e){let i=t;return H(this,"g-max-width")&&(i=parseFloat(H(this,"g-max-width"))),{width:F(t,0,i),height:e}}onCanvas(t){const e=this.getCanvasSize(),i=e.width,n=e.height,s=t.getContext("2d");if(!s)throw new Error("Could not get the canvas context");const o=this.getContentSize(),r=this.getPadding(),a=o.height+2*r,h=i/2,l=n,d=this.getTailSize().width;s.beginPath();const c=P(this,"background-color");let g="white";if(Ut(c)){$t(c)[3]>0&&(g=c)}s.fillStyle=g;const p=P(this,"border-color");s.strokeStyle=Ut(p)?p:"black";const m=P(this,"border-width");let u=1;/^\d+(\s*?px)?$/.test(m)&&(u=parseInt(m.replace(/[^\d]/g,""),10)),s.lineWidth=u;const f=10;s.moveTo(f,0),s.shadowColor="rgba(0, 0, 0, 0.5)",s.shadowOffsetX=5,s.shadowOffsetY=5,s.shadowBlur=5,s.lineTo(i-f,0),s.quadraticCurveTo(i,0,i,f),s.lineTo(i,a-f),s.quadraticCurveTo(i,a,i-f,a),s.lineTo(h+f+d/2,a),s.lineTo(h,l),s.lineTo(h-f-d/2,a),s.lineTo(f,a),s.quadraticCurveTo(0,a,0,a-f),s.stroke(),s.shadowColor="transparent",s.shadowBlur=0,s.lineTo(0,f),s.quadraticCurveTo(0,0,f,0),s.fill(),s.stroke(),s.closePath()}}const Qt=t=>!!t&&"southWest"in t&&"northEast"in t&&"lat"in t.southWest&&"number"==typeof t.southWest.lat&&"lng"in t.southWest&&"number"==typeof t.southWest.lng&&"lat"in t.northEast&&"number"==typeof t.northEast.lat&&"lng"in t.northEast&&"number"==typeof t.northEast.lng,Gt=t=>!!t&&"north"in t&&"number"==typeof t.north&&"east"in t&&"number"==typeof t.east&&"west"in t&&"number"==typeof t.west&&"south"in t&&"number"==typeof t.south,Xt=t=>{if(!t)throw new Error("The first argument of toILatLngBounds() can not be null");if(Gt(t)){const e=t;return{northEast:{lat:e.north,lng:e.east},southWest:{lat:e.south,lng:e.west}}}if(Qt(t)){const e=t;return{northEast:{lat:e.northEast.lat,lng:e.northEast.lng},southWest:{lat:e.southWest.lat,lng:e.southWest.lng}}}if(t instanceof Kt){const e=t,i=e.getSouthWest(),n=e.getNorthEast();return{northEast:{lat:n.lat,lng:n.lng},southWest:{lat:i.lat,lng:i.lng}}}if(Array.isArray(t))return new Kt(t).toJSON();if("string"==typeof t){const e=t.split(","),i=e.filter((t=>/[\-\+]?\d+(?:\.\d+)?/.test(t)));if(e.length!==i.length)throw new Error(`Can not parse latLngBounds string: "${t}"`);const n=i.map((t=>Jt(t)));return new Kt(n).toJSON()}throw new Error("Can not convert to ILatLngBounds")};class Kt{constructor(t,e){if(this.northEast=void 0,this.southWest=void 0,this.beyond0=!1,this.beyond180=!1,t){if(Gt(t)||Qt(t)||t instanceof Kt){const e=Xt(t);this.northEast={lat:e.northEast.lat,lng:e.northEast.lng},this.southWest={lat:e.southWest.lat,lng:e.southWest.lng}}else if((t instanceof N||D(t))&&(e instanceof N||D(e)))this.southWest=z(t),this.northEast=z(e);else if(Array.isArray(t)){t.forEach((t=>{this.extend(t)}))}this.isEmpty()||(this.beyond0=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng,this.beyond180=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng)}}toString(){if(this.isEmpty())return"((1, 180), (-1, -180))";const t=this.toJSON();return`((${t.south}, ${t.west}), (${t.north}, ${t.east}))`}isEmpty(){return!this.southWest&&!this.northEast}toJSON(){return this.isEmpty()?{east:-180,north:-1,south:1,west:180}:{east:this.northEast.lng,north:this.northEast.lat,south:this.southWest.lat,west:this.southWest.lng}}toUrlValue(t=6){return this.isEmpty()?[1,180,-1,-180].join(","):[A(this.southWest.lat,t),A(this.southWest.lng,t),A(this.northEast.lat,t),A(this.northEast.lng,t)].join(",")}extend(t){if(!t||!("lat"in t)||!("lng"in t))return;const e=z(t);if(this.isEmpty())this.southWest=e,this.northEast=e,this.beyond0=this.southWest.lng<0&&this.northEast.lng>0||this.southWest.lng>this.northEast.lng,this.beyond180=this.southWest.lng>0&&this.northEast.lng<0||this.southWest.lng>this.northEast.lng;else{const t=Math.min(e.lat,this.southWest.lat),i=Math.max(e.lat,this.northEast.lat);let n=this.northEast.lng,s=this.southWest.lng;const o=n>0,r=s>0,a=e.lng>0;let h=0,l=0,d=0;if(this.contains(e))return;let c=!1;if(c=this.beyond180?e.lng>=s&&e.lng<=180||e.lng<=n&&e.lng>=-180:e.lng>=s&&e.lng<=n,!c){if(r&&o&&!a&&!this.beyond0&&!this.beyond180||!r&&o&&!a&&this.beyond0&&!this.beyond180||!r&&!o&&!a&&e.lng<s&&!this.beyond0&&!this.beyond180||r&&o&&a&&e.lng<s&&!this.beyond0&&!this.beyond180?(h=180-n+(e.lng+180),l=s-e.lng,d=1):!r||o||a||this.beyond0||!this.beyond180?!r&&!o&&!a&&this.beyond0||o&&r&&a&&this.beyond0&&this.beyond180||!o&&r&&a&&!this.beyond0&&this.beyond180?(h=e.lng-n,l=s-e.lng,d=3):(r&&o&&a&&e.lng>n&&!this.beyond0&&!this.beyond180||o&&!r&&a&&this.beyond0&&!this.beyond180||!o&&!r&&a&&!this.beyond0&&!this.beyond180||!o&&!r&&!a&&e.lng>n&&!this.beyond0&&!this.beyond180)&&(h=e.lng-n,l=180+s+(180-e.lng),d=4):(h=e.lng-n,l=s-e.lng,d=2),!(d>0)){const t=btoa(JSON.stringify({case:"LatLngBounds.extends did not match",bounds:this.toUrlValue(),target:e.lng,beyond0:this.beyond0,beyond180:this.beyond180}));throw new Error(`[LatLngBounds.extend] Please report this error message: "${t}"`)}h<l?n=e.lng:s=e.lng}this.southWest={lat:t,lng:s},this.northEast={lat:i,lng:n},this.beyond0=this.beyond0||s<0&&n>0||this.southWest.lng>this.northEast.lng,this.beyond180=this.beyond180||s>0&&n<0||this.southWest.lng>this.northEast.lng}}equals(t){if(!t)return!1;const e={south:-999,north:-999,east:-999,west:-999};if(t instanceof Kt){const i=t,n=i.getSouthWest(),s=i.getNorthEast();e.south=n.lat,e.west=n.lng,e.north=s.lat,e.east=s.lng}else if(Qt(t)){const i=t;e.south=i.southWest.lat,e.west=i.southWest.lng,e.north=i.northEast.lat,e.east=i.northEast.lng}else{if(!Gt(t))return!1;{const i=t;e.south=i.south,e.west=i.west,e.north=i.north,e.east=i.east}}return this.southWest.lat===e.south&&this.southWest.lng===e.west&&this.northEast.lat===e.north&&this.northEast.lng===e.east}contains(t){if(!t||!("lat"in t)||!("lng"in t))return!1;const e=z(t),i=e.lat<=this.northEast.lat&&e.lat>=this.southWest.lat,n=this.northEast.lng,s=this.southWest.lng;let o=!1;return o=this.beyond180?e.lng>=s&&e.lng<=180||e.lng<=n&&e.lng>=-180:e.lng>=s&&e.lng<=n,i&&o}getCenter(){if(this.isEmpty())return new N(0,-180);const t=this.beyond180?this.northEast.lng:this.southWest.lng,e=this.beyond180?this.southWest.lng:this.northEast.lng;let i;if(this.beyond180){i=t+(180-t+(180+e))/2,i=i>180?i-180-180:i}else i=(this.southWest.lng+this.northEast.lng)/2;const n=(this.southWest.lat+this.northEast.lat)/2;return new N(n,i)}union(t){if(!t)return this.isEmpty()?new Kt:new Kt(this.southWest,this.northEast);if(!(Qt(t)||Gt(t)||t instanceof Kt))throw new Error("[LatLng.union] unknown type data was given.");const e=Xt(t);return this.isEmpty()?new Kt(e.southWest,e.northEast):(this.extend(e.southWest),this.extend(e.northEast),this)}getSouthWest(){return new N(this.southWest.lat,this.southWest.lng)}getNorthEast(){return new N(this.northEast.lat,this.northEast.lng)}toSpan(){return this.isEmpty()?new N(0,0):new N(this.northEast.lat-this.southWest.lat,(this.northEast.lng-this.southWest.lng+360)%360||360)}intersects(t){let e;if(this.isEmpty())return!1;if("north"in t&&"east"in t&&"west"in t&&"south"in t){const i=t;e={north:i.north,east:i.east,south:i.south,west:i.west}}else if("northEast"in t&&"southWest"in t){const i=t;e={north:i.northEast.lat,east:i.northEast.lng,south:i.southWest.lat,west:i.southWest.lng}}else{if(!(t instanceof Kt))return!1;{const i=t;if(i.isEmpty())return!1;const n=i.getNorthEast(),s=i.getSouthWest();e={north:n.lat,east:n.lng,south:s.lat,west:s.lng}}}return this.contains({lat:e.south,lng:e.west})||this.contains({lat:e.south,lng:e.east})||this.contains({lat:e.north,lng:e.west})||this.contains({lat:e.north,lng:e.east})}}const te="roadmap",ee="hybrid",ie="satellite",ne="terrain",se="none",oe=(t,e,i)=>{if(e>i){const t=i;i=e,e=t}const n=i-e;return(t-=Math.floor((t-e)/n)*n)>i?t-=n:t<e&&(t+=n),t};class re extends j{static get observedAttributes(){return["center","zoom","maptype","tilt","heading","class","id"]}constructor(t={}){if(super(),this.nativeEvent2apiEvent={"camera:move:start":"camera_move_start","camera:move":"camera_move","camera:move:end":"camera_move_end",dragging:"drag","drag:end":"drag_end","drag:start":"drag_start","tiles:loaded":"tiles_loaded"},this._bind_onMvcChanged=t=>this._onMvcChanged(t),this._bind_onCameraPropertyChanged=()=>this._onCameraPropertyChanged(),this._bind_updateCameraParams=()=>this.updateCameraParams(),this._mat=[],this._inv=[],this.state.set("maptype",se,!0),this.state.set("center",{lat:0,lng:0},!0),this.state.set("zoom",0,!0),this.state.set("heading",0,!0),this.state.set("tilt",0,!0),this.state.set("northEast",{lat:0,lng:0},!0),this.state.set("southWest",{lat:0,lng:0},!0),this.state.set("farLeft",{lat:0,lng:0},!0),this.state.set("farRight",{lat:0,lng:0},!0),this.state.set("nearLeft",{lat:0,lng:0},!0),this.state.set("nearRight",{lat:0,lng:0},!0),this.state.set("minZoom",0,!0),this.state.set("maxZoom",30,!0),this.state.set("building",!0,!0),this.state.set("clickableIcons",!1,!0),t){if("mapType"in t&&t.mapType&&this.state.set("maptype",this._normalizedMapType(t.mapType)),"camera"in t&&t.camera&&this.state.set("initCamera",t.camera),"preferences"in t&&t.preferences){const e=t.preferences;"minZoom"in e&&"number"==typeof e.minZoom&&this.state.set("minZoom",this._normalizedMinZoom(t.preferences.minZoom)),"maxZoom"in e&&"number"==typeof e.maxZoom&&this.state.set("maxZoom",this._normalizedMaxZoom(t.preferences.maxZoom)),"building"in e&&this.state.set("building",!0===e.building),"clickableIcons"in e&&this.state.set("clickableIcons",!0===e.clickableIcons),"restriction"in e&&this.state.set("restriction",this._normalizedRestriction(t.preferences.restriction))}"controls"in t&&t.controls&&t.controls,"gestures"in t&&t.gestures,"styles"in t&&t.styles}this.state.set("cameraEventTimer",void 0),this.state.addEventListener("bounds_changed",this._bind_onMvcChanged),this.state.addEventListener("center_changed",this._bind_onMvcChanged),this.state.addEventListener("tilt_changed",this._bind_onMvcChanged),this.state.addEventListener("heading_changed",this._bind_onMvcChanged),this.state.addEventListener("zoom_changed",this._bind_onMvcChanged),this.template.innerHTML="\n      <style>\n      :host {\n        position: relative;\n        display: block;\n        width: 100%;\n        height: 100%;\n        transform-style: preserve-3d;\n        overflow: hidden;\n      }\n      .info_layer {\n        position: absolute;\n        width: 0px;\n        height: 0px;\n        left: 0px;\n        top: 0px;\n        color: black;\n        pointer-events: none;\n        text-align: left;\n      }\n      .contents_layer {\n        position: relative;\n        z-index: 20;\n      }\n      </style>\n      <div class='info_layer' id='info_layer'></div>\n      <div class='contents_layer'><slot name='contents'></slot></div>\n    ",this.shadow.appendChild(this.template.content.cloneNode(!0));const e=window.mkgeeklab.googlemaps.getPlatformId();e!==w.ANDROID&&e!==w.IOS||this.addEventListener("tiles:loaded",this._onTilesLoadeFromNative.bind(this)),this.addEventListener("camera:move",this._onCameraChangedFromNative.bind(this)),this.addEventListener("camera:move:end",this._onCameraChangedFromNative.bind(this))}_onMvcChanged(t){this.dispatchEvent(t)}_onCameraPropertyChanged(){let t=this.state.get("cameraEventTimer");void 0!==t&&clearTimeout(t),t=setTimeout(this._bind_updateCameraParams,100)}updateCameraParams(){this.state.set("cameraEventTimer",void 0);const t={camera:{target:[this.state.get("center")],zoom:this.state.get("zoom"),tilt:this.state.get("tilt"),heading:this.state.get("heading")}};this.isConnected&&this.initStatus===b&&this.execPromise(this.viewId,"setOptions",[t])}_normalizedMinZoom(t){return null==t?2:("string"==typeof t&&(t=parseInt(t,10)),"number"==typeof t?F(t,2,30):2)}_normalizedMaxZoom(t){return null==t?30:("string"==typeof t&&(t=parseInt(t,10)),"number"==typeof t?F(t,2,30):30)}_normalizedBuilding(t){return null==t?jt(H(this,"g-pref-building")):!0===t}_normalizedClickableIcons(t){return null==t?jt(H(this,"g-pref-clickable-icons")):!0===t}_normalizedRestriction(t){return Xt(null==t?H(this,"g-pref-restriction"):t)}_normalizedCenter(t){if(t instanceof N)return t.toJSON();if(D(t))return{lat:t.lat,lng:t.lng};if("string"==typeof t)return Jt(t);throw new Error(`Can not parse given value : ${t}`)}_normalizedZoom(t){return null==t?this.state.get("minZoom"):("string"==typeof t&&(t=parseInt(t,10)),F(t,this.state.get("minZoom"),this.state.get("maxZoom")))}_normalizedTilt(t){return null==t?0:("string"==typeof t&&(t=parseInt(t,10)),F(t,0,90))}_normalizedHeading(t){return null==t?0:("string"==typeof t&&(t=parseInt(t,10)||0),t<0&&(t+=360),t%360)}_normalizedMapType(t){return t?t="roadmap"===(t=t.toLowerCase())||"hybrid"===t||"satellite"===t||"terrain"===t||"none"===t?t:"roadmap":"roadmap"}convertToCameraParams(t){if(!t)return{padding:0};const e={padding:10},i=[];if(Array.isArray(t.target)){const e=new Kt(t.target);i.push(e.getNorthEast().toJSON()),i.push(e.getSouthWest().toJSON())}else if(t.target instanceof N)i.push(t.target.toJSON());else if(D(t.target))i.push(t.target);else if(t.target instanceof Kt){const e=t.target;i.push(e.getNorthEast().toJSON()),i.push(e.getSouthWest().toJSON())}else if(Qt(t.target)){const e=new Kt(t.target);i.push(e.getNorthEast().toJSON()),i.push(e.getSouthWest().toJSON())}else if(Gt(t.target)){const e=new Kt(t.target);i.push(e.getNorthEast().toJSON()),i.push(e.getSouthWest().toJSON())}return i.length>0&&(e.target=i,i.length>1?"number"==typeof t.padding&&(e.padding=Math.max(0,t.padding)):"number"==typeof t.zoom&&(e.zoom=t.zoom)),"number"==typeof t.tilt&&(e.tilt=t.tilt),"number"==typeof t.heading&&(e.heading=t.heading),"number"==typeof t.duration&&(e.duration=t.duration),e}moveCamera(t){if(!t)return Promise.resolve();const e=this.convertToCameraParams(t);return this.execPromise(this.viewId,"moveCamera",[e])}get maptype(){return this.state.get("maptype")}set maptype(t){null==t?(this.removeAttribute("maptype"),this.state.set("maptype","none")):this.state.set("maptype",this._normalizedMapType(t))}getHeading(){return this.state.get("heading")}setHeading(t){if("number"!=typeof t)throw new Error("setHeading() accepts a number");t<0&&(t+=360),this.state.set("heading",t%360),Promise.resolve().then(this._bind_onCameraPropertyChanged)}get heading(){return this.state.get("heading")}set heading(t){null==t?(this.removeAttribute("heading"),this.state.set("heading",0)):t!==this.state.get("heading")&&(this.state.set("heading",this._normalizedHeading(t)),Promise.resolve().then(this._bind_onCameraPropertyChanged))}getTilt(){return this.state.get("tilt")}setTilt(t){if("number"!=typeof t)throw new Error("setTilt() accepts an integer number from 0 to 90");this.state.set("tilt",F(t,0,90)),Promise.resolve().then(this._bind_onCameraPropertyChanged)}get tilt(){return this.state.get("tilt")}set tilt(t){null==t?(this.removeAttribute("tilt"),this.state.set("tilt",0)):t!==this.state.get("tilt")&&(this.state.set("tilt",this._normalizedTilt(t)),Promise.resolve().then((()=>this._onCameraPropertyChanged())))}getCenter(){const t=this.state.get("center");return{lat:t.lat,lng:t.lng}}setCenter(t){if(t instanceof N)this.state.set("center",t.toJSON()),Promise.resolve().then(this._bind_onCameraPropertyChanged);else{if(!D(t))throw new Error("setCenter() accepts a value of ILatLng or LatLng");this.state.set("center",t),Promise.resolve().then(this._bind_onCameraPropertyChanged)}}get center(){return this.state.get("center")}set center(t){if("string"==typeof t)try{Jt(t)}catch(e){throw new Error('The center property must be formatted with "(latitude), (longitude)"')}t!==this.state.get("center")&&(this.state.set("center",this._normalizedCenter(t)),Promise.resolve().then(this._bind_onCameraPropertyChanged))}getZoom(){return this.state.get("zoom")}setZoom(t){if("number"!=typeof t)throw new Error("setZoom() accepts from 2 to 30 interger");this.state.set("zoom",F(t,this.state.get("minZoom"),this.state.get("maxZoom"))),Promise.resolve().then(this._bind_onCameraPropertyChanged)}get zoom(){return this.state.get("zoom")}set zoom(t){null==t?(this.removeAttribute("zoom"),this.state.set("zoom",this.state.get("minZoom"))):t!==this.state.get("zoom")&&(this.state.set("zoom",this._normalizedZoom(t)),Promise.resolve().then((()=>this._onCameraPropertyChanged())))}_onTilesLoadeFromNative(t){}_onCameraChangedFromNative(t){if(!Zt(t))return;const e=t.detail;this._mat=e.mat,this._inv=e.inv,this.state.set("farLeft",e.farLeft),this.state.set("farRight",e.farRight),this.state.set("nearLeft",e.nearLeft),this.state.set("nearRight",e.nearRight),this.state.set("center",e.center),this.state.set("tilt",e.tilt),this.state.set("heading",e.heading),this.state.set("zoom",e.zoom),this.state.set("northEast",e.northEast),this.state.set("southWest",e.southWest),this.state.set("bounds",{northEast:e.northEast,southWest:e.southWest}),this.dispatchEvent(new CustomEvent(this.nativeEvent2apiEvent[t.type]))}fromContainerPixelToLatLng(t,e=!1){if(9!==this._mat.length)return;const i={x:t.x,y:t.y};i.x-=this.offsetWidth/2,i.y-=this.offsetHeight/2,i.x+=128,i.y+=128,i.x/=256,i.y/=256;const n=this.applyMatrix(i,this._mat),s=this.getProjection();return!0!==e&&(n.x=oe(n.x,-128,128)),s.fromPointToLatLng(n,e)}fromLatLngToContainerPixel(t){if(9!==this._inv.length)return;const e=this.getProjection(),i=e.fromLatLngToPoint(t),n=e.fromLatLngToPoint(this.state.get("center"));i.x=oe(i.x,n.x-128,n.x+128);const s=this.applyMatrix(i,this._inv);return s.x*=256,s.y*=256,s.x-=128,s.y-=128,{x:s.x+this.offsetWidth/2,y:s.y+this.offsetHeight/2}}applyMatrix(t,e){const i=e[6]*t.x+e[7]*t.y+e[8];return{x:(e[0]*t.x+e[1]*t.y+e[2])/i,y:(e[3]*t.x+e[4]*t.y+e[5])/i}}get bounds(){const t=this.state.get("northEast"),e=this.state.get("southWest");return new Kt(t,e)}get farLeft(){return this.state.get("farLeft")}get farRight(){return this.state.get("farRight")}get nearLeft(){return this.state.get("nearLeft")}get nearRight(){return this.state.get("nearRight")}get northEast(){return this.state.get("northEast")}get southWest(){return this.state.get("southWest")}_onRedrawMap(t){this.initStatus}addEventListener(t,e,i){"click"===t?super.addEventListener(t,(t=>{t instanceof MouseEvent||e(t)}),i):super.addEventListener(t,e,i)}async connectedCallback(){if(super.connectedCallback(),this.initStatus===v)return;const t={id:this.getId()};new Promise((t=>{let e=Y(this),i=0;const n=setInterval((()=>{const s=Y(this);if(e.left===s.left&&e.top===s.top&&e.width===s.width&&e.height===s.height){if(10==++i)return clearInterval(n),void t()}else i=0;e=s}),50)})).then((()=>{const e=H(this,"g-js-mapid"),i=H(this,"g-android-mapid"),n=H(this,"g-ios-mapid");this.hasAttribute("maptype")&&(this.maptype=this.getAttribute("maptype"));const s=this.state.get("initCamera"),o=this.convertToCameraParams(s);this.hasAttribute("center")&&(this.center=this.getAttribute("center"),o.target=[this.state.get("center")]),this.hasAttribute("zoom")&&(this.zoom=this.getAttribute("zoom"),o.zoom=this.state.get("zoom")),this.hasAttribute("tilt")&&(this.tilt=this.getAttribute("tilt"),o.tilt=this.state.get("tilt")),this.hasAttribute("heading")&&(this.heading=this.getAttribute("heading"),o.heading=this.state.get("heading"));const r={mapType:this.state.get("maptype"),controls:{},gestures:{},jsMapId:e,androidMapId:i,iosMapId:n,camera:o,preferences:{zoom:{minZoom:this.state.get("minZoom")||0,maxZoom:this.state.get("maxZoom")},building:this.state.get("building"),clickableIcons:this.state.get("clickableIcons"),restriction:this.state.get("restriction")}};return new Promise((e=>{this.initStatus===_?(this.initStatus=v,this.execPromise("GoogleMaps","createMapView",[t,r],{sync:!0}).then(e)):Promise.resolve(e)}))})).then((()=>this.execPromise("GoogleMaps","attachToWindow",[t],{sync:!0}))).then((()=>{this.initStatus=b}))}disconnectedCallback(){super.disconnectedCallback(),this.initStatus===b&&this.execPromise("GoogleMaps","detachFromWindow",[{id:this.getId()}],{sync:!0})}}class ae extends M{constructor(){super(),this._hasMap=!1,this._parentOverlay=null,this._children=[],this._path=new $,this._bind_onUpdate=t=>this._onUpdate(t),this._execQueue=new $}setParentOverlay(t){this._parentOverlay=t}get parentOverlay(){return this._parentOverlay}_onUpdate(t){const e=t.detail;this.dispatchEvent(new CustomEvent("command",{detail:{methodName:t.type,index:e.index,latLng:e.value}}))}onChildrenAdded(t){const e=Array.from(this.children),i=t.map((t=>({child:t,index:e.indexOf(t)})));i.sort(((t,e)=>e.index-t.index)),i.forEach((t=>{this._children.splice(t.index,0,t.child),this._path.insertAt(t.index,t.child.toJSON())}))}onChildrenRemoved(t){const e=t.map((t=>this._children.indexOf(t)));e.sort(((t,e)=>e-t)),e.forEach((t=>{t>-1&&(this._children.splice(t,1),this._path.removeAt(t))}))}onCommandFromChildren(t){const e=t.detail,i=this._children.indexOf(t.target);if(-1!==i&&"setPosition"===e.methodName)this._path.setAt(i,e.latLng)}toJSON(){return this._path.toArray()}connectedCallback(){super.connectedCallback(),this._path.addEventListener("insert_at",this._bind_onUpdate),this._path.addEventListener("set_at",this._bind_onUpdate),this._path.addEventListener("remove_at",this._bind_onUpdate),this._path.addEventListener("remove_all",this._bind_onUpdate);Array.from(this.children).forEach(((t,e,i)=>{if(!(t instanceof N))throw new Error("<mkg-path> can contain only <mkg-latlng>");this._path.push(t.toJSON(),true),this._children.push(t)}))}disconnectedCallback(){super.disconnectedCallback(),this._path.removeEventListener("insert_at",this._bind_onUpdate),this._path.removeEventListener("set_at",this._bind_onUpdate),this._path.removeEventListener("remove_at",this._bind_onUpdate),this._path.removeEventListener("remove_all",this._bind_onUpdate),this.dispatchEvent(new CustomEvent("command",{detail:{methodName:"remove_all",path:[]}})),this._path.clear(!0),this._children.length=0,this.setParentOverlay(null)}}class he extends Vt{constructor(t){super(),this._path=new $,this._bind_onRemoveAll=t=>this._onRemoveAll(t),this._bind_onUpdate=t=>this._onPathUpdate(t),this.state.set("zIndex",void 0),this.state.set("visible",!0),this.state.set("clickable",!0),this.state.set("geodesic",!1),this.state.set("zIndex",0),this.state.set("strokeWidth",1),this.state.set("strokeColor",[0,0,0,255]),this.state.set("initOptions",t)}onRedraw(){this.initStatus<b||this.applyOptionsToState()}_onRemoveAll(t){this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setPath"},[]])}applyOptionsToState(t){const e={visible:this.state.get("visible"),clickable:this.state.get("clickable"),geodesic:this.state.get("geodesic"),strokeColor:this.state.get("strokeColor"),strokeWidth:this.state.get("strokeWidth"),zIndex:this.state.get("zIndex"),extra:this.state.get("extra")};["visible","clickable","geodesic"].forEach((t=>{const i=H(this,`mkg-${t}`);void 0!==i&&(e[t]=jt(i))}));const i=H(this,"mkg-stroke-color")||"";""!==i&&(e.strokeColor=$t(i));const n=H(this,"mkg-stroke-width")||"";""!==n&&(e.strokeWidth=parseInt(n.replace(/[^\d].*$/g,""),10));const s=H(this,"mkg-z-index")||"";if(""!==s&&(e.zIndex=parseInt(s.replace(/[^\d].*$/g,""),10)),t){if("extra"in t&&(e.extra=t.extra),"boolean"==typeof t.visible&&(e.visible=!0===t.visible),"boolean"==typeof t.clickable&&(e.clickable=!0===t.clickable),"boolean"==typeof t.geodesic&&(e.geodesic=!0===t.geodesic),t.strokeColor&&(e.strokeColor=$t(t.strokeColor)),"number"==typeof t.strokeWidth&&t.strokeWidth>=0&&(e.strokeWidth=t.strokeWidth),"number"==typeof t.zIndex){if(!Number.isInteger(t.zIndex))throw new Error("PolylineOptions.zIndex must be an integer value");e.zIndex=t.zIndex}t.path&&this.setPath(t.path)}isNaN(e.zIndex)&&(e.zIndex=0),Object.keys(e).forEach((t=>{this.state.set(t,e[t])}))}_onPathUpdate(t){const e=t.detail;this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setPath"},{action:e.methodName,index:e.index,latLng:e.latLng}])}onCommandFromChildren(t){this._onPathUpdate(t)}addEventListenersToPath(){this._path.addEventListener("remove_all",this._bind_onUpdate),this._path.addEventListener("set_at",this._bind_onUpdate),this._path.addEventListener("insert_at",this._bind_onUpdate),this._path.addEventListener("remove_at",this._bind_onUpdate)}removeEventListenersFromPath(){this._path.removeEventListener("remove_all",this._bind_onUpdate),this._path.removeEventListener("set_at",this._bind_onUpdate),this._path.removeEventListener("insert_at",this._bind_onUpdate),this._path.removeEventListener("remove_at",this._bind_onUpdate)}getPath(){return this._path}setPath(t){this._path instanceof ae?(this._path=new $,this.addEventListenersToPath()):this._path.clear(true);let e=[];if(t instanceof $)t.forEach(((t,i)=>{if(!D(t))throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.");e.push(t)})),this.removeEventListenersFromPath(),this._path=t,this.addEventListenersToPath();else if(Array.isArray(t))t.forEach(((t,i)=>{if(!D(t))throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.");e.push(t),this._path.push(t,true)}));else{if(!(t instanceof ae))throw new Error("Polyline.setPath() accepts either one MVCArray<ILatLng>, ILatLng[], or Path.");this._path=t,e=this._path.toJSON()}this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{path:e}])}async onConnected(){if(await super.onConnected(),this.state.addEventListener("visible_changed",this._bind_onPropertyChanged),this.state.addEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.addEventListener("geodesic_changed",this._bind_onPropertyChanged),this.state.addEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.addEventListener("strokeColor_changed",this._bind_onPropertyChanged),this.state.addEventListener("strokeWidth_changed",this._bind_onPropertyChanged),this._path instanceof $&&this.addEventListenersToPath(),this.hasMap||this.initStatus===v)return;this.setHasMap(!0);const t=Array.from(this.children).filter(((t,e,i)=>t instanceof ae));if(t.length>1)throw new Error("<mkg-polyline> can have only one <mkg-path>");1===t.length&&(this._path instanceof $&&this.removeEventListenersFromPath(),this._path=t[0]),new Promise((t=>{let e=[];e=this._path instanceof $?this._path.toArray():this._path.toJSON(),console.log(e),this.initStatus===_?(this.initStatus=v,this.execPromise("(parent)","createPolyline",[{id:this.viewId},{path:e,visible:!1}]).then(t)):this.execPromise("(parent)","execute",[{id:this.viewId,subMethodName:"setOptions"},{path:e,visible:!1}]).then(t)})).then((()=>this.execPromise("(parent)","attachOverlayToMap",[{id:this.viewId}]))).then((()=>{this.initStatus=b;const t=this.state.get("initOptions");this.applyOptionsToState(t),this.state.trigger("visible_changed",{key:"visible",prevValue:void 0,value:this.state.get("visible")}),this.state.set("initOptions",void 0)}))}async onDisconnected(){await super.onDisconnected(),this.state.removeEventListener("visible_changed",this._bind_onPropertyChanged),this.state.removeEventListener("clickable_changed",this._bind_onPropertyChanged),this.state.removeEventListener("geodesic_changed",this._bind_onPropertyChanged),this.state.removeEventListener("zIndex_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeColor_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeWidth_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeStyle_changed",this._bind_onPropertyChanged),this.state.removeEventListener("strokeStyleRepeat_changed",this._bind_onPropertyChanged),this._path instanceof $&&this.removeEventListenersFromPath(),this.hasMap&&this.initStatus===b&&(this.setHasMap(!1),this.initStatus=y,this.execPromise("(parent)","detachOverlayFromMap",[{id:this.getId()}]))}}class le{constructor(t){this.qName=t,this.commandQueue=[],this.stopRequested=!1,this.isExecuting=!1,this._bind_nextTick=()=>this.nextTick(),this.waitSync=!1}purge(){this.stopRequested=!0}set bridge(t){this._bridge=t,t&&Promise.resolve().then(this._bind_nextTick)}get bridge(){return this._bridge}execPromise(t,e,i=[],n={}){return new Promise(((s,o)=>{this.commandQueue.push({pluginName:t,methodName:e,args:i,execOptions:n,onSuccess:(...t)=>{this.stopRequested?s.apply(this,t):(n.sync&&(this.waitSync=!1),s.apply(this,t),Promise.resolve().then(this._bind_nextTick))},onError:t=>{this.stopRequested||(n.sync&&(this.waitSync=!1),o(t))}}),this.isExecuting||this.waitSync||0===this.commandQueue.length||!this._bridge||this.nextTick()}))}nextTick(){if(!this.isExecuting&&this._bridge){for(this.isExecuting=!0;this.commandQueue.length>0&&!this.waitSync;){const t=this.commandQueue.shift(),e=t.pluginName,i=t.methodName,n=btoa(JSON.stringify(t.args)),s=t.execOptions;this.stopRequested&&!s.remove||(s.sync&&(this.waitSync=!0),this._bridge.execute(this.qName,e,i,n).then(t.onSuccess).catch(t.onError))}this.isExecuting=!1}}}class de{constructor(){this.elements={},this._options={},this._queues={},this._frameworkId=this.getFrameworkId(),this._platformId=this.getPlatformId()}static getInstance(){return de.instance||(de.instance=new de),de.instance}async setUp(t){if(!t)return;const e=this.getPlatformId();if(!t.bridge||!(e in t.bridge)){throw[`@mkgeeklab/googlemaps-bridge-${this.getFrameworkId()} and `,`@mkgeeklab/googlemaps-platform-${e} are required`].join("")}this.bridge=t.bridge[e],this.bridge.onInit(e,t),Object.keys(this._queues).forEach((t=>{this._queues[t].bridge=this.bridge}));const i=this.getCommandQueue("system");if(e!==w.ANDROID&&e!==w.IOS)return;const n=new Wt(i);new Promise((t=>{const e=()=>{"complete"!==document.readyState?setTimeout(e,50):t()};e()})).then((()=>{n.observe(document.body)})),window.addEventListener("unload",(()=>{n.disconnect(),i.execPromise("GoogleMaps","unload",[],{sync:!0})}),{once:!0,passive:!0});const s=document.createElement("style");s.innerHTML="\n        ._gmh_css_ {\n            background-image: none !important;\n            background: rgba(0,0,0,0) none !important;\n            background-color: rgba(0,0,0,0) !important;\n        }\n        ._gmh_css_ .nav-decor {\n            background-color: rgba(0,0,0,0) !important;\n            background: rgba(0,0,0,0) none !important;\n            display:none !important;\n        }\n        .framework7-root .page-previous {\n            display:none !important;\n        }\n        ",document.head.appendChild(s)}getFrameworkId(){return this._frameworkId||(this._frameworkId=m.NO_FRAMEWORK,"cordova"in window&&window.cordova.platformId&&(this._frameworkId=m.CORDOVA),"Capacitor"in window&&window.Capacitor.platform&&(this._frameworkId=m.CAPACITOR)),this._frameworkId}getPlatformId(){if(this._platformId)return this._platformId;const t=this.getFrameworkId();let e=w.BROWSER;return t===m.CORDOVA&&("browser"===window.cordova.platformId&&(e=w.BROWSER),"android"===window.cordova.platformId&&(e=w.ANDROID),"ios"===window.cordova.platformId&&(e=w.IOS)),t===m.CAPACITOR&&("web"===window.Capacitor.platform&&(e=w.BROWSER),"android"===window.Capacitor.platform&&(e=w.ANDROID),"ios"===window.Capacitor.platform&&(e=w.IOS)),this._platformId=e,e}getCommandQueue(t){return t in this._queues||(this._queues[t]=new le(t)),this._queues[t].bridge||(this._queues[t].bridge=this.bridge),this._queues[t]}}window.mkgeeklab||Reflect.defineProperty(window,"mkgeeklab",{enumerable:!1,value:{},writable:!1}),window.mkgeeklab.googlemaps||Reflect.defineProperty(window.mkgeeklab,"googlemaps",{enumerable:!1,value:de.getInstance(),writable:!1}),window.getElementByPluginDomId||Reflect.defineProperty(window,"getElementByPluginDomId",{enumerable:!1,value:q,writable:!1}),void 0===window.customElements.get("mkg-mapview")&&(window.customElements.define("mkg-marker",Ht),window.customElements.define("mkg-polyline",he),window.customElements.define("mkg-infobase",qt),window.customElements.define("mkg-infowindow",Yt),window.customElements.define("mkg-latlng",N),window.customElements.define("mkg-path",ae),window.customElements.define("mkg-mapview",re));class ce{constructor(t={}){this.options={mapTypeId:google.maps.MapTypeId.ROADMAP,restriction:null,maxZoom:null,minZoom:0,clickableIcons:!1,center:{lat:0,lng:0},zoom:0,zoomControl:!0,disableDoubleClickZoom:!1,scrollwheel:!0,rotateControl:!0,scaleControl:!1,fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!1,heading:0,tilt:0,mapId:null,isFractionalZoomEnabled:!0},this.compassEnabled=!1,this.mapToolbarEnabled=!1,this.myLocationButtonEnabled=!1,this.myLocationEnabled=!1,this.indoorEnabled=!1,this.buildingEnabled=!1,this.styles="",this.tiltGestureEnabled=!1,this.scrollGesturesEnabledDuringRotateOrZoom=!1,this.setValues(t)}setValues(t){if(t&&t){if(t.mapTypeId&&(this.mapTypeId=t.mapTypeId),void 0===t.jsMapId||null===t.jsMapId||""===t.jsMapId?this.mapId=void 0:"string"==typeof t.jsMapId&&(this.mapId=t.jsMapId),t.controls){const e=t.controls;this.compassEnabled=!0===e.compass,this.options.zoomControl=!0===e.zoom,this.mapToolbarEnabled=!0===e.mapToolbar,this.myLocationButtonEnabled=!0===e.myLocationButton,this.myLocationEnabled=!0===e.myLocation,this.indoorEnabled=!0===e.indoor}if(t.gestures){const e=t.gestures;this.options.draggable=!0===e.scroll||void 0===e.scroll,this.options.disableDoubleClickZoom=!1===e.zoom,this.options.scrollwheel=!this.options.disableDoubleClickZoom,this.options.rotateControl=!0===e.rotate||void 0===e.rotate,this.tiltGestureEnabled=!0===e.tilt||void 0===e.tilt,this.scrollGesturesEnabledDuringRotateOrZoom=!0===e.scrollGesturesEnabledDuringRotateOrZoom||void 0===e.scrollGesturesEnabledDuringRotateOrZoom}if(t.preferences){const e=t.preferences;if(e.padding){const t=e.padding;t.left=t.left||0,t.top=t.top||0,t.right=t.right||0,t.bottom=t.bottom||0}if(e.restriction&&Gt(e.restriction)){const t=e.restriction;this.options.restriction={strictBounds:!0,latLngBounds:t}}if(e.zoom){const t=e.zoom;"number"==typeof t.minZoom&&(this.options.minZoom=t.minZoom),"number"==typeof t.maxZoom&&(this.options.maxZoom=t.maxZoom)}this.options.clickableIcons=!0===e.clickableIcons,this.buildingEnabled=!0===e.building}if(t.camera){const e=t.camera;if("target"in e&&Array.isArray(e.target))if(0===e.target.length)"number"==typeof e.zoom&&(this.zoom=Math.max(e.zoom,0));else if(1===e.target.length)this.center=e.target[0],"number"==typeof e.zoom&&(this.zoom=Math.max(e.zoom,0));else if(2===e.target.length){const t=e.target[0];this.center=e.target[1];const i=new B,n=i.fromLatLngToPoint(this.center),s=i.fromLatLngToPoint(t),o=Math.sqrt(Math.pow(n.x-s.x,2)+Math.pow(n.y-s.y,2)),r=Math.log(256/o)/Math.log(2),a=Math.sqrt(Math.pow(n.x-s.x-e.padding/(256*Math.pow(2,r)),2)+Math.pow(n.y-s.y-e.padding/(256*Math.pow(2,r)),2)),h=Math.log(256/a)/Math.log(2);this.zoom=h}"zoom"in e&&(this.zoom=e.zoom||0),"tilt"in e&&(this.tilt=e.tilt||0),"heading"in e&&(this.heading=e.heading||0)}"string"==typeof t.styles&&(this.styles=t.styles||"")}}set mapId(t){this.options.mapId=t}get mapId(){return this.options.mapId}set mapTypeId(t){this.options.mapTypeId=this.convertToMapType(t)}get mapTypeId(){return this.options.mapTypeId}set center(t){this.options.center=t}get center(){return this.options.center}set tilt(t){this.options.tilt=t||0}get tilt(){return this.options.tilt}set heading(t){this.options.heading=t||0}get heading(){return this.options.heading}set zoom(t){this.options.zoom=Math.min(Math.max(t||0,0),25)}get zoom(){return this.options.zoom}set minZoom(t){this.options.minZoom="number"==typeof t?Math.min(Math.max(t,0),25):0}get minZoom(){return this.options.minZoom}set maxZoom(t){this.options.maxZoom="number"==typeof t?Math.min(Math.max(t,0),25):null}get maxZoom(){return this.options.maxZoom}getMapOptions(){return JSON.parse(JSON.stringify(this.options))}convertToMapType(t){if(!t)return google.maps.MapTypeId.ROADMAP;t=t.toLowerCase();let e=se;return e="normal"===t||"roadmap"===t?te:e,e="hybrid"===t?ee:e,e="satellite"===t?ie:e,e="terrain"===t?ne:e,e}}class ge extends W{constructor(t){super(),this.id="",this.marker=new google.maps.Marker,this._gsMarkerOptions(t).then((t=>{this.marker&&(this.marker.setOptions(t),this.marker.addListener("click",this._onMarkerEvent.bind(this,"click")),this.marker.addListener("dragstart",this._onMarkerEvent.bind(this,"dragstart")),this.marker.addListener("drag",this._onMarkerEvent.bind(this,"drag")),this.marker.addListener("dragend",this._onMarkerEvent.bind(this,"dragend")))}))}_gsMarkerOptions(t){const e={};return new Promise(((i,n)=>{if(t.position&&(e.position=t.position),"boolean"==typeof t.clickable&&(e.clickable=t.clickable),"boolean"==typeof t.draggable&&(e.draggable=t.draggable),"boolean"==typeof t.visible&&(e.visible=t.visible),"number"==typeof t.zIndex&&(e.zIndex=t.zIndex),t.icon)if("color"===t.icon.type)e.icon=this._generateIcon(t.icon.value),i(e);else if("img"===t.icon.type){const n=document.createElement("img"),s=()=>{n.removeEventListener("load",s),n.removeEventListener("error",o);let r=n.width,a=n.height;if(r>32||a>32){const t=r>32?32/r:32/a;r*=t,a*=t}const h=new google.maps.Size(r,a);e.icon={url:t.icon.value,scaledSize:h},i(e)},o=r=>{n.removeEventListener("load",s),n.removeEventListener("error",o),console.warn(`Cannot load image file from ${t.icon.value}`),e.icon=this._generateIcon([255,0,0,255]),i(e)};n.addEventListener("load",s),n.addEventListener("error",o),n.src=t.icon.value}else i(e);else i(e)}))}_generateIcon(t){return{path:"m12 0c-4.4183 2.3685e-15 -8 3.5817-8 8 0 1.421 0.3816 2.75 1.0312 3.906 0.1079 0.192 0.221 0.381 0.3438 0.563l6.625 11.531 6.625-11.531c0.102-0.151 0.19-0.311 0.281-0.469l0.063-0.094c0.649-1.156 1.031-2.485 1.031-3.906 0-4.4183-3.582-8-8-8zm0 4c2.209 0 4 1.7909 4 4 0 2.209-1.791 4-4 4-2.2091 0-4-1.791-4-4 0-2.2091 1.7909-4 4-4z",fillColor:`rgb(${t[0]},${t[1]},${t[2]})`,fillOpacity:t[3]/255,scale:1.3,strokeWeight:1,strokeColor:"rgb(255, 255, 255)",strokeOpacity:.65,anchor:new google.maps.Point(12,27)}}setId(t){this.id=t}getId(){return this.id}setMap(t){this.marker&&this.marker.setMap(t)}setEventCallback(t){this.eventCallback=t}setOptions(t){if(!this.marker)return Promise.reject(new Error("marker is invalid"));const e=t[1];return this._gsMarkerOptions(e).then((t=>{this.marker&&this.marker.setOptions(t)}))}_onMarkerEvent(t){if(!this.eventCallback||!this.marker)return;const e=this.marker.getPosition();e&&this.eventCallback(this.id,new CustomEvent(t,{detail:{latLng:e.toJSON()}}))}}class pe extends W{constructor(t){super(),this.id="",this.path=new google.maps.MVCArray,this.set("strokeStryle",void 0),this.set("strokeColor","black"),this.set("strokeOpacity",1),this.set("strokeWidth",1),this.polyline=new google.maps.Polyline({path:this.path}),this._gsPolylineOptions(t).then((t=>{this.polyline&&(this.polyline.setOptions(t),this.polyline.addListener("click",this._onPolylineEvent.bind(this,"click")))}))}getIconForStrokeStyle(t){const e=this.get("strokeWidth"),i=this.get("strokeColor"),n=this.get("strokeOpacity"),s=this.get("strokeStyleRepeat")||"10px";switch(t){case"solid":default:return[];case"dashed":return[{icon:{path:"M 0,-1 0,1",fillOpacity:n,fillColor:i,strokeColor:i,strokeOpacity:n,strokeWeight:e},repeat:s}];case"dotted":return[{icon:{path:google.maps.SymbolPath.CIRCLE,fillOpacity:n,fillColor:i,strokeColor:i,strokeOpacity:n,strokeWeight:e},repeat:s}]}}_gsPolylineOptions(t){const e={};return new Promise(((i,n)=>{if(t.path&&(this.path.clear(),t.path.forEach((t=>{this.path.push(new google.maps.LatLng(t.lat,t.lng))}))),"boolean"==typeof t.clickable&&(e.clickable=t.clickable),"boolean"==typeof t.visible&&(e.visible=t.visible),"boolean"==typeof t.geodesic&&(e.geodesic=t.geodesic),"number"==typeof t.strokeWidth&&(e.strokeWeight=t.strokeWidth),"number"==typeof t.zIndex&&(e.zIndex=t.zIndex),Array.isArray(t.strokeColor)){const e=t.strokeColor;this.set("strokeColor",`rgb(${e[0]},${e[1]},${e[2]})`,!0),this.set("strokeOpacity",e[3]/255,!0)}Number.isInteger(t.strokeWidth)&&t.strokeWidth>=0&&this.set("strokeWidth",t.strokeWidth,!0),t.strokeStyle&&""!==t.strokeStyle?this.set("strokeStyle",t.strokeStyle,!0):""===t.strokeStyle&&this.set("strokeStyle",void 0,!0),t.strokeStyleRepeat&&""!==t.strokeStyleRepeat?this.set("strokeStyleRepeat",t.strokeStyleRepeat,!0):""===t.strokeStyle&&this.set("strokeStyleRepeat",void 0,!0),this.get("strokeStyle")?(e.icons=this.getIconForStrokeStyle(this.get("strokeStyle")),e.strokeOpacity=0):(e.icons=[],e.strokeColor=this.get("strokeColor"),e.strokeOpacity=this.get("strokeOpacity"),e.strokeWeight=this.get("strokeWidth")),i(e)}))}setId(t){this.id=t}getId(){return this.id}setMap(t){this.polyline&&this.polyline.setMap(t)}setEventCallback(t){this.eventCallback=t}setOptions(t){if(!this.polyline)return Promise.reject(new Error("polyline is invalid"));const e=t[1];return this._gsPolylineOptions(e).then((t=>{this.polyline&&this.polyline.setOptions(t)}))}setPath(t){if(!this.polyline)return Promise.reject(new Error("polyline is invalid"));const e=t[1];switch(e.action){case"insert_at":this.path.insertAt(e.index,new google.maps.LatLng(e.latLng.lat,e.latLng.lng));break;case"set_at":this.path.setAt(e.index,new google.maps.LatLng(e.latLng.lat,e.latLng.lng));break;case"remove_at":this.path.removeAt(e.index);break;case"remove_all":this.path.clear()}return Promise.resolve()}_onPolylineEvent(t){this.eventCallback&&this.polyline}}class me extends W{constructor(t,e){super(),this.id="",this.mapOptions=new ce({}),this.container=document.createElement("div"),this.shadow=this.container.attachShadow({mode:"closed"}),this.shadowWrapper=document.createElement("div"),this.isMapCameraMoving=!1,this.overlayView=new google.maps.OverlayView,this.mapCanvasProjection=null,this.overlays={},this._bind_onBoundsChanged=()=>this._onBoundsChanged(),this._bind_onCameraIdle=()=>this._onCameraIdle(),this._bind_trackCamera=()=>this._trackCamera(),this.prevFarLeft={lat:0,lng:0},this.stopCounter=0,this.cornerPoints=[new google.maps.Point(-128,-128),new google.maps.Point(128,-128),new google.maps.Point(128,128),new google.maps.Point(-128,128)],this.container.style.position="absolute",this.container.style.left="0px",this.container.style.top="0px",this.container.style.right="0px",this.container.style.bottom="0px",this.container.style.width="100%",this.container.style.height="100%",this.shadowWrapper.style.position="absolute",this.shadowWrapper.style.left="0px",this.shadowWrapper.style.top="0px",this.shadowWrapper.style.right="0px",this.shadowWrapper.style.bottom="0px",this.shadowWrapper.style.width="100%",this.shadowWrapper.style.height="100%",this.shadowWrapper.style.padding="0px",this.shadowWrapper.style.margin="0px",this.shadowWrapper.style.border="none",this.shadowWrapper.style.userSelect="none",this.shadow.appendChild(this.shadowWrapper),this.pluginOptions=t,this.id=t.id,this.map=new google.maps.Map(this.shadowWrapper,e),this.overlayView.onAdd=()=>{google.maps.event.trigger(this.map,"ready")},this.overlayView.onRemove=()=>{},this.overlayView.draw=()=>{},this.overlayView.setMap(this.map);let i=!1;this.map.addListener("click",(t=>{i||this._onMouseEvent("click",t),i=!1}));let n=0;this.map.addListener("mousedown",(t=>{n=Date.now(),i=!1})),this.map.addListener("mouseup",(t=>{this.map.set("originalHeading",void 0),this.map.set("originalAngle",void 0),Date.now()-n>500&&(this._onMouseEvent("longclick",t),i=!0)})),this.addEventListenerOnce("remove",(()=>{google.maps.event.clearInstanceListeners(this.map)})),this.map.addListener("drag",(()=>{n=Date.now(),i=!0})),this.map.addListener("resize",this._bind_onBoundsChanged),this.map.addListener("center_changed",this._bind_onBoundsChanged),this.map.addListener("heading_changed",this._bind_onBoundsChanged),this.map.addListener("tilt_changed",this._bind_onBoundsChanged),this.map.addListener("zoom_changed",this._bind_onBoundsChanged),this.map.addListener("drag",this._bind_onBoundsChanged),this.map.addListener("idle",this._bind_onCameraIdle),this.map.addListener("drag",this._onMapEvent.bind(this,"dragging")),this.map.addListener("dragend",this._onMapEvent.bind(this,"drag:end")),this.map.addListener("dragstart",this._onMapEvent.bind(this,"drag:start")),this.map.addListener("tilesloaded",this._onMapEvent.bind(this,"tiles:loaded")),window.screen&&window.screen.orientation?window.screen.orientation.addEventListener("change",this._onOrientationChanged.bind(this)):window.addEventListener("orientationchange",this._onOrientationChanged.bind(this))}_onOrientationChanged(){this._onCameraEvent("camera:move")}_onBoundsChanged(){this.isMapCameraMoving||(this.stopCounter=0,this.isMapCameraMoving=!0,this._onCameraEvent("camera:move:start"),window.requestAnimationFrame(this._bind_trackCamera))}_trackCamera(){this.isMapCameraMoving&&(this._onCameraEvent("camera:move"),window.requestAnimationFrame(this._bind_trackCamera))}_onCameraIdle(){this.isMapCameraMoving=!1,this._onCameraEvent("camera:move:end")}execute(t){const e=t[0],i=e.id;if(e.subMethodName){const n=e.subMethodName;if(i in this.overlays){const e=this.overlays[i];return e[n].call(e,t)}return Promise.reject(`Can not find overlay: ${i}`)}return Promise.reject("PluginMap.execute() needs subMethodName property in args[0]")}getMap(){return this.map}getView(){return this.container}setId(t){this.id=t}getId(){return this.id}setOptions(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const e=t[0];this.mapOptions.setValues(e);const i=this.mapOptions.getMapOptions();return this.map.setOptions(i),this._onCameraEvent("camera:move"),Promise.resolve()}createMarker(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const e=t[0].id,i=t[1],n=new ge(i);return n.setId(e),n.setEventCallback(this._onOverlayEvent.bind(this)),this.overlays[e]=n,Promise.resolve()}createPolyline(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const e=t[0].id,i=t[1],n=new pe(i);return n.setId(e),n.setEventCallback(this._onOverlayEvent.bind(this)),this.overlays[e]=n,Promise.resolve()}attachOverlayToMap(t){if(!this.map)return Promise.reject(new Error("map is invalid"));const e=t[0].id;if(e in this.overlays){return this.overlays[e].setMap(this.map),Promise.resolve()}return Promise.reject(new Error(`can not find overlay2: ${e}`))}detachOverlayFromMap(t){if(!this.map)return Promise.reject(new Error("map is invalid"));return t.forEach((t=>{if(t in this.overlays){this.overlays[t].setMap(null)}})),Promise.resolve()}moveCamera(t){if(!this.map)return Promise.reject(new Error("map is invalid"));if(!this.map.getDiv())return Promise.reject(new Error("Can not manipulate the map when mapDiv is unset"));if(!this.overlayView)return Promise.reject(new Error("map is not ready"));if(!this.overlayView.getProjection())return Promise.reject(new Error("map is not ready"));const e=t[0],i=this.map.getZoom(),n={fromCenter:this.map.getCenter().toJSON(),fromZoom:i,fromTilt:this.map.getTilt(),fromHeading:this.map.getHeading(),toCenter:this.map.getCenter().toJSON(),toZoom:i,toTilt:this.map.getTilt(),toHeading:this.map.getHeading(),duration:0,changeCenter:!1,changeZoom:!1,changeTilt:!1,changeHeading:!1};if("number"==typeof e.duration&&(n.duration=Math.max(e.duration,0)),Array.isArray(e.target))if(0===e.target.length)"number"==typeof e.zoom&&(n.toZoom=Math.max(e.zoom,0));else if(1===e.target.length)n.toCenter=e.target[0],"number"==typeof e.zoom&&(n.toZoom=Math.max(e.zoom,0));else{const t=new google.maps.LatLngBounds;e.target.forEach((e=>{t.extend(e)})),n.toCenter=t.getCenter();const i=this.map.getProjection();this.shadowWrapper.offsetWidth,this.shadowWrapper.offsetHeight;const s=i.fromLatLngToPoint(n.toCenter),o=i.fromLatLngToPoint(t.getNorthEast()),r=Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2)),a=Math.log(256/r)/Math.log(2);n.toZoom=a}return"number"==typeof e.heading&&(n.toHeading=Math.max(e.heading,0)),"number"==typeof e.tilt&&(n.toTilt=Math.max(e.tilt,0)),n.changeCenter=!J(n.fromCenter,n.toCenter),n.changeZoom=Math.ceil(n.fromZoom)!==Math.ceil(n.toZoom),n.changeTilt=n.fromTilt!==n.toTilt,n.changeHeading=n.fromHeading!==n.toHeading,n.changeCenter||n.changeZoom||n.changeTilt||n.changeHeading||(n.duration=0),new Promise((t=>{let i=-1,s=0;const o=()=>{const r=Date.now();if(i<0&&(i=r,s=i),!this.map)return void t();const a=r-i;if(s!==r){const t=this.easeInOutQuart(a/n.duration),e={};n.changeCenter&&(e.center=google.maps.geometry.spherical.interpolate(n.fromCenter,n.toCenter,t).toJSON()),n.changeZoom&&(e.zoom=n.fromZoom+(n.toZoom-n.fromZoom)*t),n.changeHeading&&(e.heading=n.fromHeading+(n.toHeading-n.fromHeading)*t),n.changeTilt&&(e.tilt=n.fromTilt+(n.toTilt-n.fromTilt)*t),this.map.moveCamera(e)}a<e.duration?(s=r,window.requestAnimationFrame(o)):(this.map.moveCamera({center:n.toCenter,zoom:n.toZoom,heading:n.toHeading,tilt:n.toTilt}),t())};window.requestAnimationFrame(o)}))}easeInOutQuart(t){return t<.5?2*t*t:(4-2*t)*t-1}onAttached(){return new Promise(((t,e)=>{if(!this.map)return e(new Error("map is invalid"));this.map.setOptions(this.mapOptions.getMapOptions()),google.maps.event.trigger(this.map,"resize");const i=[],n=()=>{t(i)};void 0!==this.overlayView.getProjection()?(i.push(this.map.addListener("projection_changed",n)),i.push(this.map.addListener("bounds_changed",n))):i.push(this.map.addListener("ready",n))})).then((t=>{t.forEach((t=>t.remove())),this._onCameraEvent("camera:move2")}))}onReleased(){return this.map?(this.map.setOptions({mapTypeId:google.maps.MapTypeId.ROADMAP,center:{lat:0,lng:0},zoom:0,clickableIcons:!0,tilt:0,heading:0,restriction:void 0,minZoom:void 0,maxZoom:void 0}),Promise.resolve()):Promise.reject(new Error("map is invalid"))}releaseOverlay(t=[]){return t.forEach((t=>{this.overlays[t]=void 0,delete this.overlays[t]})),Promise.resolve()}_onCameraEvent(t){if(!t||!this.map||!this.overlayView)return;const e=this.map.getProjection();if(!e)return;const i=this.overlayView.getProjection();if(!i)return;const n=i.getVisibleRegion();if(!(n&&n.latLngBounds&&n.farLeft&&n.farRight&&n.nearLeft&&n.nearRight))return;this.prevFarLeft.lat===n.farLeft.lat()&&this.prevFarLeft.lng===n.farLeft.lng()&&(this.stopCounter+=1,10===this.stopCounter&&(this.isMapCameraMoving=!1)),this.prevFarLeft.lat=n.farLeft.lat(),this.prevFarLeft.lng=n.farLeft.lng();const s={center:this.map.getCenter().toJSON(),zoom:this.map.getZoom()||0,tilt:this.map.getTilt()||0,heading:this.map.getHeading()||0,northEast:n.latLngBounds.getNorthEast().toJSON(),southWest:n.latLngBounds.getSouthWest().toJSON(),farLeft:n.farLeft.toJSON(),farRight:n.farRight.toJSON(),nearLeft:n.nearLeft.toJSON(),nearRight:n.nearRight.toJSON(),mat:[],inv:[]};this.mapOptions.tilt=s.tilt,this.mapOptions.center=s.center,this.mapOptions.zoom=s.zoom,this.mapOptions.heading=s.heading;const o=this.cornerPoints.map((t=>{const n=i.fromDivPixelToLatLng(t,!0),s=e.fromLatLngToPoint(n);return{x:s.x,y:s.y}}));s.mat=this.calcHomographyMatrix(o[0],o[1],o[2],o[3]),s.inv=this.calcInverseMatrix(s.mat),this.prevCameraStatus=s,this.mapOptions.setValues(s);const r=q(this.getId());r&&r.dispatchEvent(new CustomEvent(t,{detail:s}))}calcHomographyMatrix(t,e,i,n){const s=t.x,o=t.y,r=n.x,a=n.y,h=e.x,l=e.y,d=i.x,c=i.y,g=h-d,p=r-d,m=s-r-h+d,u=l-c,f=a-c,_=o-a-l+c,v=(m*u-g*_)/(p*u-g*f),b=(m*f-p*_)/(g*f-p*u);return[h-s+b*h,r-s+v*r,s,l-o+b*l,a-o+v*a,o,b,v,1]}calcInverseMatrix(t){const e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],h=t[7],l=1/(+e*o*1+i*r*a+n*s*h-n*o*a-i*s*1-e*r*h);return[(1*o-r*h)/l,(1*-i+n*h)/l,(i*r-n*o)/l,(1*-s+r*a)/l,(1*e-n*a)/l,(-e*r+n*s)/l,(s*h-o*a)/l,(-e*h+i*a)/l,(e*o-i*s)/l]}_onMapEvent(t){if(!t)return;const e=q(this.getId());e&&e.dispatchEvent(new Event(t))}_onMouseEvent(t,e){if(!t||!e)return;e.stop();const i=e.placeId||"",n=e.latLng?e.latLng.toJSON():null,s=q(this.getId());s&&s.dispatchEvent(new CustomEvent(t,{detail:{placeId:i,latLng:n}}))}_onOverlayEvent(t,e){if(!t||!e)return;const i=q(t);i&&i.dispatchEvent(e)}}const ue=new class{constructor(){this.viewInstances={},this.initOptions={}}async onInit(t,e){if(t!==w.BROWSER)return;const i="jsApiKey"in e?e.jsApiKey:void 0;await this.loadGoogleMapsJS(i)}onWindowReady(){console.log("window.ready")}execute(t,e,i,n){const s=JSON.parse(atob(n));if("GoogleMaps"===e)return this[i].call(this,s);if(e in this.viewInstances){const t=this.viewInstances[e];if(!(i in t))throw new Error(`Can not find ${e}.${i}`);return t[i].call(t,s)}throw new Error(`Can not find ${e} plugin`)}createMapView(t=[]){const e=t[0],i=e.id,n=t[1],s=new me(e,{mapId:n.jsMapId});return this.viewInstances[i]=s,s.setOptions([n])}attachToWindow(t=[]){const e=t[0].id;if(!(e in this.viewInstances))return Promise.reject(`Can not find the view for ${e}`);const i=this.viewInstances[e],n=q(e);return n&&n.shadowRoot?(n.shadowRoot.insertBefore(i.getView(),n.shadowRoot.firstElementChild),i.onAttached()):Promise.reject(`Can not target element : ${e}`)}detachFromWindow(t=[]){const e=t[0],i=e.id;if(e.autoRelease,!(i in this.viewInstances))return Promise.reject(new Error(`can not find view: ${i}`));{const t=this.viewInstances[i].getView();t.parentElement&&t.parentElement.removeChild(t)}return Promise.resolve()}async loadGoogleMapsJS(t){if(!("google"in window)||!("maps"in window.google))return new Promise(((e,i)=>{const n=document.createElement("script");t&&t.length>35?n.setAttribute("src",`https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry&v=beta&key=${t}`):n.setAttribute("src","https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry&v=beta"),window.initMap=()=>{window.initMap=void 0,e()},n.onerror=t=>{i(new Error("Could not load Google Maps JavaScript API v3"))},document.getElementsByTagName("head")[0].appendChild(n)}))}releaseView(t=[]){const e=t[0].id;if(!(e in this.viewInstances))return Promise.resolve();const i=this.viewInstances[e];delete this.viewInstances[e];const n=i.getView();return n.parentElement&&n.parentElement.removeChild(n),i.onReleased()}removeFromDomTree(t=[]){return console.log("removeFromDomTree",t),Promise.resolve()}updateDomTree(t=[]){return console.log("updateDomTree",t),Promise.resolve()}onScrollWebview(t=[]){return console.log("onScrollWebview",t),Promise.resolve()}};window.mkgeeklab.googlemaps.setUp({bridge:{browser:ue},jsApiKey:(()=>{try{return"AIzaSyBpNKkll5yJ2YbS-i0dE5yIdEk8sef-S6g"}catch(t){return""}})()});t=new WeakMap,e=new WeakMap,i=new WeakMap,n=new WeakSet,s=function(){return`rgb(${Math.floor(255*Math.random())}, ${Math.floor(255*Math.random())}, ${Math.floor(255*Math.random())})`},o=new WeakSet,r=function(t){const o=new Ht({position:t.detail.latLng,icon:p(this,n,s).call(this),extra:{lat:t.detail.latLng.lat,lng:t.detail.latLng.lng,cnt:(r=this,l=i,{set _(t){g(r,l,t,c)},get _(){return d(r,l,m)}})._++}});var r,l,c,m;o.addEventListener("click",(t=>p(this,a,h).call(this,t))),d(this,e).appendChild(o),setTimeout((()=>{o.dispatchEvent(new Event("click"))}),300)},a=new WeakSet,h=function(e){const i=e.target;console.log(i.extra);const n=`\n        <table border=1>\n        <tr>\n            <th>cnt</th>\n            <td>${i.extra.cnt}</td>\n        </tr>\n        <tr>\n            <th>latitude</th>\n            <td>${i.extra.lat}</td>\n        </tr>\n        <tr>\n            <th>longitude</th>\n            <td>${i.extra.lng}</td>\n        </tr>\n        </table>\n        `;d(this,t).setContent(n),d(this,t).open(i)};const fe=document.getElementById("map_canvas");new class{constructor(s){c(this,n),c(this,o),c(this,a),c(this,t,new Yt),c(this,e,void 0),c(this,i,1),g(this,e,s),s.appendChild(d(this,t)),fe.addEventListener("click",(t=>p(this,o,r).call(this,t)))}}(fe);
